# Pythonアプリケーション仕様書

## 目次
1. [はじめに](#1-はじめに)
2. [ファイル構成](#2-ファイル構成)
3. [設定ファイルの説明](#3-設定ファイルの説明)
4. [OCR処理スクリプトの概要](#4-ocr処理スクリプトの概要)
5. [サンプルスクリプトの詳細](#5-サンプルスクリプトの詳細)
6. [センシティブ情報の取り扱い](#6-センシティブ情報の取り扱い)
7. [今後の展望](#7-今後の展望)

---

## 1. はじめに


本アプリケーションは、画像データの前処理を行い、光学文字認識（OCR）を通じてテキスト情報を抽出し、画像の向きを整えることを目的としています。これにより、様々な形式の画像データを効率的に処理し、データのスムーズな利用を実現します。

### 解決しようとしている問題

現代のデジタル環境において、画像からの情報抽出は非常に重要な業務プロセスの一部となっています。特に、手書きや印刷されたテキストを含む画像の情報を自動的に取得することは、業務の効率を向上させるための重要な課題です。しかし、画像データは方向や品質が様々であるため、標準化された処理を行う必要があります。本アプリケーションは以下の問題を解決します。

1. 画像からのテキストデータの効率的な抽出。
2. 抽出後のデータの可用性を高めるための画像の方向調整。
3. プロセスの自動化により人的リソースの削減。

### ターゲットユーザー

本アプリケーションの主要なターゲットユーザーは次の通りです。

- **データ分析者**: 大量の画像データから有用な情報を引き出し、分析を行う必要があります。データ分析者は、このアプリケーションを使用して迅速にデータを処理し、有意義なインサイトを得ることが期待されます。
  
- **開発者**: OCR機能や画像処理機能を自分のプロジェクトに利用したい開発者にとって、本アプリケーションの機能は強力なツールとなります。APIとして利用できる部分を開発することも視野に入れています。

- **業務担当者**: 文書管理や業務プロセスのデジタル化を進める担当者にとって、アプリケーションを利用することで、手作業によるデータ入力を減らし、作業効率を向上させることが可能です。

### ユースケース

1. **業務ドキュメントのデジタル化**
   - 業務担当者が多くの紙文書をデジタル化する際に、アプリケーションを用いてスキャンした画像からテキストを抽出し、データベースに格納します。

2. **データミニング**
   - データ分析者が特定のキーワードを含む画像を解析し、その結果を基に次のアクションを決定するために、アプリケーションを利用して画像内のテキストを抽出します。

3. **アプリケーション統合**
   - 開発者が自社製品にOCR機能を統合する際に、アプリケーションをAPIとして利用し、自社プロダクトに追加できます。

これらのユースケースを通じて、アプリケーションはユーザーのニーズに応じたソリューションを提供し、業務の質を向上させることを目指しています。

## 2. ファイル構成


このセクションでは、アプリケーション内の全ファイルを一覧化し、それぞれの役割や相互関係について詳述します。これにより、アプリケーション全体の流れを把握する手助けとなることを目的としています。

### 1. config.yml
- **パス**: `code/code_sample_python/config.yml`
- **役割**: アプリケーションの設定情報をYAML形式で記述したファイルです。YAML形式は人間が読みやすく、設定ファイルとして一般的に使用されます。
- **内容概要**: 
  - このファイルには、データベースの接続情報やAPIのキー、環境設定などが含まれることが一般的です。
  - 各セクションには特定の役割があり、例えば、`database`セクションには接続するデータベースのホスト名やポート番号などが定義されます。
  - `api_keys`セクションには、外部サービスと連携するための認証情報が含まれる場合があります。

### 2. sample.pfx
- **パス**: `code/code_sample_python/sample.pfx`
- **役割**: このファイルにはセンシティブな情報が含まれているため、具体的な説明はできませんが、アプリケーションの重要なデータや機密情報を取り扱う役割を果たしていると推測されます。

### 3. LargeFile.py
- **パス**: `code/code_sample_python/LargeFile.py`
- **役割**: 画像データの前処理と方向調整を行うためのスクリプトです。
  
#### 3.1 1_ocr_only.py
- **目的**: 指定されたフォルダ内のすべての画像にOCR（光学文字認識）を適用し、結果を画像として描画しないで出力します。
- **主な関数**: 
  - `process_png_folder(base_folder)`: `os.walk()`を用いて画像フォルダを探索し、各PNG画像ごとに特定の出力フォルダを生成します。OCR処理は`function_ocr.ocr_only_function(input_folder, output_folder)`を呼び出すことで行われます。
- **変数**: `base_folder`はスクリプト全体で使用されるベースパスです。

#### 3.2 2_change_direction.py
- **目的**: 前のステップで生成されたOCR結果に基づき、必要であれば横向きの画像を回転させ、一貫した方向に揃えます。
- **主な関数**:
  - `process_png_folder(base_folder)`: ベースフォルダを探索し、特定条件に合致するディレクトリを処理します。JSONデータを解析し、キーワード検出に基づいて回転処理を行う`function_2_direction.change_direction`を実行します。
- **変数**: `words_1_a`, `words_1_b`, `words_2_a`, `words_2_b`は、キーワードのリストで、異なるOCR情報を識別するために使用されます。画像の縦横比を計算するためには、`function_2_direction.calculate_width_prop`が利用されます。また、処理結果に基づき出力フォルダも動的に生成されます。

### 4. sample2.py
- **パス**: `code/code_sample_python/sample2.py`
- **役割**: 2つの数値を掛け算する単一の関数を定義したスクリプトです。
  
#### 関数の詳細:
- **multiply(a, b)**: 
  - 引数として2つの数値 `a` と `b` を受け取り、それらの積を計算して結果を返します。
- **処理の流れ**:
  1. `multiply` 関数が定義されます。
  2. ユーザーが指定した2つの数値を引数に渡して呼び出されます。
  3. 関数が掛け算を実行し、結果を呼び出し側に返します。

このファイル構成は、アプリケーションの主要な機能を支える要素がどのように配置され、相互に連携して動作しているかを示しています。

## 3. 設定ファイルの説明


`config.yml`ファイルは、アプリケーションのさまざまな設定情報をYAML形式で記述したものであり、アプリケーションの動作に重要な影響を与えます。以下に、設定項目ごとの意味や使用方法を詳述します。このファイルがどのようにアプリケーションの構成や実行環境を管理するかに焦点を当てます。

### 設定項目

#### 1. database
- **意味**: このセクションは、アプリケーションが使用するデータベースに関する情報を含みます。
- **使用方法**: 
  - 接続するデータベースのホスト名（例: `localhost`）、ポート番号（例: `5432`）、ユーザー名、パスワードなどをここに記述します。
  - アプリケーションのデータアクセス層がこの情報を基にデータベースに接続し、CRUD操作を行います。
- **影響**: 設定が不正確な場合、データベースへの接続失敗やクエリの実行に失敗することがあります。

#### 2. api_keys
- **意味**: 外部サービスとの連携に使う認証キーを格納するセクションです。
- **使用方法**: 
  - 各種APIのキー（例: Google API、AWSなど）をここに設定します。 
  - アプリケーションの各モジュールがこれらのキーを利用して外部サービスと連携します。
- **影響**: APIキーが無効または欠如している場合、サービスへのアクセスが拒否され、機能が正しく動作しなくなる可能性があります。

#### 3. logging
- **意味**: アプリケーションのログの設定を行うセクションです。
- **使用方法**: 
  - ログレベル（例: `DEBUG`, `INFO`, `WARNING`, `ERROR`）を指定します。
  - ログファイルの出力先やフォーマットなどもここで設定します。
- **影響**: 適切なログ設定がなされていないと、エラーの原因追跡やシステムの動作確認が困難になることがあります。

#### 4. environment
- **意味**: アプリケーションが動作する環境に関する設定を定義します。
- **使用方法**: 
  - 本番環境、開発環境などの区別を設定します。
  - 環境によって異なる設定（例: データベースの接続先やAPIキー）を適用するために使用します。
- **影響**: 環境設定が誤っていると、意図しない環境でコードが実行されることになり、データ破損やセキュリティリスクが生じる可能性があります。

#### 5. features
- **意味**: アプリケーションに組み込まれている機能の有効化/無効化を行います。
- **使用方法**: 
  - 機能ごとにトグル（真偽値）を設定します。特定の機能を有効にすることでアプリケーションの動作をカスタマイズできます。
- **影響**: 無効にされた機能はアプリケーションで使用できなくなり、ユーザーのデフォルト体験に影響を与えます。

### まとめ

`config.yml`はアプリケーションの運用において極めて重要な役割を果たします。設定が適切に行われなければ、アプリケーションの機能が正常に動作しない可能性が高くなります。そのため、各設定項目に正確な値を入力することが求められます。また、システム全体の保守性や可移植性を向上させるための基本的な要素として、YAML形式での設定は非常に有用です。

## 4. OCR処理スクリプトの概要


このドキュメントでは、`LargeFile.py`スクリプトにおけるOCR処理の流れと画像の向き補正について詳述します。スクリプトは二つの主要なコンポーネントから成り立っています。

### 1. 1_ocr_only.py

#### 機能
`1_ocr_only.py`は、指定されたフォルダ内の全ての画像にOCR（光学文字認識）を適用し、結果を画像として描画せずに出力します。

#### 処理の流れ
1. **画像フォルダの探索**: `process_png_folder(base_folder)`関数を使用し、`os.walk()`で入れ子になったフォルダ構造を探索します。
2. **フォルダごとの処理**: 各PNG画像フォルダごとに特定の出力フォルダを生成します。
3. **OCR処理の実行**: `function_ocr.ocr_only_function(input_folder, output_folder)`を呼び出して、OCR処理を行います。

#### 期待される出力
- OCR処理を通じて、画像から抽出されたテキストデータが指定された出力フォルダに保存されます。これにより、後続の処理に必要な情報が得られます。

### 2. 2_change_direction.py

#### 機能
`2_change_direction.py`は、前のステップで生成されたOCR結果を元に、必要に応じて横向きの画像を回転させ、一貫した方向に揃えます。

#### 処理の流れ
1. **ベースフォルダの探索**: `process_png_folder(base_folder)`関数を使用し、ベースフォルダ内の特定条件に合致するディレクトリを処理します。
2. **JSONデータの解析**: OCR結果から生成されたJSONデータを解析し、キーワードを検出します。
3. **画像の回転処理**: `function_2_direction.change_direction`を呼び出して、キーワードに基づいて画像を回転します。

#### 期待される出力
- 処理が完了すると、各画像が適切な向きに整列され、処理結果が新たに生成された出力フォルダに保存されます。この結果により、次のステップでの処理が円滑に進むことが期待されます。

### 使用方法
1. 必要な環境を整備した後、`LargeFile.py`を実行します。
2. スクリプトの実行には、指定されたベースフォルダへのパスが必要です。このパスは各関数で使用され、画像の探索及び処理が行われます。

### 必要な環境
- Pythonを実行できる環境
- 必要なライブラリ（特にOCR関連のライブラリ）がインストールされていること

このスクリプトを使用することで、自動的に画像に対するOCR処理と画像の向き補正を行うことができ、作業効率を大きく向上させることが可能です。

## 5. サンプルスクリプトの詳細


このセクションでは、`sample1.py`、`sample2.py`、および`sample3.py`の3つのPythonスクリプトの内容と機能を詳細に解説し、各スクリプトのユースケースに応じた特性を明確に区別します。

### sample1.py

#### 概要
このスクリプトは、2つの数値を受け取り、それらの和を計算するシンプルな関数を含んでいます。

#### 主な機能
- **関数: `add(a, b)`**
  - 引数:
    - `a`: 加算の1つ目の数値（整数または浮動小数点数）。
    - `b`: 加算の2つ目の数値（整数または浮動小数点数）。
  - 戻り値: `a`と`b`の合計値を返します。

#### ユースケース
- 数値の加算を必要とする基本的な演算が必要な場合に最適です。シンプルな計算を行いたいユーザーや、他のスクリプトから呼び出して利用する場合に便利です。

### sample2.py

#### 概要
このスクリプトには、2つの数値を掛け算する単一の関数が定義されています。

#### 主な機能
- **関数: `multiply(a, b)`**
  - 引数:
    - `a`: 掛け算の1つ目の数値（整数または浮動小数点数）。
    - `b`: 掛け算の2つ目の数値（整数または浮動小数点数）。
  - 戻り値: `a`と`b`の積を計算し、その結果を返します。

#### ユースケース
- 数値の掛け算を行いたい場合や、加算とは異なる演算を行う必要があるシナリオに最適です。特に、他のモジュールから呼び出して使用する際に便利です。

### sample3.py

#### 概要
このスクリプトは、他のモジュールから関数をインポートして、二つの数の和と積を計算して表示するシンプルなプログラムです。

#### 主な機能
- `from sample1 import add`: `sample1`モジュールから`add`関数をインポートし、加算を行います。
- `from sample2 import multiply`: `sample2`モジュールから`multiply`関数をインポートし、掛け算を行います。
- 変数`x`と`y`にはそれぞれ5と3を代入し、その和と積を計算して表示します。

#### ユースケース
- 他のモジュールに依存しているため、加算と掛け算を同時に行う複合的な操作が必要な場合に特に有効です。例えば、数値演算を行うより大規模な計算処理や、異なる計算手法を組み合わせる際に使用されます。

### まとめ
- `sample1.py`は加算の機能に特化したスクリプト、`sample2.py`は掛け算の機能を提供します。
- `sample3.py`は、これら二つの機能を統合したスクリプトであり、より高いレベルの抽象化を提供します。
- それぞれのスクリプトは、特定の数値演算ニーズに応じて使い分けることができ、操作のシンプルさとモジュール性を実現しています。

## 6. センシティブ情報の取り扱い


### 概要
本セクションでは、`sample.pfx`ファイルの特性及びその取り扱いに関するセキュリティ対策やデータ保護方針について記述します。このファイルにはセンシティブな情報が含まれており、その適切な管理が情報漏洩リスクを軽減するために極めて重要です。具体的な内容については記述せず、センシティブ情報を保護するためのベストプラクティスを紹介します。

### センシティブ情報の特性
センシティブ情報は、機密性が求められる情報であり、無許可のアクセスまたは不適切な利用が発生すると、個人や組織に重大な影響を及ぼす可能性があります。`sample.pfx`ファイルにはそのような情報が有する特性が反映されています。

### セキュリティ対策
#### アクセス制御
- **最小権限の原則**: センシティブ情報にアクセスするユーザーやプロセスには、必要最小限の権限のみを付与するべきです。この原則に従うことで、不正アクセスのリスクを低減します。

#### データの暗号化
- **暗号化技術の適用**: センシティブ情報は、保存時および転送時に暗号化されるべきです。これにより、情報が流出した場合でも情報の内容が保護されるため、安全性が向上します。

#### 定期的なセキュリティ監査
- **監査の実施**: センシティブ情報の取り扱いに関するポリシーや手順の遵守を確保するために、定期的な監査を行うことが必要です。これにより、潜在的な脆弱性を早期に発見し、対策を講じることが可能となります。

#### 安全なストレージと廃棄
- **ストレージの選定**: センシティブ情報を保管するストレージは、高い安全性を確保できるものを選定すべきです。また、使用しなくなったセンシティブ情報は、安全に削除し、関連データが復元されないようにするための手続きを行います。

### データ保護方針
- **情報セキュリティポリシーの策定**: センシティブ情報を保護するための組織全体での一貫したポリシーを策定し、従業員に対する教育を行うことが重要です。ポリシーには、センシティブ情報の取り扱いに関する具体的な手順や責任を明記します。

### ベストプラクティス
1. **強固なパスワード管理**: センシティブ情報が格納されたファイルやシステムへのアクセスには、強力なパスワードを使用し、定期的に変更することが推奨されます。
2. **多要素認証の導入**: アクセス管理を強化するために、多要素認証を実装し、認証プロセスのセキュリティを向上させます。
3. **ユーザーの教育とトレーニング**: センシティブ情報の取り扱いに関する教育を従業員に実施し、意識を高めることで、ヒューマンエラーによるリスクを軽減します。

以上のように、`sample.pfx`ファイルを安全に取り扱うためには、セキュリティ対策やデータ保護方針をしっかりと策定し、それに従うことが不可欠です。

## 7. 今後の展望


本セクションでは、現行の機能に基づき、将来的に追加が考えられる機能や改善点について示します。具体的なデータやフィードバックを基に、実現可能な技術的アイデアを提案し、今後の開発方針を明確にします。

### 1. 拡張機能の提案

#### 1.1 演算機能の追加
現在のプログラムは、加算(`add`)および乗算(`multiply`)の基本的な機能を提供しています。将来的には、以下のような数学的演算の機能を追加することを検討します。

- **減算機能**: `subtract(a, b)`関数を実装し、2つの数の差を計算できるようにします。
- **除算機能**: `divide(a, b)`関数を実装し、除算結果を扱うことにより、ユーザーがより多様な計算を行えるようにします。

#### 1.2 エラーハンドリングの強化
現行のコードでは、関数の引数として渡される値に対する型チェックやエラーハンドリングが未実装です。今後は以下の点を検討します。

- **型チェック**: 引数が数値型であるかどうかを確認し、そうでない場合は適切なエラーメッセージを出力します。
- **除算のチェック**: 除算機能においては、ゼロ除算を防ぐためのバリデーションを追加し、問題が発生した際にはユーザーに通知します。

### 2. ユーザーインタフェースの改善

#### 2.1 CLI（コマンドラインインターフェース）の強化
現行のスクリプトはシンプルな入力と出力を提供していますが、より直感的なインタラクションを実現するために、以下の改善を考えています。

- **メニューシステムの実装**: ユーザーが実行したい演算を選択して実行できるようにするメニューを構築します。
- **結果のフォーマット**: 数値の計算結果を整形し、ユーザーに視覚的にわかりやすく表示する機能を追加します。

### 3. ドキュメントとテストの充実化

#### 3.1 自動テストの導入
現行のコードにはテストが未整備です。以下の施策を通じて、信頼性を高めることを目指します。

- **ユニットテストの作成**: 各演算関数に対するユニットテストを構築し、期待される結果が得られることを確認します。
- **テストカバレッジの評価**: テストカバレッジツールを使用して、未テストのコードパスを明確にし、全体のテスト品質を向上させます。

#### 3.2 ドキュメントの整備
コードの可読性や他の開発者による利用を向上させるため、詳細なドキュメントを用意します。

- **APIドキュメント**: 各関数の使用法を詳細に記載したドキュメントを生成します。
- **チュートリアルの作成**: 新しいユーザーがアプリケーションの使用を開始しやすいように、初心者向けのチュートリアルを作成します。

### 4. 結論

本セクションでは、将来的に考えられる機能追加や改善策について提案しました。これらのアイデアは、ユーザー体験の向上やシステムの安定性の強化に寄与すると考えています。今後の開発において、これらの方向性を踏まえて進めていくことが重要です。

