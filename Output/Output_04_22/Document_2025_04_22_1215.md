# コードサンプルシステム仕様書

## 目次
1. [はじめに](#1-はじめに)
2. [システムの概要](#2-システムの概要)
3. [ファイル構成](#3-ファイル構成)

---

## 1. はじめに


本仕様書は、画像ファイルから情報を抽出するためのシステムに関するものであり、各処理フローやその機能について詳述しています。このシステムは、業務上の重要な課題である「情報抽出の非効率性」に対応することを目的としています。特に、多くの企業が抱える問題として、手作業でのデータ処理や情報抽出は時間がかかるだけでなく、人的ミスも誘発しやすいという事実があります。

例えば、請求書の確認や商品情報の整理を手作業で行なっている企業では、複数の画像から情報を抽出する際に、各データを一つずつ手動で入力する必要があり、これが業務のボトルネックとなっています。このプロセスが自動化されない限り、業務効率は大きく向上しないままとなるでしょう。 

本システムでは、画像から必要な情報を自動的に抽出し、これをExcel形式で出力することができるため、業務上のニーズに応える内容となっています。各種OCR処理を用いて画像から情報を取得し、抽出したデータを整形するための一連のスクリプトを実装しています。具体的な処理としては、画像の向きを自動で修正したり、必要な情報を検索する機能が含まれています。最後には、得られた情報をExcelフォーマットに整形して出力し、ユーザーが容易に利用できる形で提供します。

また、データ抽出及び整理のために「AzureのDocument Intelligence」機能を利用し、高精度な情報識別も行います。これにより、業務上の情報取得プロセスが一層効率化され、多くの企業が直面する課題に対する解決策となると期待されています。 

このように、本システムの開発は、業務上のニーズと課題に基づいており、情報抽出を迅速化し、作業効率を向上させることを目的としています。また、データ整形を自動化することでヒューマンエラーを削減し、信頼性の高い業務運営が実現できるシステムです。

## 2. システムの概要


本システムは、OCR（光学式文字認識）技術を用いて画像ファイルから情報を効率的に抽出し、最終的にはエクセル形式で出力する機能を備えています。このプロセスは、さまざまな画像フォーマットに対応し、精度の高い情報抽出を実現するために複数のステップで構成されています。以下に、システム全体の機能とそのユーザーへの価値を示します。

### 1. OCR処理の自動化
画像フォルダ内の全ての画像に対してOCR処理を行う「1_ocr_only.py」と「4_ocr_all.py」により、手動作業を軽減します。この処理によって、画像に含まれるテキスト情報を自動的に認識し、デジタルデータとして扱うことができます。

### 2. 画像前処理
#### 2.1 方向調整
「2_change_direction.py」および「3_make_flat.py」では、OCR処理を行う前に画像の方向を統一します。具体的には、特定のキーワードリストに基づいて画像を回転させ、OCRの精度を向上させるための処理を行います。これにより、認識の正確性が向上し、より信頼性の高いデータが得られます。

#### 2.2 平面化
画像を水平にする処理を行うことで、スキュー（傾き）を修正し、OCR技術の適用範囲を広げます。このプロセスは、情報の抽出において重要なステップです。

### 3. 情報抽出
「5_search_all.py」ではOCR処理により得られたデータから特定の情報（項目名、単価、個数、金額など）を抽出します。このプロセスにはマッチングアルゴリズムを使用しており、高精度なデータの取得が可能です。

### 4. データのエクセル出力
「6_write_excel.py」では、抽出した情報をExcelファイルに整理して出力します。DataFrameを使用することで、データの整形が容易になり、ダウンロード可能なレポートを提供します。

### 5. ドキュメントインテリジェンスの活用
「7_document_intelligence.py」と「8_1_search_base_ocr.py」では、AzureのDocument Intelligenceを利用して、OCRに基づいた情報認識を行います。この技術により、企業では複雑な書類のデータをより効率的に処理できるようになります。

### 6. 統合と最終出力
「9_connect_base.py」および「10_1_merge_excel.py」、「10_2_merge_excel.py」を通じて、複数のExcelファイルから得られた情報を統合し、税額の精度を向上させるための統一ボックスの詳細を検索します。最終処理「11_merge_excel.py」において、請求書番号や金額を求めることで、出力結果の信頼性を確保します。

### ユーザーへの価値
本システムは、手動での情報入力を削減し、精度の高い情報抽出を自動化することで、ユーザーの作業時間を大幅に短縮します。また、得られたデータを基に迅速な意思決定をサポートし、業務の効率化を実現します。特に、ビジネスプロセスの改善やコスト削減に貢献する価値があります。

## 3. ファイル構成


このセクションでは、システムで使用される主要なファイルの一覧と、その役割について詳しく説明します。以下は、システムに関連するファイルの構成です。

### 1. 設定ファイル

#### パス: `code/code_sample_python/config.yml`
- **役割**: このYAML形式の設定ファイルは、アプリケーションの設定情報を定義します。一般的には、データベース接続情報、APIキー、アプリケーションの動作モードなど、プログラムが実行される際の環境設定を含むことが予想されます。YAMLの特徴として、インデントによるネストしたデータ構造の表現が可能であり、人間にとって読みやすい形式です。プログラムによって読み込まれ、必要な設定情報を提供します。

### 2. OCR処理の主なロジックを担うPythonスクリプト

#### パス: `code/code_sample_python/LargeFile.py`
このファイルには、たくさんのOCR処理を実行するためのスクリプトが保存されています。各スクリプトの機能については以下の通りです。

1. **1_ocr_only.py**
   - 画像フォルダにあるすべての画像に対してOCR処理を実行します。描画は行わず、サブディレクトリを探索し、特定の条件に沿った出力フォルダを作成します。処理には`function_ocr.ocr_only_function`を使用しています。

2. **2_change_direction.py**
   - 横向きの画像を回転させる処理を行います。OCRで得られた情報をもとに、指定されたキーワードリストに基づいて、画像を適切な角度に回転させます。

3. **3_make_flat.py**
   - 画像を水平にするためのスクリプトで、aspose.ocrを用いてスキュー角度を計算し、画像を正しい向きに回転させます。

4. **4_ocr_all.py**
   - 画像が平坦かつ水平になった後、OCR処理を行い、認識結果やバウンディングボックスを描画します。このスクリプトも再度サブディレクトリを探索し、OCR結果を生成します。

5. **5_search_all.py**
   - OCRから得た画像情報を解析し、特定の項目名、単価、個数、金額などを抽出してターミナルに出力します。主にマッチングアルゴリズムを使用します。

6. **6_write_excel.py**
   - OCRで取得した情報を整理し、Excelファイルに書き込みます。DataFrameを活用してデータを構造化し、出力を行います。

7. **7_document_intelligence.py**
   - AzureのDocument Intelligence機能を使用し、情報を識別する処理を行います。OCR技術と組み合わせて情報を取得します。

8. **8_1_search_base_ocr.py**
   - Azure Document Intelligenceと連携し、情報識別の精度を向上させるための処理を実装します。

9. **9_connect_base.py**
   - 複数のExcelファイルを統合し、最終出力をまとめる役割を担います。

10. **10_1_merge_excel.py と 10_2_merge_excel.py**
    - 複数のファイルからの情報を統合し、税額の計算精度を高めるために、特定のボックスの詳細を検索します。

11. **11_merge_excel.py**
    - Azure Document Intelligenceから得られた結果を基に、請求書番号や金額を計算する最終処理を行います。

### 3. 補助的なスクリプト

#### パス: `code/code_sample_python/sample3.py`
- **役割**: このスクリプトは、他のモジュールから関数をインポートし、与えられた数値に対する和と積を計算するシンプルなプログラムです。 
- **主な機能**:
  - `sample1`からの`add`関数を使用して2つの数の和を計算します。
  - `sample2`からの`multiply`関数を使用して2つの数の積を計算します。

#### パス: `code/code_sample_python/sample2.py`
- **役割**: `multiply`関数を定義しており、二つの数値を引数に取り、それらの積を計算して返します。この関数は、シンプルな掛け算の演算処理を提供し、整数や浮動小数点数などの数値データに適用可能です。

これらのファイルは、システム全体の機能を支える重要な役割を果たし、OCR処理からデータの管理、最終的な出力に至るまで、各々が特定のタスクを担っています。

