000010******************************************************************
000020*            IDENTIFICATION      DIVISION                        *
000030******************************************************************
000040 IDENTIFICATION          DIVISION.
000050 PROGRAM-ID.             YAI721.
000060 AUTHOR.                 池田　幸子
000070*
000080*----------------------------------------------------------------*
000090*         施術の事実【ﾃﾞｰﾀ作成】柔+ｳｨﾝﾄﾞｳｽﾞ版
000100*         MED = YAI720
000110*----------------------------------------------------------------*
000120 DATE-WRITTEN.           2013-07-02
000130 DATE-COMPILED.          2013-07-02
000140*----------------------------------------------------------------*
000150******************************************************************
000160*            ENVIRONMENT         DIVISION                        *
000170******************************************************************
000180 ENVIRONMENT             DIVISION.
000190 CONFIGURATION           SECTION.
000200 SOURCE-COMPUTER.        FMV-DESKPOWER-TS.
000210 OBJECT-COMPUTER.        FMV-DESKPOWER.
000220 SPECIAL-NAMES.          CONSOLE  IS  CONS
000230                         SYSERR   IS  MSGBOX.
000240 INPUT-OUTPUT            SECTION.
000250 FILE-CONTROL.
000370     SELECT  元号マスタ      ASSIGN      TO        GENGOUL
000380                             ORGANIZATION             IS  INDEXED
000390                             ACCESS MODE              IS  DYNAMIC
000400                             RECORD KEY               IS  元−元号区分
000410                             FILE STATUS              IS  状態キー
000420                             LOCK        MODE         IS  AUTOMATIC.
000260     SELECT  受診者情報Ｆ    ASSIGN      TO        JUSINJL
000270                             ORGANIZATION             IS  INDEXED
000280                             ACCESS MODE              IS  DYNAMIC
000290                             RECORD KEY               IS  受−施術和暦年月
000300                                                          受−患者コード
000310                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000320                                                          受−患者カナ
000330                                                          受−患者コード
000340                             ALTERNATE RECORD KEY     IS  受−患者コード
000350                                                          受−施術和暦年月
000360                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000370                                                          受−保険種別
000380                                                          受−保険者番号
000390                                                          受−患者コード
000400                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000410                                                          受−公費種別
000420                                                          受−費用負担者番号
000430                                                          受−患者コード
000440                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000450                                                          受−助成種別
000460                                                          受−費用負担者番号助成
000470                                                          受−患者コード
000480                             ALTERNATE RECORD KEY     IS  受−請求和暦年月
000490                                                          受−施術和暦年月
000500                                                          受−患者コード
000510                             FILE STATUS              IS  状態キー
000520                             LOCK        MODE         IS  AUTOMATIC.
000130     SELECT  レセプトＦ      ASSIGN      TO        RECEPTL
000140                             ORGANIZATION             IS  INDEXED
000150                             ACCESS MODE              IS  DYNAMIC
000160                             RECORD KEY               IS  レセ−施術和暦年月
000170                                                          レセ−患者コード
000180                                                          レセ−レセ種別
000190                             ALTERNATE RECORD KEY     IS  レセ−患者コード
000200                                                          レセ−施術和暦年月
000210                                                          レセ−レセ種別
000220                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000230                                                          レセ−施術和暦年月
000240                                                          レセ−患者コード
000250                                                          レセ−レセ種別
000260                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000270                                                          レセ−レセ種別
000280                                                          レセ−請求保険者番号
000290                                                          レセ−患者コード
000300                                                          レセ−施術和暦年月
000310                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000320                                                          レセ−請求保険者番号
000330                                                          レセ−患者コード
000340                                                          レセ−レセ種別
000350                                                          レセ−施術和暦年月
000360                             FILE STATUS              IS  状態キー
000370                             LOCK        MODE         IS  AUTOMATIC.
000690     SELECT  会計データＦ    ASSIGN      TO        KAIKEIL
000700                             ORGANIZATION             IS  INDEXED
000710                             ACCESS MODE              IS  DYNAMIC
000089                             RECORD KEY               IS  会−施術和暦年月日
000090                                                          会−患者コード
000092                             ALTERNATE RECORD KEY     IS  会−患者コード
000093                                                          会−施術和暦年月日
000790                             FILE STATUS              IS  状態キー
000800                             LOCK        MODE         IS  AUTOMATIC.
           SELECT  負傷データＦ    ASSIGN      TO        HUSYOUL
                                   ORGANIZATION             IS  INDEXED
                                   ACCESS MODE              IS  DYNAMIC
                                   RECORD KEY               IS  負−施術和暦年月
                                                                負−患者コード
                                   ALTERNATE RECORD KEY     IS  負−患者コード
                                                                負−施術和暦年月
                                   FILE STATUS              IS  状態キー
                                   LOCK        MODE         IS  AUTOMATIC.
           SELECT  施術記録Ｆ      ASSIGN      TO      SEKIROKL
                                   ORGANIZATION        IS  INDEXED
                                   ACCESS MODE         IS  DYNAMIC
                                   RECORD KEY          IS  施記−施術和暦年月日
                                                           施記−患者コード
                                   ALTERNATE RECORD KEY IS 施記−患者コード
                                                           施記−施術和暦年月日
                                   FILE STATUS              IS  状態キー
                                   LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル１  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7211L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作１−施術和暦年月日
000610                                                          作１−患者コード
000910                             ALTERNATE RECORD KEY     IS  作１−施術和暦年月日
                                                                作１−患者カナ
                                                                作１−患者コード
000910                             ALTERNATE RECORD KEY     IS  作１−患者コード
                                                                作１−施術和暦年月日
000910                             ALTERNATE RECORD KEY     IS  作１−患者カナ
                                                                作１−患者コード
                                                                作１−施術和暦年月日
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル２  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7212L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作２−施術和暦年月
000610                                                          作２−患者コード
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000640******************************************************************
000650*                      DATA DIVISION                             *
000660******************************************************************
000670 DATA                    DIVISION.
000680 FILE                    SECTION.
001500*                           ［ＲＬ＝  １２８］
001510 FD  元号マスタ          BLOCK   CONTAINS   1   RECORDS.
001520     COPY GENGOU          OF  XFDLIB  JOINING   元   AS  PREFIX.
000690*                           ［ＲＬ＝  ３２０］
000700 FD  受診者情報Ｆ        BLOCK   CONTAINS   1   RECORDS.
000710     COPY JUSINJ          OF  XFDLIB  JOINING   受   AS  PREFIX.
      *                          ［ＲＬ＝  １５３６］
       FD  レセプトＦ          BLOCK   CONTAINS   1   RECORDS.
           COPY RECEPT          OF  XFDLIB  JOINING   レセ  AS  PREFIX.
001060*                           ［ＲＬ＝  ５１２］
001070 FD  会計データＦ        BLOCK   CONTAINS   1   RECORDS.
001080     COPY KAIKEI     OF  XFDLIB  JOINING   会   AS  PREFIX.
      *                           ［ＲＬ＝  ２５６］
       FD  施術記録Ｆ          BLOCK   CONTAINS   1   RECORDS.
          COPY SEKIROK         OF  XFDLIB  JOINING   施記 AS  PREFIX.
      *                           ［ＲＬ＝  １２８］
       FD  負傷データＦ        BLOCK   CONTAINS   1   RECORDS.
           COPY HUSYOU          OF  XFDLIB  JOINING   負   AS  PREFIX.
001310*****************
001320* 作業ファイル１ *
001330*****************
001340*                         ［ＲＬ＝  １６０］
001350 FD  作業ファイル１ RECORD  CONTAINS 160 CHARACTERS.
001360 01 作１−レコード.
001370    03 作１−レコードキー.
001535       05 作１−施術和暦年月日.
001536          07 作１−施術和暦               PIC 9.
001537          07 作１−施術年月.
001538             09 作１−施術年              PIC 9(2).
001539             09 作１−施術月              PIC 9(2).
001540          07 作１−施術日                 PIC 9(2).
001460       05 作１−患者コード.
001470          07 作１−患者番号                PIC 9(6).
001480          07 作１−枝番                    PIC X(1).
001490    03 作１−レコードデータ.
             05 作１−患者カナ                   PIC X(50).
             05 作１−患者氏名                   PIC X(50).
             05 作１−料金.
001550          07 作１−初検金額                PIC 9(5).
                07 作１−加算金額                PIC 9(5).
001550          07 作１−整復金額                PIC 9(5).
001550          07 作１−後療金額                PIC 9(5).
001550          07 作１−罨法金額                PIC 9(5).
001550          07 作１−電療金額                PIC 9(5).
001551          07 作１−費用額                  PIC 9(5).
001551          07 作１−一部負担金              PIC 9(5).
001500       05 FILLER                           PIC X(6).
000920*
001340*                         ［ＲＬ＝  １２８］
001350 FD  作業ファイル２ RECORD  CONTAINS 128 CHARACTERS.
001360 01 作２−レコード.
001370    03 作２−レコードキー.
001535       05 作２−施術和暦年月.
001536          07 作２−施術和暦                PIC 9.
001537          07 作２−施術年月.
001538             09 作２−施術年               PIC 9(2).
001539             09 作２−施術月               PIC 9(2).
001460       05 作２−患者コード.
001470          07 作２−患者番号                PIC 9(6).
001480          07 作２−枝番                    PIC X(1).
001490    03 作２−レコードデータ.
             05 作２−初検計                     PIC 9(5).
001550       05 作２−加算計                     PIC 9(5).
001550       05 作２−整復計                     PIC 9(5).
001550       05 作２−後療計                     PIC 9(5).
001550       05 作２−罨法計                     PIC 9(5).
001550       05 作２−電療計                     PIC 9(5).
001551       05 作２−費用計                     PIC 9(6).
001551       05 作２−負担計                     PIC 9(5).
             05 作２−月合計.
001551          07 作２−実日数合計              PIC 9(2).
001551          07 作２−費用合計                PIC 9(7).
001551          07 作２−負担合計                PIC 9(6).
001551          07 作２−請求合計                PIC 9(7).
001500       05 FILLER                           PIC X(53).
      *
000930*----------------------------------------------------------------*
000940******************************************************************
000950*                WORKING-STORAGE SECTION                         *
000960******************************************************************
000970 WORKING-STORAGE         SECTION.
000980 01 キー入力                           PIC X    VALUE SPACE.
000990 01 状態キー                           PIC X(2) VALUE SPACE.
001000 01 終了フラグ                         PIC X(3) VALUE SPACE.
002120 01 終了フラグ２                       PIC X(3) VALUE SPACE.
002120 01 終了フラグ３                       PIC X(3) VALUE SPACE.
001010 01 ファイル名                         PIC N(2) VALUE SPACE.
001180 01 実行キーＷ                         PIC X(4) VALUE SPACE.
       01 施術記録有Ｗ                       PIC X(3) VALUE SPACE.
001540 01 継続フラグ                         PIC X(3) VALUE SPACE.
001540 01 対象フラグ                         PIC X(3) VALUE SPACE.
001891 01 部位ＣＮＴ                         PIC 9    VALUE ZERO.
001891 01 カウンタ                           PIC 9    VALUE ZERO.
001020* **************
001030* * 項目待避用 
001040* **************
001050 01 待避項目ＷＲ.
001060    03 施術和暦年月ＷＲ.
001070       05 施術和暦ＷＲ                 PIC 9(1) VALUE ZERO.
001080       05 施術年ＷＲ                   PIC 9(2) VALUE ZERO.
001090       05 施術月ＷＲ                   PIC 9(2) VALUE ZERO.
001090    03 施術日ＷＲ                      PIC 9(2) VALUE ZERO.
          03 最終通院月Ｗ                    PIC 9(2) VALUE ZERO.
001090    03 最終通院日Ｗ                    PIC 9(2) VALUE ZERO.
          03 受理月Ｗ                        PIC 9(2) VALUE ZERO.
001090    03 受理日Ｗ                        PIC 9(2) VALUE ZERO.
001090    03 開始日ＷＰ                      PIC 9(2) VALUE ZERO.
001090    03 終了日ＷＰ                      PIC 9(2) VALUE ZERO.
001060    03 開始和暦年月日ＷＲ.
001060       05 開始和暦年月ＷＲ.
001070          07 開始和暦ＷＲ              PIC 9(1) VALUE ZERO.
001080          07 開始年ＷＲ                PIC 9(2) VALUE ZERO.
001090          07 開始月ＷＲ                PIC 9(2) VALUE ZERO.
001090       05 開始日ＷＲ                   PIC 9(2) VALUE ZERO.
001060    03 終了和暦年月日ＷＲ.
001060       05 終了和暦年月ＷＲ.
001070          07 終了和暦ＷＲ              PIC 9(1) VALUE ZERO.
001080          07 終了年ＷＲ                PIC 9(2) VALUE ZERO.
001090          07 終了月ＷＲ                PIC 9(2) VALUE ZERO.
001090       05 終了日ＷＲ                   PIC 9(2) VALUE ZERO.
001100    03 種別区分ＷＲ                    PIC X(4) VALUE SPACE.
001110    03 保険種別ＷＲ                    PIC 9(2) VALUE ZERO.
001120    03 患者コードＷＲ.
001130       05 患者番号ＷＲ                 PIC 9(6) VALUE ZERO.
001140       05 枝番ＷＲ                     PIC X(1) VALUE SPACE.
001150    03 本人家族区分ＷＲ                PIC 9(1) VALUE ZERO.
      *
          03 印刷条件ＷＲ                    PIC 9(2) VALUE ZERO.
001160*
001170 01 公費負担者番号Ｗ.
001180    03 法別番号Ｗ                      PIC X(2) VALUE SPACE.
001190    03 FILLER                          PIC X(8) VALUE SPACE.
001530 01 退避項目ＧＷ.
001540   03 レセプト種類Ｗ                 PIC X(4).
001550   03 レセプト種類ＧＷ               PIC X(4).
001560   03 レセプト種別ＧＷ               PIC 9(2).
001580*
001590 01 明細.
001600    03 初検料ＷＲ                    PIC 9(4)  VALUE ZERO.
001610    03 初検加算料ＷＲ                PIC 9(4)  VALUE ZERO.
001620    03 休日ＷＲ                      PIC 9     VALUE ZERO.
001630    03 深夜ＷＲ                      PIC 9     VALUE ZERO.
001640    03 時間外ＷＲ                    PIC 9     VALUE ZERO.
001650    03 診療時ＷＲ                    PIC 9(2)  VALUE ZERO.
001660    03 診療分ＷＲ                    PIC 9(2)  VALUE ZERO.
          03 相談料ＷＲ                    PIC 9(4)  VALUE ZERO.
001670    03 再検料ＷＲ                    PIC 9(4)  VALUE ZERO.
001680    03 往療夜間ＷＲ                  PIC 9     VALUE ZERO.
001690    03 往療難路ＷＲ                  PIC 9     VALUE ZERO.
001700    03 往療暴風ＷＲ                  PIC 9     VALUE ZERO.
001710    03 往療回数ＷＲ                  PIC 9(2)  VALUE ZERO.
001720    03 往療距離ＷＲ                  PIC 9(3)V9 VALUE ZERO.
001730    03 往療料ＷＲ                    PIC 9(6)  VALUE ZERO.
001740    03 往療加算料ＷＲ                PIC 9(5)  VALUE ZERO.
001750    03 電罨料ＷＲ                    PIC 9(4)  VALUE ZERO.
001760    03 一部負担金ＷＲ                PIC 9(5)  VALUE ZERO.
001760    03 負担金詳細ＷＲ                PIC 9(5)  VALUE ZERO.
003530    03 金属副子加算料ＷＲ            PIC 9(5)  VALUE ZERO.
003140    03 運動後療料ＷＲ                PIC 9(4)  VALUE ZERO.
001770    03 施術情報提供料ＷＲ            PIC 9(6)  VALUE ZERO.
001780    03 部位Ｗ                        OCCURS 5.
001790       05 初回処置料ＷＲ             PIC 9(4)  VALUE ZERO.
001800       05 後療料ＷＲ                 PIC 9(4)  VALUE ZERO.
001810       05 冷罨料ＷＲ                 PIC 9(4)  VALUE ZERO.
001820       05 温罨料ＷＲ                 PIC 9(4)  VALUE ZERO.
001830       05 電療料ＷＲ                 PIC 9(4)  VALUE ZERO.
001840       05 部位計ＷＲ                 PIC 9(4)  VALUE ZERO.
001850       05 金属ＷＲ                   PIC 9     VALUE ZERO.
001860    03 日数ＷＲ                      PIC 9(2)  OCCURS 5 VALUE ZERO.
001870    03 冷罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
001880    03 冷罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
001890    03 冷罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
001900    03 冷罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
001910    03 冷罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
001890    03 冷罨法料５０ＷＲ              PIC 9(4)  VALUE ZERO.
001900    03 冷罨法料５２ＷＲ              PIC 9(4)  VALUE ZERO.
001900    03 冷罨法料５５ＷＲ              PIC 9(4)  VALUE ZERO.
001910    03 冷罨法料５８ＷＲ              PIC 9(4)  VALUE ZERO.
001920    03 温罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
001930    03 温罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
001940    03 温罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
001950    03 温罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
001960    03 温罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
001940    03 温罨法料５０ＷＲ              PIC 9(4)  VALUE ZERO.
001950    03 温罨法料５２ＷＲ              PIC 9(4)  VALUE ZERO.
001950    03 温罨法料５５ＷＲ              PIC 9(4)  VALUE ZERO.
001960    03 温罨法料５８ＷＲ              PIC 9(4)  VALUE ZERO.
001970    03 電療料３０ＷＲ                PIC 9(4)  VALUE ZERO.
001980    03 電療料３８ＷＲ                PIC 9(4)  VALUE ZERO.
001990    03 電療料４０ＷＲ                PIC 9(4)  VALUE ZERO.
002000    03 電療料４５ＷＲ                PIC 9(4)  VALUE ZERO.
002010    03 電療料４８ＷＲ                PIC 9(4)  VALUE ZERO.
001990    03 電療料５０ＷＲ                PIC 9(4)  VALUE ZERO.
002000    03 電療料５２ＷＲ                PIC 9(4)  VALUE ZERO.
002000    03 電療料５５ＷＲ                PIC 9(4)  VALUE ZERO.
002010    03 電療料５８ＷＲ                PIC 9(4)  VALUE ZERO.
002020    03 後療料３０ＷＲ                PIC 9(4)  VALUE ZERO.
002030    03 後療料３８ＷＲ                PIC 9(4)  VALUE ZERO.
002040    03 後療料４０ＷＲ                PIC 9(4)  VALUE ZERO.
002050    03 後療料４５ＷＲ                PIC 9(4)  VALUE ZERO.
002060    03 後療料４８ＷＲ                PIC 9(4)  VALUE ZERO.
002040    03 後療料５０ＷＲ                PIC 9(4)  VALUE ZERO.
002050    03 後療料５２ＷＲ                PIC 9(4)  VALUE ZERO.
002050    03 後療料５５ＷＲ                PIC 9(4)  VALUE ZERO.
002060    03 後療料５８ＷＲ                PIC 9(4)  VALUE ZERO.
002070    03 冷罨料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002080    03 温罨料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002090    03 電療料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002100*
       01 集計Ｗ.
001600    03 初検計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 加算計Ｗ                      PIC 9(5)  VALUE ZERO.
001600    03 整復計Ｗ                      PIC 9(5)  VALUE ZERO.
001800    03 後療計Ｗ                      PIC 9(5)  VALUE ZERO.
001810    03 罨法計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 電療計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 費用計Ｗ                      PIC 9(5)  VALUE ZERO.
001760    03 一部負担金計Ｗ                PIC 9(5)  VALUE ZERO.
002149** レセ下段の日付区分用 (0:最終通院日、1:月末日、9:印字なし)
002150 01 レセプト日付区分Ｗ                 PIC 9 VALUE ZERO.
002151 01 レセプト患者日付区分Ｗ             PIC 9 VALUE ZERO.
002617** 月末日用
002618 01 施術西暦年Ｗ                       PIC 9(4)  VALUE ZERO.
002619 01 商Ｗ                               PIC 9(3)  VALUE ZERO.
002620 01 余Ｗ                               PIC 9(3)  VALUE ZERO.
002621*
001200******************************************************************
001210*                          連結項目                              *
001220******************************************************************
001230*
003080****************
003090* 画面入力情報 *
003100****************
003110 01 連入−入力データＹＡＩ７２０ IS EXTERNAL.
003120    03 連入−開始和暦年月日.
003130       05 連入−開始和暦                  PIC 9(1).
003140       05 連入−開始年                    PIC 9(2).
003150       05 連入−開始月                    PIC 9(2).
003150       05 連入−開始日                    PIC 9(2).
003120    03 連入−終了和暦年月日.
003130       05 連入−終了和暦                  PIC 9(1).
003140       05 連入−終了年                    PIC 9(2).
003150       05 連入−終了月                    PIC 9(2).
003150       05 連入−終了日                    PIC 9(2).
003170    03 連入−保険種別                     PIC 9(2).
003180    03 連入−本人家族区分                 PIC 9(1).
003190    03 連入−患者コード.
003200       05 連入−患者番号                  PIC 9(6).
003210       05 連入−枝番                      PIC X(1).
          03 連入−印刷条件                     PIC 9(2).
006550*
006560 01 連レ−キー IS EXTERNAL.
006570    03 連レ−保険種別                     PIC 9(2).
006550*
003110 01 連印−印刷データＹＡＩ７２１ IS EXTERNAL.
          03 連印−前期高齢                     PIC 9(1).
          03 連印−負担割合                     PIC 9(2).
003170    03 連印−金属副子                     PIC 9(5).
003170    03 連印−大                           PIC 9(1).
003170    03 連印−中                           PIC 9(1).
003170    03 連印−小                           PIC 9(1).
003170    03 連印−情報提供                     PIC 9(5).
001390******************************************************************
001400*                      PROCEDURE  DIVISION                       *
001410******************************************************************
001420 PROCEDURE               DIVISION.
001430************
001440*           *
001450* 初期処理   *
001460*           *
001470************
001480     PERFORM 初期化.
001490************
001500*           *
001510* 主処理     *
001520*           *
001530************
001540     PERFORM 作業ファイル作成.
001550************
001560*           *
001570* 終了処理   *
001580*           *
001590************
001600     PERFORM 終了処理.
001610     MOVE ZERO TO PROGRAM-STATUS.
001620     EXIT PROGRAM.
001630*
001640*<<<<<<<<<<<<<<<<<<<<<<<<< END OF PROGRAM >>>>>>>>>>>>>>>>>>>>>>>>
001650*================================================================*
001660 初期化 SECTION.
001670*
001680     PERFORM ファイルオープン.
001690* 連結項目の待避
001700     INITIALIZE 待避項目ＷＲ.
001720     MOVE 連入−保険種別      TO 保険種別ＷＲ.
001730     MOVE 連入−患者番号      TO 患者番号ＷＲ.
001740     MOVE 連入−枝番          TO 枝番ＷＲ.
001750     MOVE 連入−開始和暦      TO 開始和暦ＷＲ.
001760     MOVE 連入−開始年        TO 開始年ＷＲ.
001770     MOVE 連入−開始月        TO 開始月ＷＲ.
001770     MOVE 連入−開始日        TO 開始日ＷＲ.
001750     MOVE 連入−終了和暦      TO 終了和暦ＷＲ.
001760     MOVE 連入−終了年        TO 終了年ＷＲ.
001770     MOVE 連入−終了月        TO 終了月ＷＲ.
001770     MOVE 連入−終了日        TO 終了日ＷＲ.
001780     MOVE 連入−本人家族区分  TO 本人家族区分ＷＲ.
      *
           MOVE 連入−印刷条件      TO 印刷条件ＷＲ.

001790*================================================================*
001800 ファイルオープン SECTION.
001810*
012140     OPEN INPUT   元号マスタ
012150         MOVE NC"元号" TO ファイル名.
012160         PERFORM オープンチェック.
001820     OPEN INPUT 受診者情報Ｆ.
001830         MOVE NC"受診者情報Ｆ" TO ファイル名.
001840         PERFORM オープンチェック.
007870     OPEN INPUT レセプトＦ.
007880         MOVE NC"レセ"         TO ファイル名.
007890         PERFORM オープンチェック.
003060     OPEN INPUT 会計データＦ.
003070         MOVE NC"会計" TO ファイル名.
003080         PERFORM オープンチェック.
           OPEN INPUT 負傷データＦ.
               MOVE NC"負傷データＦ" TO ファイル名.
               PERFORM オープンチェック.
           OPEN INPUT 施術記録Ｆ.
               MOVE NC"施術記録Ｆ"   TO ファイル名.
               PERFORM オープンチェック.
001850*================================================================*
001860 オープンチェック SECTION.
001870*
001880     IF 状態キー  NOT =  "00"
001890         DISPLAY ファイル名 NC"Ｆオープンエラー" UPON CONS
001900         DISPLAY NC"状態キー：" 状態キー         UPON CONS
001910         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
001920                                                 UPON CONS
003131*-----------------------------------------*
003132         CALL "actcshm"  WITH C LINKAGE
003133*-----------------------------------------*
001930         ACCEPT  キー入力 FROM CONS
001940         PERFORM ファイル閉鎖
001950         MOVE 99 TO PROGRAM-STATUS
001960         EXIT PROGRAM.
001970*================================================================*
001980 ファイル閉鎖 SECTION.
001990*
002000     CLOSE 元号マスタ   受診者情報Ｆ レセプトＦ
                 会計データＦ 負傷データＦ 施術記録Ｆ.
002010*================================================================*
002020 終了処理 SECTION.
002030*
002040     PERFORM ファイル閉鎖.
002050*================================================================*
002060 エラー表示 SECTION.
002070*
002080     DISPLAY NC"状態キー" 状態キー  UPON CONS.
002090     DISPLAY NC"５ファイル書込エラー：" ファイル名   UPON CONS.
002100     DISPLAY NC"システム管理者に連絡してください"  UPON CONS.
002110     DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"                                                                    UPON CONS.
003131*-----------------------------------------*
003132     CALL "actcshm"  WITH C LINKAGE.
003133*-----------------------------------------*
002120     ACCEPT  キー入力 FROM CONS.
002130     PERFORM ファイル閉鎖.
002140     MOVE 99 TO PROGRAM-STATUS.
002150     EXIT PROGRAM.
003960*================================================================*
003970 受診者情報Ｆ読込 SECTION.
003980*
003990     READ 受診者情報Ｆ NEXT
004000     AT END
004010         MOVE "YES" TO 終了フラグ
004020     END-READ.
002160*================================================================*
002170 作業ファイル作成 SECTION.
002180*
002210     OPEN OUTPUT 作業ファイル１
002220          MOVE NC"作１" TO ファイル名
002230          PERFORM オープンチェック
002210     OPEN OUTPUT 作業ファイル２
002220          MOVE NC"作２" TO ファイル名
002230          PERFORM オープンチェック
      *
003720     MOVE 開始和暦ＷＲ      TO 受−施術和暦.
003730     MOVE 開始年ＷＲ        TO 受−施術年.
003740     MOVE 開始月ＷＲ        TO 受−施術月.
           MOVE SPACE             TO 受−患者カナ.
           MOVE SPACE             TO 受−患者コード.
003790     START 受診者情報Ｆ   KEY IS >= 受−施術和暦年月
                                          受−患者カナ
                                          受−患者コード
003830     IF 状態キー = "00"
003840         MOVE SPACE  TO 終了フラグ
003850         PERFORM 受診者情報Ｆ読込
003860         PERFORM UNTIL ( 終了フラグ = "YES" ) OR
003870                       ( 受−施術和暦年月 > 終了和暦年月ＷＲ )
      */印刷対象条件の判定
001110                 IF ((保険種別ＷＲ     NOT = ZERO)              AND
                           (保険種別ＷＲ     NOT = 受−保険種別))     OR
HILO  */患者指定時、枝番も含まれてしまう為変更20405
001120*                    ((患者番号ＷＲ     NOT = ZERO)              AND
001120*                     (患者番号ＷＲ     NOT = 受−患者番号))     OR
      *                    ((枝番ＷＲ         NOT = SPACE)             AND
      *                     (枝番ＷＲ         NOT = 受−枝番))         OR
HILO                      ((患者番号ＷＲ     NOT = ZERO)              AND
HILO                       (患者コードＷＲ   NOT = 受−患者コード))   OR
001150                    ((本人家族区分ＷＲ NOT = ZERO)              AND
                           (本人家族区分ＷＲ NOT = 受−本人家族区分)) OR
                           (受−保険種別         = 70 OR 80 OR 90)
      */対象外
                           CONTINUE
                       ELSE
      */印刷条件ＷＲ←保留
                           MOVE "YES" TO 対象フラグ
                           IF 印刷条件ＷＲ NOT = ZERO
                               PERFORM 印刷条件判定
                           END-IF
                           IF 対象フラグ = "YES"
                               PERFORM データチェック
                               IF 実行キーＷ = "YES"
                                   MOVE 受−施術和暦年月 TO 施術和暦年月ＷＲ
                                   IF 受−施術和暦年月 = 開始和暦年月ＷＲ
                                       MOVE 開始日ＷＲ TO 開始日ＷＰ
                                   ELSE
                                       MOVE 1          TO 開始日ＷＰ
                                   END-IF
                                   IF 受−施術和暦年月 = 終了和暦年月ＷＲ
                                       MOVE 終了日ＷＲ TO 終了日ＷＰ
                                   ELSE
                                       PERFORM 月末日取得
                                       MOVE 受理日Ｗ   TO 終了日ＷＰ
                                   END-IF
003910                             PERFORM 作１レコードセット
003910                             PERFORM 作２レコードセット
                               END-IF
                           END-IF
                       END-IF
003930                 PERFORM 受診者情報Ｆ読込
003940         END-PERFORM
003950     END-IF.
002810     CLOSE 作業ファイル１ 作業ファイル２.
004030*================================================================*
004040 作１レコードセット SECTION.
004050*
008270     INITIALIZE 作１−レコード.
004130     MOVE 受−患者コード   TO 作１−患者コード.
           MOVE 受−患者カナ     TO 作１−患者カナ.
           MOVE 受−患者氏名     TO 作１−患者氏名.
           PERFORM VARYING 施術日ＷＲ FROM 開始日ＷＰ BY 1
                   UNTIL ( 施術日ＷＲ > 終了日ＷＰ )
               INITIALIZE 作１−料金
               MOVE 受−患者番号  TO 施記−患者番号
               MOVE 受−枝番      TO 施記−枝番
               MOVE 受−施術和暦  TO 施記−施術和暦
               MOVE 受−施術年    TO 施記−施術年
               MOVE 受−施術月    TO 施記−施術月
               MOVE 施術日ＷＲ    TO 施記−施術日
               READ 施術記録Ｆ
               NOT INVALID KEY
                   PERFORM レセプト呼出し１
                   PERFORM 料金情報取得
                   PERFORM 項目ごと計算
                   PERFORM 負担金詳細集計
                   PERFORM 作業ファイルセット
                   PERFORM 作１レコード書込
               END-READ
           END-PERFORM.
008240*================================================================*
008250 作業ファイルセット SECTION.
008260*
008280     MOVE 受−施術和暦       TO 作１−施術和暦.
008290     MOVE 受−施術年         TO 作１−施術年.
008300     MOVE 受−施術月         TO 作１−施術月.
008310     MOVE 施術日ＷＲ         TO 作１−施術日.
008330     MOVE 一部負担金ＷＲ     TO 作１−一部負担金.
008240*================================================================*
008250 作業２ファイルセット SECTION.
008260*
008280     MOVE 受−施術和暦       TO 作２−施術和暦.
008290     MOVE 受−施術年         TO 作２−施術年.
008300     MOVE 受−施術月         TO 作２−施術月.
           MOVE 初検計Ｗ           TO 作２−初検計.
           MOVE 加算計Ｗ           TO 作２−加算計.
           MOVE 整復計Ｗ           TO 作２−整復計.
           MOVE 後療計Ｗ           TO 作２−後療計.
           MOVE 罨法計Ｗ           TO 作２−罨法計.
           MOVE 電療計Ｗ           TO 作２−電療計.
           MOVE 費用計Ｗ           TO 作２−費用計.
           MOVE 一部負担金計Ｗ     TO 作２−負担計.
004030*================================================================*
004040 作２レコードセット SECTION.
004050*
008270     INITIALIZE 作２−レコード.
           MOVE SPACE TO 集計Ｗ.
004130     MOVE 受−患者コード   TO 作２−患者コード.
           PERFORM VARYING 施術日ＷＲ FROM 1 BY 1
                   UNTIL ( 施術日ＷＲ > 31 )
               INITIALIZE 作１−料金
               MOVE 受−患者番号  TO 施記−患者番号
               MOVE 受−枝番      TO 施記−枝番
               MOVE 受−施術和暦  TO 施記−施術和暦
               MOVE 受−施術年    TO 施記−施術年
               MOVE 受−施術月    TO 施記−施術月
               MOVE 施術日ＷＲ    TO 施記−施術日
               READ 施術記録Ｆ
               NOT INVALID KEY
                   PERFORM レセプト呼出し１
                   PERFORM 集計
                   PERFORM 負担金詳細集計
               END-READ
           END-PERFORM.
           PERFORM 作業２ファイルセット.
           PERFORM 月合計セット.
           PERFORM 作２レコード書込.
009320*================================================================*
009330 レセプト呼出し１ SECTION.
009340*
009180     MOVE 受−患者番号  TO 会−患者番号.
009190     MOVE 受−枝番      TO 会−枝番.
009200     MOVE 受−施術和暦  TO 会−施術和暦.
009210     MOVE 受−施術年    TO 会−施術年.
009220     MOVE 受−施術月    TO 会−施術月.
009230     MOVE 施術日ＷＲ    TO 会−施術日.
009240     READ 会計データＦ
           INVALID KEY
               MOVE SPACE     TO 会−レコード
           END-READ.
009710*
009720*     IF  受−助成種別 NOT = ZERO
009730*         MOVE 会−助成計算負担額 TO 一部負担金ＷＲ
009740*     ELSE
009750         MOVE 会−一部負担金     TO 一部負担金ＷＲ.
009760*     END-IF.
009710*
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           INVALID KEY
               MOVE SPACE     TO レセ−レコード
           END-READ.
009710*
010900*================================================================*
010910 料金情報取得 SECTION.
010920*
010930***********************************************
010940* 料金データセット                            *
010950***********************************************
010960*    ****************************************************************
010970*    * 料金（月毎）（負傷毎）（逓減毎）については連結項目よりセット *
010980*    ****************************************************************
           MOVE 1  TO カウンタ.
010990     MOVE 会−初検料             TO  初検料ＷＲ.
011000*
011010     MOVE 会−初検加算料         TO  初検加算料ＷＲ.
           MOVE 会−初検時相談料       TO  相談料ＷＲ.
011050     MOVE 会−再検料             TO  再検料ＷＲ.
      *
011080     MOVE 会−往療料             TO  往療料ＷＲ.
011090     MOVE 会−往療加算料         TO  往療加算料ＷＲ.
011150*
011160     MOVE 会−施術情報提供料     TO  施術情報提供料ＷＲ.
           COMPUTE 作１−初検金額 = 初検料ＷＲ + 再検料ＷＲ + 往療料ＷＲ + 往療加算料ＷＲ.
           COMPUTE 作１−加算金額 = 初検加算料ＷＲ + 相談料ＷＲ.
           MOVE 会−費用額             TO 作１−費用額.
011360*
011370*================================================================*
011380 項目ごと計算 SECTION.
011390***********************************************
011400* 料金データセット                            *
011410***********************************************
013980     PERFORM VARYING カウンタ FROM 1 BY 1
013990             UNTIL ( カウンタ > 5 )
017100         MOVE 会−初回処置料(カウンタ) TO 初回処置料ＷＲ(カウンタ)
018031     END-PERFORM.
011130*
      */運動療法、金属副子追加/180518
011140     MOVE 会−金属副子加算料     TO  金属副子加算料ＷＲ.
015100     MOVE 会−運動後療料         TO  運動後療料ＷＲ.
           IF 受−施術和暦年月 < 43006
017120        MOVE 会−初回処置料合計  TO 作１−整復金額
           ELSE
017120        COMPUTE 作１−整復金額 = 会−初回処置料合計 + 金属副子加算料ＷＲ + 運動後療料ＷＲ
           END-IF.
      *
011450     MOVE 会−後療料１     TO 後療料ＷＲ(1).
011460     MOVE 会−後療料２     TO 後療料ＷＲ(2).
011470     MOVE 会−後療料３８   TO 後療料３８ＷＲ.
011480     MOVE 会−後療料３０   TO 後療料３０ＷＲ.
011490     COMPUTE 後療料ＷＲ(3)   = 後療料３８ＷＲ   + 後療料３０ＷＲ.
011500     MOVE 会−後療料４５   TO 後療料４５ＷＲ.
011510     MOVE 会−後療料４８   TO 後療料４８ＷＲ.
011520     MOVE 会−後療料４０   TO 後療料４０ＷＲ.
011530     COMPUTE 後療料ＷＲ(4)   = 後療料４５ＷＲ   + 後療料４８ＷＲ   + 後療料４０ＷＲ.
011500     MOVE 会−後療料５２   TO 後療料５２ＷＲ.
011500     MOVE 会−後療料５５   TO 後療料５５ＷＲ.
011510     MOVE 会−後療料５８   TO 後療料５８ＷＲ.
011520     MOVE 会−後療料５０   TO 後療料５０ＷＲ.
011530     COMPUTE 後療料ＷＲ(5)   = 後療料５２ＷＲ + 後療料５５ＷＲ + 後療料５８ＷＲ + 後療料５０ＷＲ.
011530     COMPUTE 作１−後療金額 = 後療料ＷＲ(1) + 後療料ＷＲ(2) +
                                    後療料ＷＲ(3) + 後療料ＷＲ(4) + 後療料ＷＲ(5).
011570********************
011580* 逓減毎料金セット *
011590********************
011600     MOVE 会−冷罨法料１             TO 冷罨料ＷＲ(1).
011610     MOVE 会−冷罨法料２             TO 冷罨料ＷＲ(2).
011620     MOVE 会−冷罨法料３８           TO 冷罨法料３８ＷＲ.
011630     MOVE 会−冷罨法料３０           TO 冷罨法料３０ＷＲ.
011640     COMPUTE 冷罨料ＷＲ(3)   = 冷罨法料３８ＷＲ  + 冷罨法料３０ＷＲ.
011650     MOVE 会−冷罨法料４５           TO 冷罨法料４５ＷＲ.
011660     MOVE 会−冷罨法料４８           TO 冷罨法料４８ＷＲ.
011670     MOVE 会−冷罨法料４０           TO 冷罨法料４０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(4)   = 冷罨法料４５ＷＲ  + 冷罨法料４８ＷＲ  + 冷罨法料４０ＷＲ.
011650     MOVE 会−冷罨法料５２           TO 冷罨法料５２ＷＲ.
011650     MOVE 会−冷罨法料５５           TO 冷罨法料５５ＷＲ.
011660     MOVE 会−冷罨法料５８           TO 冷罨法料５８ＷＲ.
011670     MOVE 会−冷罨法料５０           TO 冷罨法料５０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(5)   = 冷罨法料５２ＷＲ + 冷罨法料５５ＷＲ + 冷罨法料５８ＷＲ  + 冷罨法料５０ＷＲ.
011690     COMPUTE 冷罨料計ＷＲ = 冷罨料ＷＲ(1) + 冷罨料ＷＲ(2) + 冷罨料ＷＲ(3) + 冷罨料ＷＲ(4) + 冷罨料ＷＲ(5).
011700*
011710     MOVE 会−温罨法料１             TO 温罨料ＷＲ(1).
011720     MOVE 会−温罨法料２             TO 温罨料ＷＲ(2).
011730     MOVE 会−温罨法料３８           TO 温罨法料３８ＷＲ.
011740     MOVE 会−温罨法料３０           TO 温罨法料３０ＷＲ.
011750     COMPUTE 温罨料ＷＲ(3)   = 温罨法料３８ＷＲ  + 温罨法料３０ＷＲ.
011760     MOVE 会−温罨法料４５           TO 温罨法料４５ＷＲ.
011770     MOVE 会−温罨法料４８           TO 温罨法料４８ＷＲ.
011780     MOVE 会−温罨法料４０           TO 温罨法料４０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(4)   = 温罨法料４５ＷＲ  + 温罨法料４８ＷＲ  + 温罨法料４０ＷＲ.
011760     MOVE 会−温罨法料５２           TO 温罨法料５２ＷＲ.
011760     MOVE 会−温罨法料５５           TO 温罨法料５５ＷＲ.
011770     MOVE 会−温罨法料５８           TO 温罨法料５８ＷＲ.
011780     MOVE 会−温罨法料５０           TO 温罨法料５０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(5)   = 温罨法料５２ＷＲ + 温罨法料５５ＷＲ + 温罨法料５８ＷＲ + 温罨法料５０ＷＲ.
011800     COMPUTE 温罨料計ＷＲ = 温罨料ＷＲ(1) + 温罨料ＷＲ(2) + 温罨料ＷＲ(3) + 温罨料ＷＲ(4) + 温罨料ＷＲ(5).
011810*
011820     MOVE 会−電療料１             TO 電療料ＷＲ(1).
011830     MOVE 会−電療料２             TO 電療料ＷＲ(2).
011840     MOVE 会−電療料３８           TO 電療料３８ＷＲ.
011850     MOVE 会−電療料３０           TO 電療料３０ＷＲ.
011860     COMPUTE 電療料ＷＲ(3)  = 電療料３８ＷＲ  + 電療料３０ＷＲ.
011870     MOVE 会−電療料４５           TO 電療料４５ＷＲ.
011880     MOVE 会−電療料４８           TO 電療料４８ＷＲ.
011890     MOVE 会−電療料４０           TO 電療料４０ＷＲ.
011900     COMPUTE 電療料ＷＲ(4)  = 電療料４５ＷＲ  + 電療料４８ＷＲ  + 電療料４０ＷＲ.
011870     MOVE 会−電療料５２           TO 電療料５２ＷＲ.
011870     MOVE 会−電療料５５           TO 電療料５５ＷＲ.
011880     MOVE 会−電療料５８           TO 電療料５８ＷＲ.
011890     MOVE 会−電療料５０           TO 電療料５０ＷＲ.
011900     COMPUTE 電療料ＷＲ(5)  = 電療料５２ＷＲ + 電療料５５ＷＲ + 電療料５８ＷＲ + 電療料５０ＷＲ.
           COMPUTE 電療料計ＷＲ = 電療料ＷＲ(1) + 電療料ＷＲ(2) + 電療料ＷＲ(3) + 電療料ＷＲ(4) + 電療料ＷＲ(5).
           MOVE 電療料計ＷＲ             TO 作１−電療金額.
           COMPUTE 作１−罨法金額 = 冷罨料計ＷＲ + 温罨料計ＷＲ.
011920*
011370*================================================================*
011380 集計 SECTION.
011390***********************************************
011400* 料金データセット                            *
011410***********************************************
010990     MOVE 会−初検料             TO  初検料ＷＲ.
011000*
011010     MOVE 会−初検加算料         TO  初検加算料ＷＲ.
           MOVE 会−初検時相談料       TO  相談料ＷＲ.
011050     MOVE 会−再検料             TO  再検料ＷＲ.
011080     MOVE 会−往療料             TO  往療料ＷＲ.
011090     MOVE 会−往療加算料         TO  往療加算料ＷＲ.
011140     MOVE 会−金属副子加算料     TO  金属副子加算料ＷＲ.
015100     MOVE 会−運動後療料         TO  運動後療料ＷＲ.
011160     MOVE 会−施術情報提供料     TO  施術情報提供料ＷＲ.
           COMPUTE 初検計Ｗ = 初検計Ｗ + 初検料ＷＲ + 再検料ＷＲ + 往療料ＷＲ + 往療加算料ＷＲ.
           COMPUTE 加算計Ｗ = 加算計Ｗ + 初検加算料ＷＲ + 相談料ＷＲ.
      *
      */運動療法、金属副子追加/180518
           IF 受−施術和暦年月 < 43006
017120         COMPUTE 整復計Ｗ = 整復計Ｗ + 会−初回処置料合計
           ELSE
017120         COMPUTE 整復計Ｗ = 整復計Ｗ + 会−初回処置料合計 + 金属副子加算料ＷＲ + 運動後療料ＷＲ
           END-IF.
      *
011450     MOVE 会−後療料１     TO 後療料ＷＲ(1).
011460     MOVE 会−後療料２     TO 後療料ＷＲ(2).
011470     MOVE 会−後療料３８   TO 後療料３８ＷＲ.
011480     MOVE 会−後療料３０   TO 後療料３０ＷＲ.
011490     COMPUTE 後療料ＷＲ(3)   = 後療料３８ＷＲ   + 後療料３０ＷＲ.
011500     MOVE 会−後療料４５   TO 後療料４５ＷＲ.
011510     MOVE 会−後療料４８   TO 後療料４８ＷＲ.
011520     MOVE 会−後療料４０   TO 後療料４０ＷＲ.
011530     COMPUTE 後療料ＷＲ(4)   = 後療料４５ＷＲ   + 後療料４８ＷＲ   + 後療料４０ＷＲ.
011500     MOVE 会−後療料５２   TO 後療料５２ＷＲ.
011500     MOVE 会−後療料５５   TO 後療料５５ＷＲ.
011510     MOVE 会−後療料５８   TO 後療料５８ＷＲ.
011520     MOVE 会−後療料５０   TO 後療料５０ＷＲ.
011530     COMPUTE 後療料ＷＲ(5)   = 後療料５２ＷＲ + 後療料５５ＷＲ + 後療料５８ＷＲ + 後療料５０ＷＲ.
011530     COMPUTE 後療計Ｗ = 後療計Ｗ + 後療料ＷＲ(1) + 後療料ＷＲ(2) + 後療料ＷＲ(3) + 後療料ＷＲ(4) + 後療料ＷＲ(5).
011570********************
011580* 逓減毎料金セット *
011590********************
011600     MOVE 会−冷罨法料１             TO 冷罨料ＷＲ(1).
011610     MOVE 会−冷罨法料２             TO 冷罨料ＷＲ(2).
011620     MOVE 会−冷罨法料３８           TO 冷罨法料３８ＷＲ.
011630     MOVE 会−冷罨法料３０           TO 冷罨法料３０ＷＲ.
011640     COMPUTE 冷罨料ＷＲ(3)   = 冷罨法料３８ＷＲ  + 冷罨法料３０ＷＲ.
011650     MOVE 会−冷罨法料４５           TO 冷罨法料４５ＷＲ.
011660     MOVE 会−冷罨法料４８           TO 冷罨法料４８ＷＲ.
011670     MOVE 会−冷罨法料４０           TO 冷罨法料４０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(4)   = 冷罨法料４５ＷＲ  + 冷罨法料４８ＷＲ  + 冷罨法料４０ＷＲ.
011650     MOVE 会−冷罨法料５２           TO 冷罨法料５２ＷＲ.
011650     MOVE 会−冷罨法料５５           TO 冷罨法料５５ＷＲ.
011660     MOVE 会−冷罨法料５８           TO 冷罨法料５８ＷＲ.
011670     MOVE 会−冷罨法料５０           TO 冷罨法料５０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(5)   = 冷罨法料５２ＷＲ + 冷罨法料５５ＷＲ + 冷罨法料５８ＷＲ + 冷罨法料５０ＷＲ.
011690     COMPUTE 冷罨料計ＷＲ = 冷罨料ＷＲ(1) + 冷罨料ＷＲ(2) + 冷罨料ＷＲ(3) + 冷罨料ＷＲ(4) + 冷罨料ＷＲ(5).
011700*
011710     MOVE 会−温罨法料１             TO 温罨料ＷＲ(1).
011720     MOVE 会−温罨法料２             TO 温罨料ＷＲ(2).
011730     MOVE 会−温罨法料３８           TO 温罨法料３８ＷＲ.
011740     MOVE 会−温罨法料３０           TO 温罨法料３０ＷＲ.
011750     COMPUTE 温罨料ＷＲ(3)   = 温罨法料３８ＷＲ  + 温罨法料３０ＷＲ.
011760     MOVE 会−温罨法料４５           TO 温罨法料４５ＷＲ.
011770     MOVE 会−温罨法料４８           TO 温罨法料４８ＷＲ.
011780     MOVE 会−温罨法料４０           TO 温罨法料４０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(4)   = 温罨法料４５ＷＲ  + 温罨法料４８ＷＲ  + 温罨法料４０ＷＲ.
011760     MOVE 会−温罨法料５２           TO 温罨法料５２ＷＲ.
011760     MOVE 会−温罨法料５５           TO 温罨法料５５ＷＲ.
011770     MOVE 会−温罨法料５８           TO 温罨法料５８ＷＲ.
011780     MOVE 会−温罨法料５０           TO 温罨法料５０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(5)   = 温罨法料５２ＷＲ + 温罨法料５５ＷＲ + 温罨法料５８ＷＲ + 温罨法料５０ＷＲ.
011800     COMPUTE 温罨料計ＷＲ = 温罨料ＷＲ(1) + 温罨料ＷＲ(2) + 温罨料ＷＲ(3) + 温罨料ＷＲ(4) + 温罨料ＷＲ(5).
011810*
011820     MOVE 会−電療料１             TO 電療料ＷＲ(1).
011830     MOVE 会−電療料２             TO 電療料ＷＲ(2).
011840     MOVE 会−電療料３８           TO 電療料３８ＷＲ.
011850     MOVE 会−電療料３０           TO 電療料３０ＷＲ.
011860     COMPUTE 電療料ＷＲ(3)  = 電療料３８ＷＲ  + 電療料３０ＷＲ.
011870     MOVE 会−電療料４５           TO 電療料４５ＷＲ.
011880     MOVE 会−電療料４８           TO 電療料４８ＷＲ.
011890     MOVE 会−電療料４０           TO 電療料４０ＷＲ.
011900     COMPUTE 電療料ＷＲ(4)  = 電療料４５ＷＲ  + 電療料４８ＷＲ  + 電療料４０ＷＲ.
011870     MOVE 会−電療料５２           TO 電療料５２ＷＲ.
011870     MOVE 会−電療料５５           TO 電療料５５ＷＲ.
011880     MOVE 会−電療料５８           TO 電療料５８ＷＲ.
011890     MOVE 会−電療料５０           TO 電療料５０ＷＲ.
011900     COMPUTE 電療料ＷＲ(5)  = 電療料５２ＷＲ + 電療料５５ＷＲ + 電療料５８ＷＲ + 電療料５０ＷＲ.
           COMPUTE 電療料計ＷＲ = 電療料ＷＲ(1) + 電療料ＷＲ(2) + 電療料ＷＲ(3) + 電療料ＷＲ(4) + 電療料ＷＲ(5).
           COMPUTE 罨法計Ｗ = 罨法計Ｗ + 冷罨料計ＷＲ + 温罨料計ＷＲ.
           COMPUTE 電療計Ｗ = 電療計Ｗ + 電療料計ＷＲ.
011920*
           COMPUTE 費用計Ｗ = 費用計Ｗ + 会−費用額.
           COMPUTE 一部負担金計Ｗ = 一部負担金計Ｗ + 一部負担金ＷＲ.
      *
011370*================================================================*
011380 負担金詳細集計 SECTION.
      *
009720*     IF  受−助成種別 NOT = ZERO
009670         MOVE 会−助成計算負担額 TO 負担金詳細ＷＲ.
009680*     ELSE
009690*         MOVE 会−一部負担金   TO 負担金詳細ＷＲ
009700*     END-IF.
009710*
004140*================================================================*
004150 作１レコード書込 SECTION.
004160*
004170     WRITE 作１−レコード
004180     INVALID KEY
004190         MOVE NC"作１"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
004140*================================================================*
004150 作２レコード書込 SECTION.
004160*
004170     WRITE 作２−レコード
004180     INVALID KEY
004190         MOVE NC"作２"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
      *================================================================*
       月合計セット SECTION.
      *
0           IF 受−助成種別 NOT = ZERO
              MOVE  3   TO レセ−レセ種別
           ELSE
              IF 受−公費種別 NOT = ZERO
                 MOVE  2   TO レセ−レセ種別
              ELSE
                 IF 受−保険種別 = 85
                    MOVE  7   TO レセ−レセ種別
                 ELSE
                    MOVE  1   TO レセ−レセ種別
                 END-IF
              END-IF
           END-IF.
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           INVALID KEY
               MOVE SPACE     TO レセ−レコード
           END-READ.
      *
008330     MOVE レセ−合計         TO 作２−費用合計.
008340     MOVE レセ−一部負担金   TO 作２−負担合計.
008220     MOVE レセ−請求金額     TO 作２−請求合計.
           MOVE レセ−レセ実日数   TO 作２−実日数合計.
           MOVE レセ−負担割合       TO 連印−負担割合.
           IF 受−施術和暦年月 < 43006
              MOVE レセ−金属副子加算料 TO 連印−金属副子
              MOVE レセ−大             TO 連印−大
              MOVE レセ−中             TO 連印−中
              MOVE レセ−小             TO 連印−小
           ELSE
              MOVE ZERO                 TO 連印−金属副子
           END-IF.
           MOVE レセ−施術情報提供料 TO 連印−情報提供.
      *前期高齢
           IF 受−特別区分 = 1 OR 2 OR 3
016860         MOVE 1                TO 連印−前期高齢
           ELSE
016860         MOVE ZERO             TO 連印−前期高齢
           END-IF.
      *================================================================*
       データチェック SECTION.
      *
           MOVE SPACE          TO 実行キーＷ.
      * *****************************************************************
      * * 負傷部位有無チェック：部位数 = 0 の場合データ作成対象としない *
      * *****************************************************************
           MOVE 受−施術和暦   TO 負−施術和暦.
           MOVE 受−施術年     TO 負−施術年.
           MOVE 受−施術月     TO 負−施術月.
           MOVE 受−患者番号   TO 負−患者番号.
           MOVE 受−枝番       TO 負−枝番.
           READ 負傷データＦ
           INVALID KEY
               MOVE SPACE  TO 実行キーＷ
           NOT INVALID KEY
               IF 負−部位数 NOT = ZERO
      *        *************************************************************
      *        * 施術記録チェック：通院数 = 0 の場合データ作成対象としない *
      *        *************************************************************
                   MOVE 負−患者番号  TO 施記−患者番号
                   MOVE 負−枝番      TO 施記−枝番
                   MOVE 負−施術和暦  TO 施記−施術和暦
                   MOVE 負−施術年    TO 施記−施術年
                   MOVE 負−施術月    TO 施記−施術月
                   MOVE ZERO          TO 施記−施術日
                   START 施術記録Ｆ   KEY IS >= 施記−患者コード
                                                施記−施術和暦年月日
                   END-START
                   IF 状態キー = "00"
                       MOVE SPACE TO 終了フラグ２
                       MOVE SPACE TO 施術記録有Ｗ
                       PERFORM 施術記録Ｆ読込
                       PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
                                     (施記−患者コード NOT = 負−患者コード) OR
                                     (施記−施術和暦   NOT = 負−施術和暦  ) OR
                                     (施記−施術年     NOT = 負−施術年    ) OR
                                     (施記−施術月     NOT = 負−施術月    ) OR
                                     (施術記録有Ｗ         = "YES"         )
                           MOVE "YES"  TO 施術記録有Ｗ
                           MOVE "YES"  TO 実行キーＷ
                       END-PERFORM
                   ELSE
                       MOVE SPACE  TO 実行キーＷ
                   END-IF
               ELSE
                   MOVE SPACE  TO 実行キーＷ
               END-IF
           END-READ.
      *
      *================================================================*
       施術記録Ｆ読込 SECTION.
      *
           READ 施術記録Ｆ NEXT
           AT END
               MOVE "YES"  TO 終了フラグ２
           END-READ.
002820*================================================================*
       印刷条件判定 SECTION.
      *
           MOVE SPACE TO 対象フラグ
      */労災自賠責のデータは対象外
           IF 受−保険種別 NOT = 70 AND 80
               EVALUATE 印刷条件ＷＲ
               WHEN 01
                   PERFORM 初検判定
               WHEN 02
                   PERFORM 後療のみ判定
               WHEN 03
                   PERFORM 終了判定
               WHEN 04
                   PERFORM 初検判定
                   IF 対象フラグ = "YES"
                       PERFORM 終了判定
                   END-IF
               WHEN OTHER
                   CONTINUE
               END-EVALUATE
           END-IF.
040770*================================================================*
       初検判定 SECTION.
      *
014120     MOVE 受−患者番号  TO 施記−患者番号
014130     MOVE 受−枝番      TO 施記−枝番
014140     MOVE 受−施術和暦  TO 施記−施術和暦
014150     MOVE 受−施術年    TO 施記−施術年
014160     MOVE 受−施術月    TO 施記−施術月
014170     MOVE ZERO          TO 施記−施術日
014180     START 施術記録Ｆ   KEY IS >= 施記−患者コード
014190                                  施記−施術和暦年月日
014200     END-START
014210     IF 状態キー = "00"
014120         MOVE SPACE TO 終了フラグ２
014140         PERFORM 施術記録Ｆ読込
014150         PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
014160                       (施記−患者コード NOT = 受−患者コード) OR
014170                       (施記−施術和暦   NOT = 受−施術和暦  ) OR
014180                       (施記−施術年     NOT = 受−施術年    ) OR
014190                       (施記−施術月     NOT = 受−施術月    )
      *
                   IF 施記−診療区分 = 2
                       MOVE "YES" TO 対象フラグ
                       MOVE "YES" TO 終了フラグ２
                   END-IF
040620             PERFORM 施術記録Ｆ読込
               END-PERFORM
           END-IF.
040770*================================================================*
       後療のみ判定 SECTION.
      *
014120     MOVE 受−患者番号  TO 施記−患者番号
014130     MOVE 受−枝番      TO 施記−枝番
014140     MOVE 受−施術和暦  TO 施記−施術和暦
014150     MOVE 受−施術年    TO 施記−施術年
014160     MOVE 受−施術月    TO 施記−施術月
014170     MOVE ZERO          TO 施記−施術日
014180     START 施術記録Ｆ   KEY IS >= 施記−患者コード
014190                                  施記−施術和暦年月日
014200     END-START
014210     IF 状態キー = "00"
014120         MOVE SPACE TO 終了フラグ２
014140         PERFORM 施術記録Ｆ読込
014150         PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
014160                       (施記−患者コード NOT = 受−患者コード) OR
014170                       (施記−施術和暦   NOT = 受−施術和暦  ) OR
014180                       (施記−施術年     NOT = 受−施術年    ) OR
014190                       (施記−施術月     NOT = 受−施術月    )
      *
                   IF 施記−診療区分 = 1
                       MOVE "YES" TO 対象フラグ
                   ELSE
                       MOVE SPACE TO 対象フラグ
                       MOVE "YES" TO 終了フラグ２
                   END-IF
040620             PERFORM 施術記録Ｆ読込
               END-PERFORM
           END-IF.
040770*================================================================*
       終了判定 SECTION.
      *
           MOVE "YES" TO 対象フラグ.
      *
014190     MOVE 受−施術和暦   TO 負−施術和暦.
014200     MOVE 受−施術年     TO 負−施術年.
014210     MOVE 受−施術月     TO 負−施術月.
014120     MOVE 受−患者番号   TO 負−患者番号.
014130     MOVE 受−枝番       TO 負−枝番.
014140     READ 負傷データＦ
014150     INVALID KEY
014160         MOVE SPACE  TO 対象フラグ
014170     NOT INVALID KEY
               IF 負−部位数 = ZERO
                   MOVE SPACE TO 対象フラグ
               ELSE
020600             PERFORM VARYING 部位ＣＮＴ FROM 1 BY 1
020610                      UNTIL (部位ＣＮＴ > 負−部位数)
                       IF 負−転帰区分(部位ＣＮＴ) = 9 OR 5
                           MOVE SPACE TO 対象フラグ
                       END-IF
                   END-PERFORM
               END-IF
           END-READ.
027377*================================================================*
027378 月末日取得 SECTION.
027379*
027382     MOVE 施術和暦ＷＲ TO 元−元号区分.
027383     READ 元号マスタ
027384     NOT INVALID KEY
027385         MOVE 元−開始西暦年 TO 施術西暦年Ｗ
027386     END-READ.
027387     IF 施術西暦年Ｗ NOT = ZERO
027388        COMPUTE 施術西暦年Ｗ = 施術西暦年Ｗ + 施術年ＷＲ - 1
027389     END-IF.
027390*
           MOVE 施術月ＷＲ   TO 受理月Ｗ.
027391     EVALUATE 施術月ＷＲ
027392     WHEN 4
027393     WHEN 6
027394     WHEN 9
027395     WHEN 11
027396         MOVE 30 TO 受理日Ｗ
027397     WHEN 2
027398         DIVIDE 4 INTO 施術西暦年Ｗ GIVING    商Ｗ
027399                                    REMAINDER 余Ｗ
027400         END-DIVIDE
027401         IF 余Ｗ = ZERO
027402             MOVE 29 TO 受理日Ｗ
027403         ELSE
027404             MOVE 28 TO 受理日Ｗ
027405         END-IF
027406     WHEN 1
027407     WHEN 3
027408     WHEN 5
027409     WHEN 7
027410     WHEN 8
027411     WHEN 10
027412     WHEN 12
027413         MOVE 31 TO 受理日Ｗ
027414     WHEN OTHER
027415          CONTINUE
027416     END-EVALUATE.
027417*
004230******************************************************************
004240 END PROGRAM YAI721.
004250******************************************************************
