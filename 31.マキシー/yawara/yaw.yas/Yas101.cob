000010******************************************************************
000020*            IDENTIFICATION      DIVISION                        *
000030******************************************************************
000040 IDENTIFICATION          DIVISION.
000050 PROGRAM-ID.             YAS101.
000060 AUTHOR.                 岡田 憲和
000070*
000080*----------------------------------------------------------------*
000090*      提出FPD作成【ﾃﾞｰﾀ作成】柔ｳｨﾝﾄﾞｳｽﾞ95版
000100*
000110* ※ 生年月日(明治-昭和)逆、並び順追加
000120*
000130* 請求年月Ver.
000140*
000150*----------------------------------------------------------------*
000160 DATE-WRITTEN.           2000-02-01
000170 DATE-COMPILED.          2000-02-01
000180*----------------------------------------------------------------*
000190******************************************************************
000200*            ENVIRONMENT         DIVISION                        *
000210******************************************************************
000220 ENVIRONMENT             DIVISION.
000230 CONFIGURATION           SECTION.
000240 SOURCE-COMPUTER.        FMV-DESKPOWER-TS.
000250 OBJECT-COMPUTER.        FMV-DESKPOWER.
000260 SPECIAL-NAMES.          CONSOLE  IS  CONS
000270                         SYSERR   IS  MSGBOX.
000280 INPUT-OUTPUT            SECTION.
000290 FILE-CONTROL.
000300     SELECT  元号マスタ      ASSIGN      TO        GENGOUL
000310                             ORGANIZATION             IS  INDEXED
000320                             ACCESS MODE              IS  DYNAMIC
000330                             RECORD KEY               IS  元−元号区分
000340                             FILE STATUS              IS  状態キー
000350                             LOCK        MODE         IS  AUTOMATIC.
000360     SELECT  名称マスタ      ASSIGN      TO        MEISYOL
000370                             ORGANIZATION             IS  INDEXED
000380                             ACCESS MODE              IS  DYNAMIC
000390                             RECORD KEY               IS  名−区分コード
000400                                                          名−名称コード
000410                             FILE STATUS              IS  状態キー
000420                             LOCK        MODE         IS  AUTOMATIC.
000430     SELECT  施術所情報マスタ ASSIGN      TO        SEJOHOL
000440                             ORGANIZATION             IS  INDEXED
000450                             ACCESS MODE              IS  DYNAMIC
000460                             RECORD KEY               IS 施情−施術所番号
000470                             FILE STATUS              IS  状態キー
000480                             LOCK        MODE         IS  AUTOMATIC.
000490     SELECT  施術記録Ｆ      ASSIGN      TO        SEKIROKL
000500                             ORGANIZATION             IS  INDEXED
000510                             ACCESS MODE              IS  DYNAMIC
000520                             RECORD KEY           IS 施記−施術和暦年月日
000530                                                     施記−患者コード
000540                             ALTERNATE RECORD KEY IS 施記−患者コード
000550                                                     施記−施術和暦年月日
000560                             FILE STATUS              IS  状態キー
000570                             LOCK        MODE         IS  AUTOMATIC.
000580     SELECT  受診者情報Ｆ    ASSIGN      TO        JUSINJL
000590                             ORGANIZATION             IS  INDEXED
000600                             ACCESS MODE              IS  DYNAMIC
000610                             RECORD KEY               IS 受−施術和暦年月
000620                                                          受−患者コード
000630                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000640                                                          受−患者カナ
000650                                                          受−患者コード
000660                             ALTERNATE RECORD KEY     IS  受−患者コード
000670                                                         受−施術和暦年月
000680                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000690                                                          受−保険種別
000700                                                          受−保険者番号
000710                                                          受−患者コード
000720                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000730                                                          受−公費種別
000740                                                     受−費用負担者番号
000750                                                          受−患者コード
000760                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000770                                                          受−助成種別
000780                                                  受−費用負担者番号助成
000790                                                          受−患者コード
000800                             ALTERNATE RECORD KEY  IS 受−請求和暦年月
000810                                                      受−施術和暦年月
000820                                                      受−患者コード
000830                             FILE STATUS              IS  状態キー
000840                             LOCK        MODE         IS  AUTOMATIC.
000850     SELECT  負傷データＦ    ASSIGN      TO        HUSYOUL
000860                             ORGANIZATION             IS  INDEXED
000870                             ACCESS MODE              IS  DYNAMIC
000880                             RECORD KEY               IS 負−施術和暦年月
000890                                                         負−患者コード
000900                             ALTERNATE RECORD KEY     IS 負−患者コード
000910                                                         負−施術和暦年月
000920                             FILE STATUS              IS  状態キー
000930                             LOCK        MODE         IS  AUTOMATIC.
000940     SELECT  レセプトＦ      ASSIGN      TO        RECEPTL
000950                             ORGANIZATION             IS  INDEXED
000960                             ACCESS MODE              IS  DYNAMIC
000970                             RECORD KEY               IS  レセ−施術和暦年月
000980                                                          レセ−患者コード
000990                                                          レセ−レセ種別
001000                             ALTERNATE RECORD KEY     IS  レセ−患者コード
001010                                                          レセ−施術和暦年月
001020                                                          レセ−レセ種別
001030                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
001040                                                          レセ−施術和暦年月
001050                                                          レセ−患者コード
001060                                                          レセ−レセ種別
001070                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
001080                                                          レセ−レセ種別
001090                                                          レセ−請求保険者番号
001100                                                          レセ−患者コード
001110                                                          レセ−施術和暦年月
001120                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
001130                                                          レセ−請求保険者番号
001140                                                          レセ−患者コード
001150                                                          レセ−レセ種別
001160                                                          レセ−施術和暦年月
001170                             FILE STATUS              IS  状態キー
001180                             LOCK        MODE         IS  AUTOMATIC.
001190     SELECT  作業ファイル１  ASSIGN      TO        "C:\MAKISHISYS\YAWOBJ\TEMP\W1011L.DAT"
001200                             ORGANIZATION             IS  INDEXED
001210                             ACCESS                   IS  DYNAMIC
001220                             RECORD      KEY          IS  作１−請求和暦年月
001230                                                          作１−施術和暦年月
001240                                                          作１−保険区分
001250                                                          作１−費用負担者番号
001260                                                          作１−保険者番号
001270                                                          作１−本人家族区分
001280                                                          作１−患者カナ
001290                                                          作１−患者コード
001300                             FILE        STATUS       IS  状態キー
001310                             LOCK        MODE         IS  AUTOMATIC.
001320*
001330******************************************************************
001340*                      DATA DIVISION                             *
001350******************************************************************
001360 DATA                    DIVISION.
001370 FILE                    SECTION.
001380*                           ［ＲＬ＝  １２８］
001390 FD  元号マスタ          BLOCK   CONTAINS   1   RECORDS.
001400     COPY GENGOU          OF  XFDLIB  JOINING   元   AS  PREFIX.
001410*                           ［ＲＬ＝  １２８］
001420 FD  名称マスタ          BLOCK   CONTAINS   1   RECORDS.
001430     COPY MEISYO          OF  XFDLIB  JOINING   名   AS  PREFIX.
001440*
001450 FD  施術所情報マスタ    BLOCK   CONTAINS   1   RECORDS.
001460     COPY SEJOHO         OF  XFDLIB  JOINING   施情   AS  PREFIX.
001470*                           ［ＲＬ＝  ２５６］
001480 FD  施術記録Ｆ          BLOCK   CONTAINS   1   RECORDS.
001490     COPY SEKIROK         OF  XFDLIB  JOINING   施記 AS  PREFIX.
001500*                           ［ＲＬ＝  ３２０］
001510 FD  受診者情報Ｆ        BLOCK   CONTAINS   1   RECORDS.
001520     COPY JUSINJ          OF  XFDLIB  JOINING   受   AS  PREFIX.
001530*                           ［ＲＬ＝  １２８］
001540 FD  負傷データＦ        BLOCK   CONTAINS   1   RECORDS.
001550     COPY HUSYOU          OF  XFDLIB  JOINING   負   AS  PREFIX.
001560*
001570*                          ［ＲＬ＝  １５３６］
001580 FD  レセプトＦ          BLOCK   CONTAINS   1   RECORDS.
001590     COPY RECEPT          OF  XFDLIB  JOINING   レセ  AS  PREFIX.
001600*
001610 FD  作業ファイル１ RECORD  CONTAINS 516 CHARACTERS.
001620 01  作１−レコード.
001630     03  作１−レコードヘッダ.
001640         05  作１−請求和暦年月.
001650             07  作１−請求和暦            PIC 9.
001660             07  作１−請求年              PIC 9(2).
001670             07  作１−請求月              PIC 9(2).
001680         05  作１−保険区分                PIC 99.
001690         05  作１−保険者番号              PIC X(10).
001700         05  作１−本人家族区分            PIC 9.
001710         05  作１−施術和暦年月.
001720             07  作１−施術和暦            PIC 9.
001730             07  作１−施術年              PIC 9(2).
001740             07  作１−施術月              PIC 9(2).
001750         05  作１−被保険者カナ            PIC X(20).
001760         05  作１−患者コード.
001770             07 作１−患者番号             PIC 9(6).
001780             07 作１−枝番                 PIC X(1).
001790         05  作１−保険種別                PIC 9(2).
001800         05  作１−助成種別                PIC 9(2).
001810     03  作１−レコードデータ.
001820         05  作１−会員番号                PIC X(5).
001830         05  作１−老人助成                PIC 99.
001840         05  作１−公費併用.
001850             07  作１−費用負担者番号      PIC X(10).
001860             07  作１−受益者番号          PIC X(10).
001870         05  作１−患者氏名.
001880             07  作１−患者漢字            PIC X(20).
001890             07  作１−患者カナ            PIC X(20).
001900         05  作１−患者性別                PIC 9.
001910         05  作１−患者生年月日.
001920             07  作１−患者和暦            PIC 9(1).
001930             07  作１−患者年              PIC 9(2).
001940             07  作１−患者月              PIC 9(2).
001950             07  作１−患者日              PIC 9(2).
001960         05  作１−続柄                    PIC N(2).
001970         05  作１−被保険者氏名.
001980             07  作１−被保険者漢字        PIC X(20).
001990         05  作１−被保険者性別            PIC 9.
002000         05  作１−被保険者生年月日.
002010             07  作１−被保険者和暦        PIC 9(1).
002020             07  作１−被保険者年          PIC 9(2).
002030             07  作１−被保険者月          PIC 9(2).
002040             07  作１−被保険者日          PIC 9(2).
002050         05  作１−記号                    PIC X(24).
002060         05  作１−番号                    PIC X(12).
002070         05  作１−資格取得年月日.
002080             07  作１−資格和暦            PIC 9(1).
002090             07  作１−資格年              PIC 9(2).
002100             07  作１−資格月              PIC 9(2).
002110             07  作１−資格日              PIC 9(2).
002120         05  作１−有効年月日.
002130             07  作１−有効和暦            PIC 9(1).
002140             07  作１−有効年              PIC 9(2).
002150             07  作１−有効月              PIC 9(2).
002160             07  作１−有効日              PIC 9(2).
002170         05  作１−助成自己負担金未払      PIC 9.
002180         05  作１−転帰区分総合            PIC 9.
002190         05  FILLER                        PIC 9(2).
002200         05  作１−通院回数                PIC 9(2).
002210         05  作１−初診料.
002220             07  作１−初診基本料          PIC 9(4).
002230             07  作１−初診加算料          PIC 9(4).
002240         05  作１−往療料.
002250             07  作１−加算                PIC 9.
002260             07  作１−回数                PIC 9(2).
002270             07  作１−往療料金額          PIC 9(6).
002280         05  作１−金属副子加算.
002290             07  作１−使用枚数.
002300                 09  作１−大              PIC 9.
002310                 09  作１−中              PIC 9.
002320                 09  作１−小              PIC 9.
002330             07  作１−金額                PIC 9(6).
002340         05  作１−情報提供料              PIC 9(6).
002350         05  作１−文書料                  PIC 9(6).
002360         05  作１−一般費用金額.
002370             07  作１−費用合計金額        PIC 9(6).
002380             07  作１−負担率              PIC 9.
002390             07  作１−負担金額            PIC 9(6).
002400             07  作１−請求金額            PIC 9(6).
002410         05  作１−老人助成金額.
002420             07  作１−自己負担金額        PIC 9(6).
002430             07  作１−差引請求金額        PIC 9(6).
002440             07  作１−合計請求金額        PIC 9(6).
002450         05  作１−部位データ              OCCURS 5.
002460             07  作１−負傷コード.
002470                 09  作１−種別            PIC 9.
002480                 09  作１−部位コード      PIC 99.
002490             07  作１−冷罨療法.
002500                 09  作１−冷罨回数        PIC 99.
002510                 09  作１−冷罨金額        PIC 9(6).
002520             07  作１−施術料              PIC 9(6).
002530             07  作１−罨法料.
002540                 09  作１−罨法回数        PIC 99.
002550                 09  作１−罨法金額        PIC 9(6).
002560             07  作１−電療料.
002570                 09  作１−電療回数        PIC 99.
002580                 09  作１−電療金額        PIC 9(6).
002590             07  作１−後療料.
002600                 09  作１−後療回数        PIC 99.
002610                 09  作１−後療金額        PIC 9(6).
002620             07  作１−転帰区分            PIC 9.
002630         05  FILLER                        PIC X(13).
002640*----------------------------------------------------------------*
002650******************************************************************
002660*                WORKING-STORAGE SECTION                         *
002670******************************************************************
002680 WORKING-STORAGE         SECTION.
002690 01 キー入力                           PIC X    VALUE SPACE.
002700 01 状態キー                           PIC X(2) VALUE SPACE.
002710 01 終了フラグ                         PIC X(3) VALUE SPACE.
002720 01 終了フラグ２                       PIC X(3) VALUE SPACE.
002730 01 実行キーＷ                         PIC X(3)  VALUE SPACE.
002740 01 施術記録有Ｗ                       PIC X(3) VALUE SPACE.
002750 01 ファイル名                         PIC N(8) VALUE SPACE.
002760 01 継続フラグ                         PIC X(3) VALUE SPACE.
002770**
002780 01 保険種別ＷＲ                       PIC 9(2) VALUE ZERO.
002790 01 患者コードＷＲ.
002800    03 患者番号ＷＲ                    PIC 9(6) VALUE ZERO.
002810    03 枝番ＷＲ                        PIC X    VALUE SPACE.
002820*
002830 01 印刷形式ＷＲ                       PIC 9    VALUE ZERO.
002840 01 保険者番号ＷＲ                     PIC X(10) VALUE SPACE.
002850 01 レセプト種類ＷＲ                   PIC X(4) VALUE SPACE.
002860 01 本人家族区分ＷＲ                   PIC 9    VALUE ZERO.
002870 01 続柄Ｗ                             PIC N(2) VALUE SPACE.
002880 01 施術和暦年月ＷＲ.
002890    03 施術和暦ＷＲ                    PIC 9    VALUE ZERO.
002900    03 施術年ＷＲ                      PIC 9(2) VALUE ZERO.
002910    03 施術月ＷＲ                      PIC 9(2) VALUE ZERO.
002920 01 請求和暦年月ＷＲ.
002930    03 請求和暦ＷＲ                    PIC 9    VALUE ZERO.
002940    03 請求年ＷＲ                      PIC 9(2) VALUE ZERO.
002950    03 請求月ＷＲ                      PIC 9(2) VALUE ZERO.
002960**
002970 01 部位ＣＮＴ                         PIC 9     VALUE ZERO.
002980 01 カウンタ                           PIC 9(2)  VALUE ZERO.
002990 01 カウンタ２                         PIC 9(3)  VALUE ZERO.
003000 01 カウンタ３                         PIC 9(2)  VALUE ZERO.
003010 01 全角空白                           PIC X(2)  VALUE X"8140".
003020 01 半角空白                           PIC X(2)  VALUE X"2020".
003030**
003040 01 順番Ｗ                             PIC 9(4) VALUE ZERO.
003050** エラーメッセージ用
003060 01 エラーメッセージＷ.
003070    03 エラー患者コードＷ              PIC X(7) VALUE SPACE.
003080    03 エラー区切りＷ                  PIC X(1) VALUE SPACE.
003090    03 エラー保険種別Ｗ                PIC X(2) VALUE SPACE.
003100    03 FILLER                          PIC X(10) VALUE SPACE.
003110** 保険者番号右詰め用
003120 01 保険者番号ＷＴ.
003130    03 保険者番号左詰めＷ.
003140      05 保険者番号左詰めＷ１          PIC X OCCURS 8 VALUE SPACE.
003150    03 保険者番号右詰めＷ.
003160      05 保険者番号右詰めＷ１          PIC X OCCURS 8 VALUE ZERO.
003170    03 保険者番号数字Ｗ                PIC 9(8)  VALUE ZERO.
003180    03 保険者番号Ｗ                    PIC X(8)  VALUE SPACE.
003190** 会員番号右詰め用
003200 01 会員番号ＷＴ.
003210    03 会員番号左詰めＷ.
003220      05 会員番号左詰めＷ１            PIC X OCCURS 7 VALUE SPACE.
003230    03 会員番号右詰めＷ.
003240      05 会員番号右詰めＷ１            PIC X OCCURS 7 VALUE ZERO.
003250    03 会員番号数字Ｗ                  PIC 9(7)  VALUE ZERO.
003260    03 会員番号Ｗ                      PIC X(7)  VALUE SPACE.
003270** 西暦日付ワーク用
003280 01 西暦年月Ｗ.
003290    03 西暦年Ｗ                        PIC 9(4) VALUE ZERO.
003300    03 西暦月Ｗ                        PIC 9(2) VALUE ZERO.
003310** 西暦請求年月用
003320 01 西暦請求年月Ｗ.
003330    03 西暦請求年Ｗ                    PIC 9(4) VALUE ZERO.
003340    03 西暦請求月Ｗ                    PIC 9(2) VALUE ZERO.
003350** 西暦施術年月用
003360 01 西暦施術年月Ｗ.
003370    03 西暦施術年Ｗ                    PIC 9(4) VALUE ZERO.
003380    03 西暦施術月Ｗ                    PIC 9(2) VALUE ZERO.
003390** 記号左詰め用
003400 01 記号ＷＴ.
003410    03 記号元Ｗ.
003420      05 記号元Ｗ１                    PIC N OCCURS 12 VALUE SPACE.
003430    03 記号左詰めＷ.
003440      05 記号左詰めＷ１                PIC N OCCURS 12 VALUE SPACE.
003450    03 記号Ｗ.
003460      05 記号ＮＷ                      PIC N(12) VALUE SPACE.
003470    03 記号ＰＷ.
003480      05 記号ＰＮＷ                    PIC X(24) VALUE SPACE.
003490*
003500**********************************************************************************
003510*
003520 01 退避項目ＧＷ.
003530   03 レセプト種類Ｗ                   PIC X(4).
003540   03 レセプト種類ＧＷ                 PIC X(4).
003550   03 レセプト種別ＧＷ                 PIC 9(2).
003560*
003570****************
003580* 負傷データＦ *
003590****************
003600 01 負傷情報Ｗ.
003610    03 部位数Ｗ                        PIC 9(1)  VALUE ZERO.
003620    03 部位情報Ｗ  OCCURS   9.
003630       05 部位ＣＮＴＷ                 PIC 9(1)  VALUE ZERO.
003640       05 部位コードＷ.
003650          07 負傷種別Ｗ                PIC 9(2)  VALUE ZERO.
003660          07 部位Ｗ                    PIC 9(2)  VALUE ZERO.
003670       05 転帰区分Ｗ                   PIC 9(1)  VALUE ZERO.
003680*    ************
003690*    * 料金情報 *
003700*    ************
003710*    月毎の料金
003720***********************
003730 01 料金１ＷＲ.
003740   03 初検ＷＲ.
003750      05 負担割合ＷＲ               PIC 9(3)    VALUE ZERO.
003760      05 初検料ＷＲ                 PIC 9(5)    VALUE ZERO.
003770      05 初検加算料ＷＲ             PIC 9(5)    VALUE ZERO.
003780   03 再検料ＷＲ                    PIC 9(5)    VALUE ZERO.
003790   03 往療ＷＲ.
003800      05 往療回数ＷＲ               PIC 9(2)    VALUE ZERO.
003810      05 往療料ＷＲ                 PIC 9(5)    VALUE ZERO.
003820      05 往療加算料ＷＲ             PIC 9(5)    VALUE ZERO.
003830   03 金属副子加算料ＷＲ            PIC 9(5)    VALUE ZERO.
003840   03 大Ｗ                          PIC 9(1)    VALUE ZERO.
003850   03 中Ｗ                          PIC 9(1)    VALUE ZERO.
003860   03 小Ｗ                          PIC 9(1)    VALUE ZERO.
003870   03 施術情報提供料ＷＲ            PIC 9(5)    VALUE ZERO.
003880   03 一部負担金ＷＲ                PIC 9(6)    VALUE ZERO.
003890   03 請求金額ＷＲ                  PIC 9(6)    VALUE ZERO.
003900   03 給付割合ＷＲ                  PIC 9(1)    VALUE ZERO.
003910   03 受給者負担額ＷＲ              PIC 9(6)    VALUE ZERO.
003920   03 助成請求金額ＷＲ              PIC 9(6)    VALUE ZERO.
003930*
003940* 負傷部位毎の料金
003950***********************
003960 01 料金２ＷＲ.
003970   03 初回処置ＷＲ    OCCURS   9.
003980      05 初回処置料ＷＲ             PIC 9(5)    VALUE ZERO.
003990*
004000* 逓減毎の料金
004010***********************
004020 01 料金３ＷＲ.
004030**********
004040* １部位 *
004050**********
004060   03 部位１ＷＲ.
004070      05 後療１ＷＲ.
004080         07 後療回数１ＷＲ              PIC 9(2)    VALUE ZERO.
004090         07 後療料１ＷＲ                PIC 9(5)    VALUE ZERO.
004100      05 冷罨法１ＷＲ.
004110         07 冷罨法回数１ＷＲ            PIC 9(2)    VALUE ZERO.
004120         07 冷罨法料１ＷＲ              PIC 9(4)    VALUE ZERO.
004130      05 温罨法１ＷＲ.
004140         07 温罨法回数１ＷＲ            PIC 9(2)    VALUE ZERO.
004150         07 温罨法料１ＷＲ              PIC 9(4)    VALUE ZERO.
004160      05 電療１ＷＲ.
004170         07 電療回数１ＷＲ              PIC 9(2)    VALUE ZERO.
004180         07 電療料１ＷＲ                PIC 9(4)    VALUE ZERO.
004190**********
004200* ２部位 *
004210**********
004220   03 部位２ＷＲ.
004230      05 後療２ＷＲ.
004240         07 後療回数２ＷＲ              PIC 9(2)    VALUE ZERO.
004250         07 後療料２ＷＲ                PIC 9(5)    VALUE ZERO.
004260      05 冷罨法２ＷＲ.
004270         07 冷罨法回数２ＷＲ            PIC 9(2)    VALUE ZERO.
004280         07 冷罨法料２ＷＲ              PIC 9(4)    VALUE ZERO.
004290      05 温罨法２ＷＲ.
004300         07 温罨法回数２ＷＲ            PIC 9(2)    VALUE ZERO.
004310         07 温罨法料２ＷＲ              PIC 9(4)    VALUE ZERO.
004320      05 電療２ＷＲ.
004330         07 電療回数２ＷＲ              PIC 9(2)    VALUE ZERO.
004340         07 電療料２ＷＲ                PIC 9(4)    VALUE ZERO.
004350******************
004360* ３部位／８割 *
004370******************
004380   03 部位３８ＷＲ.
004390      05 後療３８ＷＲ.
004400         07 後療回数３８ＷＲ              PIC 9(2)  VALUE ZERO.
004410         07 後療料３８ＷＲ                PIC 9(5)  VALUE ZERO.
004420      05 冷罨法３８ＷＲ.
004430         07 冷罨法回数３８ＷＲ            PIC 9(2)  VALUE ZERO.
004440         07 冷罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
004450      05 温罨法３８ＷＲ.
004460         07 温罨法回数３８ＷＲ            PIC 9(2)  VALUE ZERO.
004470         07 温罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
004480      05 電療３８ＷＲ.
004490         07 電療回数３８ＷＲ              PIC 9(2)  VALUE ZERO.
004500         07 電療料３８ＷＲ                PIC 9(4)  VALUE ZERO.
004510******************
004520* ３部位／１０割 *
004530******************
004540   03 部位３０ＷＲ.
004550      05 後療３０ＷＲ.
004560         07 後療回数３０ＷＲ              PIC 9(2)  VALUE ZERO.
004570         07 後療料３０ＷＲ                PIC 9(5)  VALUE ZERO.
004580      05 冷罨法３０ＷＲ.
004590         07 冷罨法回数３０ＷＲ            PIC 9(2)  VALUE ZERO.
004600         07 冷罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
004610      05 温罨法３０ＷＲ.
004620         07 温罨法回数３０ＷＲ            PIC 9(2)  VALUE ZERO.
004630         07 温罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
004640      05 電療３０ＷＲ.
004650         07 電療回数３０ＷＲ              PIC 9(2)  VALUE ZERO.
004660         07 電療料３０ＷＲ                PIC 9(4)  VALUE ZERO.
004670******************
004680* ３部位／合計　 *
004690******************
004700   03 部位３ＷＲ.
004710      05 後療３ＷＲ.
004720         07 後療回数３ＷＲ                PIC 9(2)  VALUE ZERO.
004730         07 後療料３ＷＲ                  PIC 9(6)  VALUE ZERO.
004740      05 冷罨法３ＷＲ.
004750         07 冷罨法回数３ＷＲ              PIC 9(2)  VALUE ZERO.
004760         07 冷罨法料３ＷＲ                PIC 9(6)  VALUE ZERO.
004770      05 温罨法３ＷＲ.
004780         07 温罨法回数３ＷＲ              PIC 9(2)  VALUE ZERO.
004790         07 温罨法料３ＷＲ                PIC 9(6)  VALUE ZERO.
004800      05 電療３ＷＲ.
004810         07 電療回数３ＷＲ                PIC 9(2)  VALUE ZERO.
004820         07 電療料３ＷＲ                  PIC 9(6)  VALUE ZERO.
004830****************
004840* ４部位／５割 *
004850****************
004860   03 部位４５ＷＲ.
004870      05 後療４５ＷＲ.
004880         07 後療回数４５ＷＲ              PIC 9(2)  VALUE ZERO.
004890         07 後療料４５ＷＲ                PIC 9(5)  VALUE ZERO.
004900      05 冷罨法４５ＷＲ.
004910         07 冷罨法回数４５ＷＲ            PIC 9(2)  VALUE ZERO.
004920         07 冷罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
004930      05 温罨法４５ＷＲ.
004940         07 温罨法回数４５ＷＲ            PIC 9(2)  VALUE ZERO.
004950         07 温罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
004960      05 電療４５ＷＲ.
004970         07 電療回数４５ＷＲ              PIC 9(2)  VALUE ZERO.
004980         07 電療料４５ＷＲ                PIC 9(4)  VALUE ZERO.
004990****************
005000* ４部位／８割 *
005010****************
005020   03 部位４８ＷＲ.
005030      05 後療４８ＷＲ.
005040         07 後療回数４８ＷＲ              PIC 9(2)  VALUE ZERO.
005050         07 後療料４８ＷＲ                PIC 9(5)  VALUE ZERO.
005060      05 冷罨法４８ＷＲ.
005070         07 冷罨法回数４８ＷＲ            PIC 9(2)  VALUE ZERO.
005080         07 冷罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
005090      05 温罨法４８ＷＲ.
005100         07 温罨法回数４８ＷＲ            PIC 9(2)  VALUE ZERO.
005110         07 温罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
005120      05 電療４８ＷＲ.
005130         07 電療回数４８ＷＲ              PIC 9(2)  VALUE ZERO.
005140         07 電療料４８ＷＲ                PIC 9(4)  VALUE ZERO.
005150******************
005160* ４部位／１０割 *
005170******************
005180   03 部位４０ＷＲ.
005190      05 後療４０ＷＲ.
005200         07 後療回数４０ＷＲ              PIC 9(2)  VALUE ZERO.
005210         07 後療料４０ＷＲ                PIC 9(5)  VALUE ZERO.
005220      05 冷罨法４０ＷＲ.
005230         07 冷罨法回数４０ＷＲ            PIC 9(2)  VALUE ZERO.
005240         07 冷罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
005250      05 温罨法４０ＷＲ.
005260         07 温罨法回数４０ＷＲ            PIC 9(2)  VALUE ZERO.
005270         07 温罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
005280      05 電療４０ＷＲ.
005290         07 電療回数４０ＷＲ              PIC 9(2)  VALUE ZERO.
005300         07 電療料４０ＷＲ                PIC 9(4)  VALUE ZERO.
005310******************
005320* ４部位／合計　 *
005330******************
005340   03 部位４ＷＲ.
005350      05 後療４ＷＲ.
005360         07 後療回数４ＷＲ                PIC 9(2)  VALUE ZERO.
005370         07 後療料４ＷＲ                  PIC 9(6)  VALUE ZERO.
005380      05 冷罨法４ＷＲ.
005390         07 冷罨法回数４ＷＲ              PIC 9(2)  VALUE ZERO.
005400         07 冷罨法料４ＷＲ                PIC 9(6)  VALUE ZERO.
005410      05 温罨法４ＷＲ.
005420         07 温罨法回数４ＷＲ              PIC 9(2)  VALUE ZERO.
005430         07 温罨法料４ＷＲ                PIC 9(6)  VALUE ZERO.
005440      05 電療４ＷＲ.
005450         07 電療回数４ＷＲ                PIC 9(2)  VALUE ZERO.
005460         07 電療料４ＷＲ                  PIC 9(6)  VALUE ZERO.
005470********************
005480* ５部位／２．５割 *
005490********************
005500   03 部位５２ＷＲ.
005510      05 後療５２ＷＲ.
005520         07 後療回数５２ＷＲ              PIC 9(2)  VALUE ZERO.
005530         07 後療料５２ＷＲ                PIC 9(5)  VALUE ZERO.
005540      05 冷罨法５２ＷＲ.
005550         07 冷罨法回数５２ＷＲ            PIC 9(2)  VALUE ZERO.
005560         07 冷罨法料５２ＷＲ              PIC 9(4)  VALUE ZERO.
005570      05 温罨法５２ＷＲ.
005580         07 温罨法回数５２ＷＲ            PIC 9(2)  VALUE ZERO.
005590         07 温罨法料５２ＷＲ              PIC 9(4)  VALUE ZERO.
005600      05 電療５２ＷＲ.
005610         07 電療回数５２ＷＲ              PIC 9(2)  VALUE ZERO.
005620         07 電療料５２ＷＲ                PIC 9(4)  VALUE ZERO.
005630****************
005640* ５部位／５割 *
005650****************
005660   03 部位５５ＷＲ.
005670      05 後療５５ＷＲ.
005680         07 後療回数５５ＷＲ              PIC 9(2)  VALUE ZERO.
005690         07 後療料５５ＷＲ                PIC 9(5)  VALUE ZERO.
005700      05 冷罨法５５ＷＲ.
005710         07 冷罨法回数５５ＷＲ            PIC 9(2)  VALUE ZERO.
005720         07 冷罨法料５５ＷＲ              PIC 9(4)  VALUE ZERO.
005730      05 温罨法５５ＷＲ.
005740         07 温罨法回数５５ＷＲ            PIC 9(2)  VALUE ZERO.
005750         07 温罨法料５５ＷＲ              PIC 9(4)  VALUE ZERO.
005760      05 電療５５ＷＲ.
005770         07 電療回数５５ＷＲ              PIC 9(2)  VALUE ZERO.
005780         07 電療料５５ＷＲ                PIC 9(4)  VALUE ZERO.
005790****************
005800* ５部位／８割 *
005810****************
005820   03 部位５８ＷＲ.
005830      05 後療５８ＷＲ.
005840         07 後療回数５８ＷＲ              PIC 9(2)  VALUE ZERO.
005850         07 後療料５８ＷＲ                PIC 9(5)  VALUE ZERO.
005860      05 冷罨法５８ＷＲ.
005870         07 冷罨法回数５８ＷＲ            PIC 9(2)  VALUE ZERO.
005880         07 冷罨法料５８ＷＲ              PIC 9(4)  VALUE ZERO.
005890      05 温罨法５８ＷＲ.
005900         07 温罨法回数５８ＷＲ            PIC 9(2)  VALUE ZERO.
005910         07 温罨法料５８ＷＲ              PIC 9(4)  VALUE ZERO.
005920      05 電療５８ＷＲ.
005930         07 電療回数５８ＷＲ              PIC 9(2)  VALUE ZERO.
005940         07 電療料５８ＷＲ                PIC 9(4)  VALUE ZERO.
005950******************
005960* ５部位／１０割 *
005970******************
005980   03 部位５０ＷＲ.
005990      05 後療５０ＷＲ.
006000         07 後療回数５０ＷＲ              PIC 9(2)  VALUE ZERO.
006010         07 後療料５０ＷＲ                PIC 9(5)  VALUE ZERO.
006020      05 冷罨法５０ＷＲ.
006030         07 冷罨法回数５０ＷＲ            PIC 9(2)  VALUE ZERO.
006040         07 冷罨法料５０ＷＲ              PIC 9(4)  VALUE ZERO.
006050      05 温罨法５０ＷＲ.
006060         07 温罨法回数５０ＷＲ            PIC 9(2)  VALUE ZERO.
006070         07 温罨法料５０ＷＲ              PIC 9(4)  VALUE ZERO.
006080      05 電療５０ＷＲ.
006090         07 電療回数５０ＷＲ              PIC 9(2)  VALUE ZERO.
006100         07 電療料５０ＷＲ                PIC 9(4)  VALUE ZERO.
006110******************
006120* ５部位／合計　 *
006130******************
006140   03 部位５ＷＲ.
006150      05 後療５ＷＲ.
006160         07 後療回数５ＷＲ                PIC 9(2)  VALUE ZERO.
006170         07 後療料５ＷＲ                  PIC 9(6)  VALUE ZERO.
006180      05 冷罨法５ＷＲ.
006190         07 冷罨法回数５ＷＲ              PIC 9(2)  VALUE ZERO.
006200         07 冷罨法料５ＷＲ                PIC 9(6)  VALUE ZERO.
006210      05 温罨法５ＷＲ.
006220         07 温罨法回数５ＷＲ              PIC 9(2)  VALUE ZERO.
006230         07 温罨法料５ＷＲ                PIC 9(6)  VALUE ZERO.
006240      05 電療５ＷＲ.
006250         07 電療回数５ＷＲ                PIC 9(2)  VALUE ZERO.
006260         07 電療料５ＷＲ                  PIC 9(6)  VALUE ZERO.
006270*
006280*****************************************************************
006290 01 計算機西暦年Ｗ                     PIC 9(2).
006300* 日付ＷＯＲＫ
006310 01 計算機西暦.
006320    03 計算機西暦年                    PIC 9(4).
006330    03 計算機西暦月日                  PIC 9(4).
006340 01 計算機西暦Ｒ REDEFINES 計算機西暦.
006350    03 計算機世紀                      PIC 9(2).
006360    03 計算機日付                      PIC 9(6).
006370    03 計算機日付Ｒ REDEFINES 計算機日付.
006380       05 計算機年月                   PIC 9(4).
006390       05 計算機年月Ｒ REDEFINES 計算機年月.
006400         07 計算機年                   PIC 9(2).
006410         07 計算機月                   PIC 9(2).
006420       05 計算機日                     PIC 9(2).
006430*
006440*
006450 01 複合プログラム名Ｗ     PIC X(8) VALUE "MOJI2".
006460 01 プログラム名Ｗ         PIC X(8) VALUE SPACE.
006470*
006480******************************************************************
006490*                          連結項目                              *
006500******************************************************************
006510*
006520********************
006530* メッセージ表示キー *
006540********************
006550 01 連メ−キー IS EXTERNAL.
006560    03  連メ−メッセージ               PIC N(20).
006570*
006580 01 連メ３−キー IS EXTERNAL.
006590    03  連メ３−メッセージ             PIC N(20).
006600    03  連メ３−メッセージ１           PIC X(20).
006610****************
006620* 画面入力情報 *
006630****************
006640 01 連入−画面情報ＹＡＳ５８０ IS EXTERNAL.
006650    03 連入−請求和暦年月.
006660       05 連入−請求和暦               PIC 9.
006670       05 連入−請求年月.
006680         07 連入−請求年               PIC 9(2).
006690         07 連入−請求月               PIC 9(2).
006700*
006710 01 連レ−キー IS EXTERNAL.
006720    03 連レ−保険種別                  PIC 9(2).
006730*
006740*******************************
006750* 負担率取得用 ＰＧの対応1410 *
006760*******************************
006770 01 連率−負担率取得キー IS EXTERNAL.
006780    03 連率−施術和暦年月.
006790       05 連率−施術和暦             PIC 9.
006800       05 連率−施術年月.
006810          07 連率−施術年            PIC 9(2).
006820          07 連率−施術月            PIC 9(2).
006830    03 連率−患者コード.
006840       05 連率−患者番号             PIC 9(6).
006850       05 連率−枝番                 PIC X.
006860    03 連率−実際負担率              PIC 9(3).
006870    03 連率−実際本体負担率          PIC 9(3).
006880    03 連率−健保負担率              PIC 9(3).
006890    03 連率−２７老負担率            PIC 9(3).
006900    03 連率−助成負担率              PIC 9(3).
006910    03 連率−特別用負担率            PIC 9(3).
006920*
006930** 暗号複合用
006940 01 連暗号複合−暗号情報 IS EXTERNAL.
006950    03 連暗号複合−入力情報.
006960       05 連暗号複合−記号               PIC X(24).
006970       05 連暗号複合−番号               PIC X(30).
006980       05 連暗号複合−暗号化項目.
006990         07 連暗号複合−暗号患者番号     PIC X(6).
007000         07 連暗号複合−暗号判定記号     PIC X.
007010         07 連暗号複合−暗号判定番号     PIC X.
007020         07 連暗号複合−暗号記号         PIC X(24).
007030         07 連暗号複合−暗号番号         PIC X(30).
007040    03 連暗号複合−出力情報.
007050       05 連暗号複合−複合した記号       PIC X(24).
007060       05 連暗号複合−複合した番号       PIC X(30).
007070*
007080******************************************************************
007090*                      PROCEDURE  DIVISION                       *
007100******************************************************************
007110 PROCEDURE               DIVISION.
007120************
007130*           *
007140* 初期処理   *
007150*           *
007160************
007170     PERFORM 初期化.
007180     PERFORM 施術所情報取得.
007190************
007200*           *
007210* 主処理     *
007220*           *
007230************
007240     PERFORM 作業ファイル作成.
007250************
007260*           *
007270* 終了処理   *
007280*           *
007290************
007300     PERFORM 終了処理.
007310     MOVE ZERO TO PROGRAM-STATUS.
007320     EXIT PROGRAM.
007330*
007340*<<<<<<<<<<<<<<<<<<<<<<<<< END OF PROGRAM >>>>>>>>>>>>>>>>>>>>>>>>
007350*================================================================*
007360 初期化 SECTION.
007370*
007380     PERFORM ファイルオープン.
007390* 連結項目の待避
007400     MOVE 連入−請求和暦      TO 請求和暦ＷＲ.
007410     MOVE 連入−請求年        TO 請求年ＷＲ.
007420     MOVE 連入−請求月        TO 請求月ＷＲ.
007430*
007440*================================================================*
007450 ファイルオープン SECTION.
007460*
007470     OPEN INPUT 元号マスタ.
007480         MOVE NC"元号マスタ" TO ファイル名.
007490         PERFORM オープンチェック.
007500     OPEN INPUT 名称マスタ.
007510         MOVE NC"名称マスタ" TO ファイル名.
007520         PERFORM オープンチェック.
007530     OPEN INPUT 施術所情報マスタ
007540         MOVE NC"施情" TO ファイル名.
007550         PERFORM オープンチェック.
007560     OPEN INPUT 施術記録Ｆ.
007570         MOVE NC"施術記録Ｆ" TO ファイル名.
007580         PERFORM オープンチェック.
007590     OPEN INPUT 受診者情報Ｆ.
007600         MOVE NC"受診者情報Ｆ" TO ファイル名.
007610         PERFORM オープンチェック.
007620     OPEN INPUT 負傷データＦ.
007630         MOVE NC"負傷データＦ" TO ファイル名.
007640         PERFORM オープンチェック.
007650     OPEN INPUT レセプトＦ.
007660         MOVE NC"レセ" TO ファイル名.
007670         PERFORM オープンチェック.
007680*================================================================*
007690 オープンチェック SECTION.
007700*
007710     IF 状態キー  NOT =  "00"
007720         DISPLAY ファイル名 NC"Ｆオープンエラー" UPON CONS
007730         DISPLAY NC"状態キー：" 状態キー         UPON CONS
007740         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
007750                                                 UPON CONS
007760         ACCEPT  キー入力 FROM CONS
007770         PERFORM ファイル閉鎖
007780         MOVE 99 TO PROGRAM-STATUS
007790         EXIT PROGRAM.
007800*================================================================*
007810 ファイル閉鎖 SECTION.
007820*
007830     CLOSE 元号マスタ 名称マスタ 受診者情報Ｆ 負傷データＦ
007840           施術記録Ｆ 施術所情報マスタ レセプトＦ.
007850*================================================================*
007860 終了処理 SECTION.
007870*
007880     PERFORM ファイル閉鎖.
007890*================================================================*
007900 エラー表示 SECTION.
007910*
007920     DISPLAY NC"状態キー" 状態キー  UPON CONS.
007930     DISPLAY NC"ファイル書込エラー：" ファイル名   UPON CONS.
007940     DISPLAY NC"システム管理者に連絡してください"  UPON CONS.
007950     DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"                                                                    UPON CONS.
007960     ACCEPT  キー入力 FROM CONS.
007970     PERFORM ファイル閉鎖.
007980     MOVE 99 TO PROGRAM-STATUS.
007990     EXIT PROGRAM.
008000*================================================================*
008010 施術所情報取得 SECTION.
008020*
008030     MOVE ZERO  TO 施情−施術所番号.
008040     READ 施術所情報マスタ
008050     INVALID KEY
008060          MOVE  NC"施術所情報マスタに登録後、実行して下さい" TO 連メ−メッセージ
008070          CALL   "MSG001"
008080          CANCEL "MSG001"
008090          PERFORM ファイル閉鎖
008100          MOVE 99 TO PROGRAM-STATUS
008110          EXIT PROGRAM
008120     NOT INVALID KEY
008130          IF  施情−接骨師会会員番号 = SPACE
008140              MOVE  NC"施術所マスタに会員番号を登録して下さい" TO 連メ−メッセージ
008150              CALL   "MSG001"
008160              CANCEL "MSG001"
008170              PERFORM ファイル閉鎖
008180              MOVE 99 TO PROGRAM-STATUS
008190              EXIT PROGRAM
008200          ELSE
008210              MOVE 施情−接骨師会会員番号  TO 会員番号Ｗ
008220****              PERFORM 会員番号右詰め
008230          END-IF
008240     END-READ.
008250*
008260*================================================================*
008270 作業ファイル作成 SECTION.
008280*
008290     OPEN OUTPUT 作業ファイル１.
008300         MOVE NC"作１" TO ファイル名.
008310         PERFORM オープンチェック.
008320*
008330     PERFORM 作業ファイル１作成１
008340*
008350     CLOSE 作業ファイル１.
008360*
008370*================================================================*
008380 作業ファイル１作成１ SECTION.
008390*
008400*********************
008410*       全出力      *
008420*********************
008430*
008440     MOVE 請求和暦ＷＲ  TO レセ−請求和暦.
008450     MOVE 請求年ＷＲ    TO レセ−請求年.
008460     MOVE 請求月ＷＲ    TO レセ−請求月.
008470     MOVE ZERO          TO レセ−レセ種別.
008480     MOVE ZERO          TO レセ−施術和暦.
008490     MOVE ZERO          TO レセ−施術年.
008500     MOVE ZERO          TO レセ−施術月.
008510     MOVE ZERO          TO レセ−患者番号.
008520     MOVE SPACE         TO レセ−枝番.
008530     START レセプトＦ   KEY IS >= レセ−請求和暦年月
008540                                  レセ−施術和暦年月
008550                                  レセ−患者コード
008560                                  レセ−レセ種別
008570     END-START.
008580     IF 状態キー = "00"
008590         MOVE SPACE  TO 終了フラグ
008600         PERFORM レセプトＦ読込
008610         PERFORM UNTIL ( 終了フラグ = "YES" ) OR
008620                       ( レセ−請求和暦 NOT = 請求和暦ＷＲ ) OR
008630                       ( レセ−請求年   NOT = 請求年ＷＲ   ) OR
008640                       ( レセ−請求月   NOT = 請求月ＷＲ   )
008650            PERFORM データチェック
008660**
008670** 自由は対象外
008680            IF  受−保険種別 = 90
008690                MOVE SPACE  TO 実行キーＷ
008700            END-IF
008710** ///
008720** とりあえず 労災・自賠責は対象外 (レセプト内容が違う為)
008730            IF  受−保険種別 = 70 OR 80
008740                MOVE SPACE  TO 実行キーＷ
008750            END-IF
008760** ///
008770            IF  実行キーＷ = "YES"
008780**
008790*            ********
008800*            * 健保 *
008810*            ********
008820                 IF ( 受−保険種別   NOT = ZERO ) AND
008830                    ( 受−保険者番号 NOT = SPACE )
008840*                **********************
008850*                * 作業ファイル作成 *
008860*                **********************
008870                     IF ( 受−公費種別       = ZERO  ) AND
008880                        ( 受−費用負担者番号 = SPACE )
008890** 生保単独は対象外 (生保親ありと助成その他は、親のみ助成なしで出力)
008900*/60その他を助成レコードの対象に変更/101109
008910*                         IF  受−助成種別   = ZERO  OR 50 OR 60
008920                         IF  受−助成種別   = ZERO  OR 50
008930                             PERFORM 作１レコードセット健保
008940                         ELSE
008950                             PERFORM 作１レコードセット健保助成
008960                         END-IF
008970* 請求がある時出力
008980                         IF ( 作１−請求金額     = ZERO ) AND
008990                            ( 作１−差引請求金額 = ZERO )
009000                             CONTINUE
009010                         ELSE
009020                             PERFORM 作１ファイル書込
009030                         END-IF
009040                     END-IF
009050                 END-IF
009060*            ********
009070*            * 老人 *
009080*            ********
009090                 IF ( 受−公費種別       NOT = ZERO ) AND
009100                    ( 受−費用負担者番号 NOT = SPACE )
009110*                    **********************
009120*                    * 作業ファイル作成 *
009130*                    **********************
009140**
009150                         IF 受−施術和暦年月 < 42004
009160                             PERFORM 作１レコードセット老人
009170                         ELSE
009180*/60その他を助成レコードの対象に変更/101109
009190*                             IF  受−助成種別   = ZERO  OR 50 OR 60
009200                             IF  受−助成種別   = ZERO  OR 50
009210                                 PERFORM 作１レコードセット後高
009220                             ELSE
009230                                 PERFORM 作１レコードセット後高助成
009240                             END-IF
009250                         END-IF
009260* 請求がある時出力
009270                         IF ( 作１−請求金額     = ZERO ) AND
009280                            ( 作１−差引請求金額 = ZERO )
009290                             CONTINUE
009300                         ELSE
009310                             PERFORM 作１ファイル書込
009320                         END-IF
009330                 END-IF
009340             END-IF
009350             PERFORM レセプトＦ読込
009360         END-PERFORM
009370     END-IF.
009380*
009390*================================================================*
009400 データチェック SECTION.
009410*
009420     MOVE SPACE          TO 実行キーＷ.
009430* *****************************************************************
009440* * レセプトＦの請求対象区分 = 0 の場合データ作成対象としない *
009450* *****************************************************************
009460
009470     IF ( レセ−請求対象区分 NOT = ZERO ) AND
009480        ( レセ−償還払い区分 NOT = 2 OR 3 )
009490*        IF(レセ−レセ種別 = 3) AND ( レセ−会総括表印刷対象区分 = 1 )
009500        IF(レセ−レセ種別 = 3)
009510           CONTINUE
009520        ELSE
009530           MOVE レセ−施術和暦  TO 受−施術和暦
009540           MOVE レセ−施術年    TO 受−施術年
009550           MOVE レセ−施術月    TO 受−施術月
009560           MOVE レセ−患者番号  TO 受−患者番号
009570           MOVE レセ−枝番      TO 受−枝番
009580           READ 受診者情報Ｆ
009590           NOT INVALID KEY
009600**      健保のみ
009610              IF 受−保険分類 = 1
009620                 MOVE "YES"  TO 実行キーＷ
009630                 MOVE 受−施術和暦       TO 負−施術和暦
009640                 MOVE 受−施術年         TO 負−施術年
009650                 MOVE 受−施術月         TO 負−施術月
009660                 MOVE 受−患者コード     TO 負−患者コード
009670                 READ 負傷データＦ
009680                 END-READ
009690              END-IF
009700           END-READ
009710        END-IF
009720     END-IF.
009730*
009740*================================================================*
009750 レセプトＦ読込 SECTION.
009760*
009770     READ レセプトＦ NEXT
009780     AT END
009790         MOVE "YES" TO 終了フラグ
009800     END-READ.
009810*
009820*================================================================*
009830 受診者情報Ｆ読込 SECTION.
009840*
009850     READ 受診者情報Ｆ NEXT
009860     AT END
009870         MOVE "YES" TO 終了フラグ
009880     END-READ.
009890*
009900*================================================================*
009910 施術記録Ｆ読込 SECTION.
009920*
009930     READ 施術記録Ｆ NEXT
009940     AT END
009950         MOVE "YES"  TO 終了フラグ２
009960     END-READ.
009970*================================================================*
009980*================================================================*
009990 作１レコードセット健保 SECTION.
010000*
010010**********/  健保助成なしの時  /**********
010020*
010030     MOVE SPACE TO 作１−レコード.
010040     INITIALIZE 作１−レコード.
010050*
010060     MOVE 受−保険種別       TO 作１−保険種別.
010070     MOVE ZERO               TO 作１−助成種別.
010080*
010090     MOVE レセ−レセ実日数   TO 作１−通院回数.
010100     MOVE レセ−合計         TO 作１−費用合計金額.
010110     MOVE レセ−一部負担金   TO 作１−負担金額.
010120     MOVE レセ−請求金額     TO 作１−請求金額.
010130     MOVE ZERO               TO 作１−老人助成金額.
010140*
010150*    負担率の設定
010160     PERFORM 負担割合取得.
010170     COMPUTE 作１−負担率  = 連率−実際本体負担率 / 10.
010180*
010190* 連計 転記の後
010200     PERFORM 共通レコードセット.
010210*
010220*================================================================*
010230 作１レコードセット老人 SECTION.
010240*
010250**********/ 27老人の時  /**********
010260*
010270     MOVE SPACE TO 作１−レコード.
010280     INITIALIZE 作１−レコード.
010290*
010300     MOVE 受−公費種別       TO 作１−保険種別.
010310     MOVE 受−助成種別       TO 作１−助成種別.
010320*
010330     MOVE 受−費用負担者番号 TO 作１−費用負担者番号.
010340     MOVE 受−受益者番号老人 TO 作１−受益者番号.
010350*
010360     MOVE 受−老人負担金免除 TO 作１−助成自己負担金未払.
010370*
010380     MOVE レセ−レセ実日数   TO 作１−通院回数.
010390     MOVE レセ−合計         TO 作１−費用合計金額.
010400     MOVE レセ−一部負担金   TO 作１−負担金額.
010410     MOVE レセ−請求金額     TO 作１−請求金額.
010420     MOVE ZERO               TO 作１−老人助成金額.
010430*
010440     MOVE ZERO               TO 作１−負担率.
010450*
010460* 連計 転記の後
010470     PERFORM 共通レコードセット.
010480*
010490** 15/01 27助成対応（上記転記後、置換え）
010500     IF 受−助成種別 = 53 OR 54
010510         MOVE 受−費用負担者番号助成  TO 作１−保険者番号
010520         EVALUATE 受−助成種別
010530* 身障
010540         WHEN 53
010550             MOVE 14   TO 作１−老人助成
010560* 被爆
010570         WHEN 54
010580             MOVE 15   TO 作１−老人助成
010590         END-EVALUATE
010600* 助成金額
010610         MOVE レセ−受給者負担額   TO 作１−自己負担金額
010620         MOVE レセ−助成請求金額   TO 作１−差引請求金額
010630         COMPUTE 作１−合計請求金額 = 作１−自己負担金額 + 作１−差引請求金額
010640*
010650     END-IF.
010660**
010670*================================================================*
010680 作１レコードセット後高 SECTION.
010690*
010700**********/  後高助成なしの時  /**********
010710*
010720     MOVE SPACE TO 作１−レコード.
010730     INITIALIZE 作１−レコード.
010740*
010750     MOVE 受−保険種別       TO 作１−保険種別.
010760     MOVE ZERO               TO 作１−助成種別.
010770*
010780     MOVE レセ−レセ実日数   TO 作１−通院回数.
010790     MOVE レセ−合計         TO 作１−費用合計金額.
010800     MOVE レセ−一部負担金   TO 作１−負担金額.
010810     MOVE レセ−請求金額     TO 作１−請求金額.
010820     MOVE ZERO               TO 作１−老人助成金額.
010830*
010840*    旧柔と同じ仕様にするため、あえてゼロをセット。本当は１割３割などかみすべき
010850     MOVE ZERO               TO  作１−負担率.
010860*
010870* 連計 転記の後
010880     PERFORM 共通レコードセット.
010890*
010900*================================================================*
010910 作１レコードセット健保助成 SECTION.
010920*
010930**********/  健保助成ありの時  /**********
010940*
010950     MOVE SPACE TO 作１−レコード.
010960     INITIALIZE 作１−レコード.
010970*
010980     MOVE 受−保険種別       TO 作１−保険種別.
010990     MOVE 受−助成種別       TO 作１−助成種別.
011000*
011010* -- 99XXXXXX でも転記する ---
011020     MOVE 受−費用負担者番号助成  TO 作１−費用負担者番号.
011030*
011040     IF ( 受−受益者番号助成(1:1) = "*"  ) OR
011050        ( 受−受益者番号助成(1:2) = "＊" )
011060        MOVE SPACE                TO 作１−受益者番号
011070     ELSE
011080        MOVE 受−受益者番号助成   TO 作１−受益者番号
011090     END-IF.
011100*
011110**     MOVE 受−助成負担金免除 TO 作１−助成自己負担金未払.
011120     MOVE 受−老人負担金免除 TO 作１−助成自己負担金未払.
011130*
011140*
011150     MOVE レセ−レセ実日数   TO 作１−通院回数.
011160     MOVE レセ−合計         TO 作１−費用合計金額.
011170     MOVE レセ−一部負担金   TO 作１−負担金額.
011180     MOVE レセ−請求金額     TO 作１−請求金額.
011190*
011200*    負担率の設定
011210     PERFORM 負担割合取得.
011220     COMPUTE 作１−負担率  = 連率−実際本体負担率 / 10.
011230*
011240* 助成金額
011250     MOVE レセ−受給者負担額   TO 作１−自己負担金額.
011260     MOVE レセ−助成請求金額   TO 作１−差引請求金額.
011270     COMPUTE 作１−合計請求金額 = 作１−自己負担金額 + 作１−差引請求金額.
011280*
011290* 連計 転記の後
011300     PERFORM 共通レコードセット.
011310*
011320*================================================================*
011330 作１レコードセット後高助成 SECTION.
011340*
011350**********/  後高助成ありの時  /**********
011360*
011370     MOVE SPACE TO 作１−レコード.
011380     INITIALIZE 作１−レコード.
011390*
011400     MOVE 受−保険種別       TO 作１−保険種別.
011410     MOVE 受−助成種別       TO 作１−助成種別.
011420*
011430* -- 99XXXXXX でも転記する ---
011440     MOVE 受−費用負担者番号助成  TO 作１−費用負担者番号.
011450*
011460     IF ( 受−受益者番号助成(1:1) = "*"  ) OR
011470        ( 受−受益者番号助成(1:2) = "＊" )
011480        MOVE SPACE                TO 作１−受益者番号
011490     ELSE
011500        MOVE 受−受益者番号助成   TO 作１−受益者番号
011510     END-IF.
011520*
011530**     MOVE 受−助成負担金免除 TO 作１−助成自己負担金未払.
011540*     MOVE 受−老人負担金免除 TO 作１−助成自己負担金未払.
011550*
011560*
011570     MOVE レセ−レセ実日数   TO 作１−通院回数.
011580     MOVE レセ−合計         TO 作１−費用合計金額.
011590     MOVE レセ−一部負担金   TO 作１−負担金額.
011600     MOVE レセ−請求金額     TO 作１−請求金額.
011610*
011620*    旧柔と同じ仕様にするため、あえてゼロをセット。本当は１割３割などかみすべき
011630     MOVE ZERO               TO 作１−負担率.
011640*
011650* 助成金額
011660     MOVE レセ−受給者負担額   TO 作１−自己負担金額.
011670     MOVE レセ−助成請求金額   TO 作１−差引請求金額.
011680     COMPUTE 作１−合計請求金額 = 作１−自己負担金額 + 作１−差引請求金額.
011690*
011700* 連計 転記の後
011710     PERFORM 共通レコードセット.
011720*================================================================*
011730 共通レコードセット SECTION.
011740*
011750     MOVE レセ−請求和暦     TO 作１−請求和暦.
011760     MOVE レセ−請求年       TO 作１−請求年.
011770     MOVE レセ−請求月       TO 作１−請求月.
011780     MOVE 受−施術和暦       TO 作１−施術和暦 施術和暦ＷＲ.
011790     MOVE 受−施術年         TO 作１−施術年 施術年ＷＲ.
011800     MOVE 受−施術月         TO 作１−施術月 施術月ＷＲ.
011810     MOVE 受−患者コード     TO 作１−患者コード 患者コードＷＲ.
011820****     MOVE 会員番号数字Ｗ     TO 作１−会員番号.
011830     MOVE 会員番号Ｗ         TO 作１−会員番号.
011840*
011850     PERFORM 保険区分取得.
011860*
011870     MOVE 受−保険者番号     TO 作１−保険者番号.
011880     MOVE 受−患者氏名       TO 作１−患者氏名.
011890     MOVE 受−患者カナ       TO 作１−患者カナ.
011900     MOVE 受−患者性別       TO 作１−患者性別.
011910     MOVE 受−患者生年月日   TO 作１−患者生年月日.
011920** 和暦 明治と昭和を逆にする。
011930     EVALUATE 作１−患者和暦
011940     WHEN 1
011950        MOVE  3  TO 作１−患者和暦
011960     WHEN 3
011970        MOVE  1  TO 作１−患者和暦
011980     END-EVALUATE.
011990**
012000     MOVE 受−資格取得年月日 TO 作１−資格取得年月日.
012010     MOVE 受−有効年月日     TO 作１−有効年月日.
012020     MOVE 受−本人家族区分   TO 作１−本人家族区分.
012030     IF 受−本人家族区分 = 1
012040         MOVE NC"本人"    TO 続柄Ｗ
012050     ELSE
012060         MOVE 05          TO 名−区分コード
012070         MOVE 受−続柄    TO 名−名称コード
012080         READ 名称マスタ
012090         INVALID KEY
012100             MOVE SPACE     TO 続柄Ｗ
012110         NOT INVALID KEY
012120             MOVE 名−略称  TO 続柄Ｗ
012130         END-READ
012140     END-IF.
012150     MOVE 続柄Ｗ             TO 作１−続柄.
012160*
012170     MOVE 受−被保険者氏名   TO 作１−被保険者氏名.
012180     MOVE 受−被保険者カナ   TO 作１−被保険者カナ.
012190     MOVE 受−被保険者性別   TO 作１−被保険者性別.
012200     MOVE 受−被保険者生年月日   TO 作１−被保険者生年月日.
012210** 和暦 明治と昭和を逆にする。
012220     EVALUATE 作１−被保険者和暦
012230     WHEN 1
012240        MOVE  3  TO 作１−被保険者和暦
012250     WHEN 3
012260        MOVE  1  TO 作１−被保険者和暦
012270     END-EVALUATE.
012280**
012290*-----------------------------------------------------------------*
012300     MOVE SPACE TO 連暗号複合−暗号情報.
012310*
012320*    / 連暗号複合−入力情報セット /
012330     MOVE 受−記号       TO 連暗号複合−記号.
012340     MOVE 受−番号       TO 連暗号複合−番号.
012350     MOVE 受−暗号化項目 TO 連暗号複合−暗号化項目.
012360*
012370     CALL   複合プログラム名Ｗ.
012380     CANCEL 複合プログラム名Ｗ.
012390*
012400*-----------------------------------------------------------------*
012410*
012420     IF ( 連暗号複合−複合した番号(1:1) = "*"  ) OR
012430        ( 連暗号複合−複合した番号(1:2) = "＊" )
012440        MOVE SPACE           TO 作１−番号
012450     ELSE
012460        MOVE 連暗号複合−複合した番号        TO 作１−番号
012470     END-IF.
012480*
012490     IF ( 連暗号複合−複合した記号(1:1) = "*"  ) OR
012500        ( 連暗号複合−複合した記号(1:2) = "＊" )
012510        MOVE SPACE               TO 記号ＰＮＷ
012520        INSPECT 記号ＰＮＷ  REPLACING ALL 半角空白 BY 全角空白
012530        MOVE 記号ＰＷ            TO 作１−記号
012540     ELSE
012550        PERFORM 記号左詰め
012560        MOVE 記号Ｗ              TO 作１−記号
012570     END-IF.
012580*
012590*
012600*****     PERFORM レセプト呼出し.
012610     PERFORM 負傷データ取得.
012620     PERFORM 料金情報取得.
012630     MOVE 初検料ＷＲ             TO  作１−初診基本料.
012640*
012650     MOVE 初検加算料ＷＲ         TO  作１−初診加算料.
012660     MOVE 往療回数ＷＲ           TO  作１−回数.
012670     MOVE 往療料ＷＲ             TO  作１−往療料金額.
012680*
012690     IF ( レセ−夜間     = 1 ) OR
012700        ( レセ−暴風雨雪 = 1 ) OR
012710        ( レセ−難路     = 1 )
012720         MOVE 1  TO  作１−加算
012730     END-IF.
012740*
012750     MOVE 金属副子加算料ＷＲ     TO 作１−金額.
012760*
012770     MOVE 大Ｗ                   TO 作１−大.
012780     MOVE 中Ｗ                   TO 作１−中.
012790     MOVE 小Ｗ                   TO 作１−小.
012800*
012810     MOVE 施術情報提供料ＷＲ     TO 作１−情報提供料.
012820*
012830     MOVE 負傷種別Ｗ(1)          TO 作１−種別(1).
012840     MOVE 部位Ｗ(1)              TO 作１−部位コード(1).
012850     MOVE 後療回数１ＷＲ         TO 作１−後療回数(1).
012860     MOVE 後療料１ＷＲ           TO 作１−後療金額(1).
012870     MOVE 冷罨法回数１ＷＲ       TO 作１−冷罨回数(1).
012880     MOVE 冷罨法料１ＷＲ         TO 作１−冷罨金額(1).
012890     MOVE 初回処置料ＷＲ(1)      TO 作１−施術料(1).
012900     MOVE 温罨法回数１ＷＲ       TO 作１−罨法回数(1).
012910     MOVE 温罨法料１ＷＲ         TO 作１−罨法金額(1).
012920     MOVE 電療回数１ＷＲ         TO 作１−電療回数(1).
012930     MOVE 電療料１ＷＲ           TO 作１−電療金額(1).
012940     MOVE 転帰区分Ｗ(1)          TO 作１−転帰区分(1).
012950     MOVE 負傷種別Ｗ(2)          TO 作１−種別(2).
012960     MOVE 部位Ｗ(2)              TO 作１−部位コード(2).
012970     MOVE 後療回数２ＷＲ         TO 作１−後療回数(2).
012980     MOVE 後療料２ＷＲ           TO 作１−後療金額(2).
012990     MOVE 冷罨法回数２ＷＲ       TO 作１−冷罨回数(2).
013000     MOVE 冷罨法料２ＷＲ         TO 作１−冷罨金額(2).
013010     MOVE 初回処置料ＷＲ(2)      TO 作１−施術料(2).
013020     MOVE 温罨法回数２ＷＲ       TO 作１−罨法回数(2).
013030     MOVE 温罨法料２ＷＲ         TO 作１−罨法金額(2).
013040     MOVE 電療回数２ＷＲ         TO 作１−電療回数(2).
013050     MOVE 電療料２ＷＲ           TO 作１−電療金額(2).
013060     MOVE 転帰区分Ｗ(2)          TO 作１−転帰区分(2).
013070     MOVE 負傷種別Ｗ(3)          TO 作１−種別(3).
013080     MOVE 部位Ｗ(3)              TO 作１−部位コード(3).
013090     MOVE 後療回数３ＷＲ         TO 作１−後療回数(3).
013100     MOVE 後療料３ＷＲ           TO 作１−後療金額(3).
013110     MOVE 冷罨法回数３ＷＲ       TO 作１−冷罨回数(3).
013120     MOVE 冷罨法料３ＷＲ         TO 作１−冷罨金額(3).
013130     MOVE 初回処置料ＷＲ(3)      TO 作１−施術料(3).
013140     MOVE 温罨法回数３ＷＲ       TO 作１−罨法回数(3).
013150     MOVE 温罨法料３ＷＲ         TO 作１−罨法金額(3).
013160     MOVE 電療回数３ＷＲ         TO 作１−電療回数(3).
013170     MOVE 電療料３ＷＲ           TO 作１−電療金額(3).
013180     MOVE 転帰区分Ｗ(3)          TO 作１−転帰区分(3).
013190     MOVE 負傷種別Ｗ(4)          TO 作１−種別(4).
013200     MOVE 部位Ｗ(4)              TO 作１−部位コード(4).
013210     MOVE 後療回数４ＷＲ         TO 作１−後療回数(4).
013220     MOVE 後療料４ＷＲ           TO 作１−後療金額(4).
013230     MOVE 冷罨法回数４ＷＲ       TO 作１−冷罨回数(4).
013240     MOVE 冷罨法料４ＷＲ         TO 作１−冷罨金額(4).
013250     MOVE 初回処置料ＷＲ(4)      TO 作１−施術料(4).
013260     MOVE 温罨法回数４ＷＲ       TO 作１−罨法回数(4).
013270     MOVE 温罨法料４ＷＲ         TO 作１−罨法金額(4).
013280     MOVE 電療回数４ＷＲ         TO 作１−電療回数(4).
013290     MOVE 電療料４ＷＲ           TO 作１−電療金額(4).
013300     MOVE 転帰区分Ｗ(4)          TO 作１−転帰区分(4).
013310     MOVE 負傷種別Ｗ(5)          TO 作１−種別(5).
013320     MOVE 部位Ｗ(5)              TO 作１−部位コード(5).
013330     MOVE 後療回数５ＷＲ         TO 作１−後療回数(5).
013340     MOVE 後療料５ＷＲ           TO 作１−後療金額(5).
013350     MOVE 冷罨法回数５ＷＲ       TO 作１−冷罨回数(5).
013360     MOVE 冷罨法料５ＷＲ         TO 作１−冷罨金額(5).
013370     MOVE 初回処置料ＷＲ(5)      TO 作１−施術料(5).
013380     MOVE 温罨法回数５ＷＲ       TO 作１−罨法回数(5).
013390     MOVE 温罨法料５ＷＲ         TO 作１−罨法金額(5).
013400     MOVE 電療回数５ＷＲ         TO 作１−電療回数(5).
013410     MOVE 電療料５ＷＲ           TO 作１−電療金額(5).
013420     MOVE 転帰区分Ｗ(5)          TO 作１−転帰区分(5).
013430*
013440* 1つでも継続があれば 9 を転記
013450     IF 継続フラグ = "YES"
013460         MOVE  9                 TO 作１−転帰区分総合
013470     END-IF.
013480*
013490*
013500*================================================================*
013510*================================================================*
013520 負担割合取得 SECTION.
013530*/負担割合
013540     INITIALIZE 連率−負担率取得キー.
013550     MOVE 受−施術和暦年月 TO 連率−施術和暦年月.
013560     MOVE 受−患者コード   TO 連率−患者コード.
013570     MOVE "HUTANRIT" TO プログラム名Ｗ.
013580     CALL プログラム名Ｗ.
013590     CANCEL プログラム名Ｗ.
013600*
013610*================================================================*
013620*================================================================*
013630 作１ファイル書込 SECTION.
013640*
013650     WRITE 作１−レコード
013660     INVALID KEY
013670         MOVE NC"作１"  TO ファイル名
013680         PERFORM エラー表示
013690     END-WRITE.
013700*================================================================*
013710*================================================================*
013720 会員番号右詰め SECTION.
013730*
013740     MOVE 会員番号Ｗ      TO  会員番号左詰めＷ.
013750     MOVE ZERO            TO  会員番号右詰めＷ.
013760     MOVE ZERO            TO  会員番号数字Ｗ.
013770*
013780     MOVE  8  TO  カウンタ.
013790*
013800     IF  会員番号左詰めＷ１(7) NOT = SPACE
013810         COMPUTE カウンタ = カウンタ  -  1
013820         MOVE 会員番号左詰めＷ１(7)  TO  会員番号右詰めＷ１(カウンタ)
013830     END-IF.
013840     IF  会員番号左詰めＷ１(6) NOT = SPACE
013850         COMPUTE カウンタ = カウンタ  -  1
013860         MOVE 会員番号左詰めＷ１(6)  TO  会員番号右詰めＷ１(カウンタ)
013870     END-IF.
013880     IF  会員番号左詰めＷ１(5) NOT = SPACE
013890         COMPUTE カウンタ = カウンタ  -  1
013900         MOVE 会員番号左詰めＷ１(5)  TO  会員番号右詰めＷ１(カウンタ)
013910     END-IF.
013920     IF  会員番号左詰めＷ１(4) NOT = SPACE
013930         COMPUTE カウンタ = カウンタ  -  1
013940         MOVE 会員番号左詰めＷ１(4)  TO  会員番号右詰めＷ１(カウンタ)
013950     END-IF.
013960     IF  会員番号左詰めＷ１(3) NOT = SPACE
013970         COMPUTE カウンタ = カウンタ  -  1
013980         MOVE 会員番号左詰めＷ１(3)  TO  会員番号右詰めＷ１(カウンタ)
013990     END-IF.
014000     IF  会員番号左詰めＷ１(2) NOT = SPACE
014010         COMPUTE カウンタ = カウンタ  -  1
014020         MOVE 会員番号左詰めＷ１(2)  TO  会員番号右詰めＷ１(カウンタ)
014030     END-IF.
014040     IF  会員番号左詰めＷ１(1) NOT = SPACE
014050         COMPUTE カウンタ = カウンタ  -  1
014060         MOVE 会員番号左詰めＷ１(1)  TO  会員番号右詰めＷ１(カウンタ)
014070     END-IF.
014080*
014090     MOVE 会員番号右詰めＷ TO 会員番号数字Ｗ.
014100*
014110*================================================================*
014120 記号左詰め SECTION.
014130*
014140***** 記号の無駄なSPACEを取り除いて、左詰めにする。
014150     MOVE SPACE           TO  記号ＮＷ.
014160     MOVE SPACE           TO  記号元Ｗ.
014170     MOVE SPACE           TO  記号左詰めＷ.
014180     MOVE 連暗号複合−複合した記号 TO  記号元Ｗ.
014190*
014200     MOVE  ZERO  TO  カウンタ２.
014210     PERFORM VARYING カウンタ FROM 1 BY 1 UNTIL カウンタ > 12
014220          IF  記号元Ｗ１(カウンタ) NOT = SPACE
014230              COMPUTE カウンタ２ = カウンタ２  +  1
014240              MOVE 記号元Ｗ１(カウンタ)  TO  記号左詰めＷ１(カウンタ２)
014250          END-IF
014260     END-PERFORM.
014270*
014280     MOVE 記号左詰めＷ    TO 記号ＮＷ.
014290*
014300*半角スペースを全角にかえる
014310     INSPECT 記号Ｗ REPLACING ALL 半角空白 BY 全角空白.
014320*
014330*================================================================*
014340*================================================================*
014350 保険区分取得 SECTION.
014360*
014370*
014380     IF ( 受−助成種別 NOT = ZERO ) OR
014390        (( 受−公費種別 = 05 ) AND ( 受−施術和暦年月 < 42004 ))
014400**-- 助成・老人 --
014410         IF ( 受−公費種別 = 05 ) AND ( 受−施術和暦年月 < 42004 )
014420             MOVE 05     TO 作１−保険区分
014430         ELSE
014440             EVALUATE 受−助成種別
014450* 生保
014460             WHEN 50
014470                 MOVE 10     TO 作１−保険区分
014480* ４１老人
014490             WHEN 51
014500                 MOVE 05     TO 作１−保険区分
014510* ひとり親
014520             WHEN 52
014530                 MOVE 13     TO 作１−保険区分
014540* 身障
014550             WHEN 53
014560                 MOVE 14     TO 作１−保険区分
014570* 被爆
014580             WHEN 54
014590                 MOVE 15     TO 作１−保険区分
014600* 乳幼児
014610             WHEN 55
014620                 MOVE 16     TO 作１−保険区分
014630             WHEN 60
014640*浜松市湖西市の小中学生は乳幼児扱いにする/100927
014650                 IF 受−費用負担者番号助成(1:4) = "8322"
014660                     MOVE 16     TO 作１−保険区分
014670                 END-IF
014680             END-EVALUATE
014690         END-IF
014700         EVALUATE 受−保険種別
014710* 国保
014720         WHEN 01
014730* 社保
014740         WHEN 02
014750* 組合
014760         WHEN 03
014770* 共済
014780         WHEN 04
014790* 日雇
014800         WHEN 06
014810* 船員
014820         WHEN 07
014830* 退職
014840         WHEN 08
014850             MOVE 受−保険種別 TO 作１−老人助成
014860* 自衛官
014870         WHEN 09
014880             MOVE 4 TO 作１−老人助成
014890* 後期高齢
014900         WHEN 05
014910             IF 受−施術和暦年月 >= 42004
014920                 MOVE 30 TO 作１−老人助成
014930             END-IF
014940*
014950         WHEN OTHER
014960             MOVE SPACE                TO エラーメッセージＷ
014970             MOVE 受−患者コード       TO エラー患者コードＷ
014980             MOVE 受−保険種別         TO エラー保険種別Ｗ
014990             MOVE "-"                  TO エラー区切りＷ
015000             MOVE  NC"保険種別が異常です。患者−保険種別" TO 連メ３−メッセージ
015010             MOVE  エラーメッセージＷ  TO 連メ３−メッセージ１
015020             CALL   "MSG003"
015030             CANCEL "MSG003"
015040         END-EVALUATE
015050     ELSE
015060**-- 健保 --
015070         EVALUATE 受−保険種別
015080* 国保
015090         WHEN 01
015100* 社保
015110         WHEN 02
015120* 組合
015130         WHEN 03
015140* 共済
015150         WHEN 04
015160* 日雇
015170         WHEN 06
015180* 船員
015190         WHEN 07
015200* 退職
015210         WHEN 08
015220             MOVE 受−保険種別 TO 作１−保険区分
015230* 自衛官
015240         WHEN 09
015250             MOVE 4 TO 作１−保険区分
015260* 労災
015270         WHEN 70
015280             MOVE 9 TO 作１−保険区分
015290* 自賠責
015300         WHEN 80
015310             MOVE 12 TO 作１−保険区分
015320* 後期高齢
015330         WHEN 05
015340             IF 受−施術和暦年月 >= 42004
015350                 MOVE 30 TO 作１−保険区分
015360             END-IF
015370*
015380         WHEN OTHER
015390             MOVE SPACE                TO エラーメッセージＷ
015400             MOVE 受−患者コード       TO エラー患者コードＷ
015410             MOVE 受−保険種別         TO エラー保険種別Ｗ
015420             MOVE "-"                  TO エラー区切りＷ
015430             MOVE  NC"保険種別が異常です。患者−保険種別" TO 連メ３−メッセージ
015440             MOVE  エラーメッセージＷ  TO 連メ３−メッセージ１
015450             CALL   "MSG003"
015460             CANCEL "MSG003"
015470         END-EVALUATE
015480     END-IF.
015490*
015500*================================================================*
015510*================================================================*
015520 料金情報取得 SECTION.
015530*
015540***********************************************
015550* 料金データセット                            *
015560***********************************************
015570*    ****************************************************************
015580*    * 料金（月毎）（負傷毎）（逓減毎）については連結項目よりセット *
015590*    ****************************************************************
015600     INITIALIZE 料金１ＷＲ.
015610     INITIALIZE 料金２ＷＲ.
015620     INITIALIZE 料金３ＷＲ.
015630     MOVE レセ−初検料                 TO  初検料ＷＲ.
015640*
015650     MOVE レセ−初検加算料             TO  初検加算料ＷＲ.
015660     MOVE レセ−再検料                 TO  再検料ＷＲ.
015670     MOVE レセ−往療回数               TO  往療回数ＷＲ.
015680     MOVE レセ−往療料                 TO  往療料ＷＲ.
015690     MOVE レセ−往療加算料             TO  往療加算料ＷＲ.
015700*
015710*
015720     MOVE レセ−金属副子加算料         TO  金属副子加算料ＷＲ.
015730*
015740     MOVE レセ−大                     TO 大Ｗ.
015750     MOVE レセ−中                     TO 中Ｗ.
015760     MOVE レセ−小                     TO 小Ｗ.
015770*
015780     MOVE レセ−施術情報提供料         TO  施術情報提供料ＷＲ.
015790********************
015800* 初回処置料セット *
015810********************
015820     PERFORM VARYING 部位ＣＮＴ FROM 1 BY 1
015830             UNTIL ( 部位ＣＮＴ > 部位数Ｗ )
015840         MOVE レセ−初回処置料(部位ＣＮＴ) TO 初回処置料ＷＲ(部位ＣＮＴ)
015850     END-PERFORM.
015860********************
015870* 逓減毎料金セット *
015880********************
015890*    **********
015900*    * １部位 *
015910*    **********
015920     MOVE レセ−後療回数１             TO 後療回数１ＷＲ.
015930     MOVE レセ−後療料１               TO 後療料１ＷＲ.
015940     MOVE レセ−冷罨法回数１           TO 冷罨法回数１ＷＲ.
015950     MOVE レセ−冷罨法料１             TO 冷罨法料１ＷＲ.
015960     MOVE レセ−温罨法回数１           TO 温罨法回数１ＷＲ.
015970     MOVE レセ−温罨法料１             TO 温罨法料１ＷＲ.
015980     MOVE レセ−電療回数１             TO 電療回数１ＷＲ.
015990     MOVE レセ−電療料１               TO 電療料１ＷＲ.
016000*    **********
016010*    * ２部位 *
016020*    **********
016030     MOVE レセ−後療回数２             TO 後療回数２ＷＲ.
016040     MOVE レセ−後療料２               TO 後療料２ＷＲ.
016050     MOVE レセ−冷罨法回数２           TO 冷罨法回数２ＷＲ.
016060     MOVE レセ−冷罨法料２             TO 冷罨法料２ＷＲ.
016070     MOVE レセ−温罨法回数２           TO 温罨法回数２ＷＲ.
016080     MOVE レセ−温罨法料２             TO 温罨法料２ＷＲ.
016090     MOVE レセ−電療回数２             TO 電療回数２ＷＲ.
016100     MOVE レセ−電療料２               TO 電療料２ＷＲ.
016110*    ****************
016120*    * ３部位／８割 *
016130*    ****************
016140     MOVE レセ−後療回数３８             TO 後療回数３８ＷＲ.
016150     MOVE レセ−後療料３８               TO 後療料３８ＷＲ.
016160     MOVE レセ−冷罨法回数３８           TO 冷罨法回数３８ＷＲ.
016170     MOVE レセ−冷罨法料３８             TO 冷罨法料３８ＷＲ.
016180     MOVE レセ−温罨法回数３８           TO 温罨法回数３８ＷＲ.
016190     MOVE レセ−温罨法料３８             TO 温罨法料３８ＷＲ.
016200     MOVE レセ−電療回数３８             TO 電療回数３８ＷＲ.
016210     MOVE レセ−電療料３８               TO 電療料３８ＷＲ.
016220*    ****************
016230*    * ３部位／10割 *
016240*    ****************
016250     MOVE レセ−後療回数３０             TO 後療回数３０ＷＲ.
016260     MOVE レセ−後療料３０               TO 後療料３０ＷＲ.
016270     MOVE レセ−冷罨法回数３０           TO 冷罨法回数３０ＷＲ.
016280     MOVE レセ−冷罨法料３０             TO 冷罨法料３０ＷＲ.
016290     MOVE レセ−温罨法回数３０           TO 温罨法回数３０ＷＲ.
016300     MOVE レセ−温罨法料３０             TO 温罨法料３０ＷＲ.
016310     MOVE レセ−電療回数３０             TO 電療回数３０ＷＲ.
016320     MOVE レセ−電療料３０               TO 電療料３０ＷＲ.
016330*    ****************
016340*    * ３部位／合計 *
016350*    ****************
016360     COMPUTE 後療回数３ＷＲ      = 後療回数３８ＷＲ   + 後療回数３０ＷＲ.
016370     COMPUTE 後療料３ＷＲ        = 後療料３８ＷＲ     + 後療料３０ＷＲ.
016380     COMPUTE 冷罨法回数３ＷＲ    = 冷罨法回数３８ＷＲ + 冷罨法回数３０ＷＲ.
016390     COMPUTE 冷罨法料３ＷＲ      = 冷罨法料３８ＷＲ   + 冷罨法料３０ＷＲ.
016400     COMPUTE 温罨法回数３ＷＲ    = 温罨法回数３８ＷＲ + 温罨法回数３０ＷＲ.
016410     COMPUTE 温罨法料３ＷＲ      = 温罨法料３８ＷＲ   + 温罨法料３０ＷＲ.
016420     COMPUTE 電療回数３ＷＲ      = 電療回数３８ＷＲ   + 電療回数３０ＷＲ.
016430     COMPUTE 電療料３ＷＲ        = 電療料３８ＷＲ     + 電療料３０ＷＲ.
016440*    ****************
016450*    * ４部位／５割 *
016460*    ****************
016470     MOVE レセ−後療回数４５             TO 後療回数４５ＷＲ.
016480     MOVE レセ−後療料４５               TO 後療料４５ＷＲ.
016490     MOVE レセ−冷罨法回数４５           TO 冷罨法回数４５ＷＲ.
016500     MOVE レセ−冷罨法料４５             TO 冷罨法料４５ＷＲ.
016510     MOVE レセ−温罨法回数４５           TO 温罨法回数４５ＷＲ.
016520     MOVE レセ−温罨法料４５             TO 温罨法料４５ＷＲ.
016530     MOVE レセ−電療回数４５             TO 電療回数４５ＷＲ.
016540     MOVE レセ−電療料４５               TO 電療料４５ＷＲ.
016550*    ****************
016560*    * ４部位／８割 *
016570*    ****************
016580     MOVE レセ−後療回数４８             TO 後療回数４８ＷＲ.
016590     MOVE レセ−後療料４８               TO 後療料４８ＷＲ.
016600     MOVE レセ−冷罨法回数４８           TO 冷罨法回数４８ＷＲ.
016610     MOVE レセ−冷罨法料４８             TO 冷罨法料４８ＷＲ.
016620     MOVE レセ−温罨法回数４８           TO 温罨法回数４８ＷＲ.
016630     MOVE レセ−温罨法料４８             TO 温罨法料４８ＷＲ.
016640     MOVE レセ−電療回数４８             TO 電療回数４８ＷＲ.
016650     MOVE レセ−電療料４８               TO 電療料４８ＷＲ.
016660*    ****************
016670*    * ４部位／10割 *
016680*    ****************
016690     MOVE レセ−後療回数４０             TO 後療回数４０ＷＲ.
016700     MOVE レセ−後療料４０               TO 後療料４０ＷＲ.
016710     MOVE レセ−冷罨法回数４０           TO 冷罨法回数４０ＷＲ.
016720     MOVE レセ−冷罨法料４０             TO 冷罨法料４０ＷＲ.
016730     MOVE レセ−温罨法回数４０           TO 温罨法回数４０ＷＲ.
016740     MOVE レセ−温罨法料４０             TO 温罨法料４０ＷＲ.
016750     MOVE レセ−電療回数４０             TO 電療回数４０ＷＲ.
016760     MOVE レセ−電療料４０               TO 電療料４０ＷＲ.
016770*    ****************
016780*    * ４部位／合計 *
016790*    ****************
016800     COMPUTE 後療回数４ＷＲ      = 後療回数４５ＷＲ   + 後療回数４８ＷＲ   + 後療回数４０ＷＲ.
016810     COMPUTE 後療料４ＷＲ        = 後療料４５ＷＲ     + 後療料４８ＷＲ     + 後療料４０ＷＲ.
016820     COMPUTE 冷罨法回数４ＷＲ    = 冷罨法回数４５ＷＲ + 冷罨法回数４８ＷＲ + 冷罨法回数４０ＷＲ.
016830     COMPUTE 冷罨法料４ＷＲ      = 冷罨法料４５ＷＲ   + 冷罨法料４８ＷＲ   + 冷罨法料４０ＷＲ.
016840     COMPUTE 温罨法回数４ＷＲ    = 温罨法回数４５ＷＲ + 温罨法回数４８ＷＲ + 温罨法回数４０ＷＲ.
016850     COMPUTE 温罨法料４ＷＲ      = 温罨法料４５ＷＲ   + 温罨法料４８ＷＲ   + 温罨法料４０ＷＲ.
016860     COMPUTE 電療回数４ＷＲ      = 電療回数４５ＷＲ   + 電療回数４８ＷＲ   + 電療回数４０ＷＲ.
016870     COMPUTE 電療料４ＷＲ        = 電療料４５ＷＲ     + 電療料４８ＷＲ     + 電療料４０ＷＲ.
016880*    *****************
016890*    * ５部位／2.5割 *
016900*    *****************
016910     MOVE レセ−後療回数５２             TO 後療回数５２ＷＲ.
016920     MOVE レセ−後療料５２               TO 後療料５２ＷＲ.
016930     MOVE レセ−冷罨法回数５２           TO 冷罨法回数５２ＷＲ.
016940     MOVE レセ−冷罨法料５２             TO 冷罨法料５２ＷＲ.
016950     MOVE レセ−温罨法回数５２           TO 温罨法回数５２ＷＲ.
016960     MOVE レセ−温罨法料５２             TO 温罨法料５２ＷＲ.
016970     MOVE レセ−電療回数５２             TO 電療回数５２ＷＲ.
016980     MOVE レセ−電療料５２               TO 電療料５２ＷＲ.
016990*    ****************
017000*    * ５部位／５割 *
017010*    ****************
017020     MOVE レセ−後療回数５５             TO 後療回数５５ＷＲ.
017030     MOVE レセ−後療料５５               TO 後療料５５ＷＲ.
017040     MOVE レセ−冷罨法回数５５           TO 冷罨法回数５５ＷＲ.
017050     MOVE レセ−冷罨法料５５             TO 冷罨法料５５ＷＲ.
017060     MOVE レセ−温罨法回数５５           TO 温罨法回数５５ＷＲ.
017070     MOVE レセ−温罨法料５５             TO 温罨法料５５ＷＲ.
017080     MOVE レセ−電療回数５５             TO 電療回数５５ＷＲ.
017090     MOVE レセ−電療料５５               TO 電療料５５ＷＲ.
017100*    ****************
017110*    * ５部位／８割 *
017120*    ****************
017130     MOVE レセ−後療回数５８             TO 後療回数５８ＷＲ.
017140     MOVE レセ−後療料５８               TO 後療料５８ＷＲ.
017150     MOVE レセ−冷罨法回数５８           TO 冷罨法回数５８ＷＲ.
017160     MOVE レセ−冷罨法料５８             TO 冷罨法料５８ＷＲ.
017170     MOVE レセ−温罨法回数５８           TO 温罨法回数５８ＷＲ.
017180     MOVE レセ−温罨法料５８             TO 温罨法料５８ＷＲ.
017190     MOVE レセ−電療回数５８             TO 電療回数５８ＷＲ.
017200     MOVE レセ−電療料５８               TO 電療料５８ＷＲ.
017210*    ****************
017220*    * ５部位／10割 *
017230*    ****************
017240     MOVE レセ−後療回数５０             TO 後療回数５０ＷＲ.
017250     MOVE レセ−後療料５０               TO 後療料５０ＷＲ.
017260     MOVE レセ−冷罨法回数５０           TO 冷罨法回数５０ＷＲ.
017270     MOVE レセ−冷罨法料５０             TO 冷罨法料５０ＷＲ.
017280     MOVE レセ−温罨法回数５０           TO 温罨法回数５０ＷＲ.
017290     MOVE レセ−温罨法料５０             TO 温罨法料５０ＷＲ.
017300     MOVE レセ−電療回数５０             TO 電療回数５０ＷＲ.
017310     MOVE レセ−電療料５０               TO 電療料５０ＷＲ.
017320*    ****************
017330*    * ５部位／合計 *
017340*    ****************
017350     COMPUTE 後療回数５ＷＲ   = 後療回数５２ＷＲ   + 後療回数５５ＷＲ   +
017360                                後療回数５８ＷＲ   + 後療回数５０ＷＲ.
017370     COMPUTE 後療料５ＷＲ     = 後療料５２ＷＲ     + 後療料５５ＷＲ     +
017380                                後療料５８ＷＲ     + 後療料５０ＷＲ.
017390     COMPUTE 冷罨法回数５ＷＲ = 冷罨法回数５２ＷＲ + 冷罨法回数５５ＷＲ +
017400                                冷罨法回数５８ＷＲ + 冷罨法回数５０ＷＲ.
017410     COMPUTE 冷罨法料５ＷＲ   = 冷罨法料５２ＷＲ   + 冷罨法料５５ＷＲ   +
017420                                冷罨法料５８ＷＲ   + 冷罨法料５０ＷＲ.
017430     COMPUTE 温罨法回数５ＷＲ = 温罨法回数５２ＷＲ + 温罨法回数５５ＷＲ +
017440                                温罨法回数５８ＷＲ + 温罨法回数５０ＷＲ.
017450     COMPUTE 温罨法料５ＷＲ   = 温罨法料５２ＷＲ   + 温罨法料５５ＷＲ   +
017460                                温罨法料５８ＷＲ   + 温罨法料５０ＷＲ.
017470     COMPUTE 電療回数５ＷＲ   = 電療回数５２ＷＲ   + 電療回数５５ＷＲ   +
017480                                電療回数５８ＷＲ   + 電療回数５０ＷＲ.
017490     COMPUTE 電療料５ＷＲ     = 電療料５２ＷＲ     + 電療料５５ＷＲ     +
017500                                電療料５８ＷＲ     + 電療料５０ＷＲ.
017510*
017520*================================================================*
017530 負傷データ取得 SECTION.
017540*
017550**************************************************
017560* 連結データから負傷データＦより以下の情報を取得 *
017570* ● 部位＋負傷種別                              *
017580* ● 転帰区分 ....区分によりチェックに"○"を格納 *
017590* ● 金属副子 ....区分によりチェックに"○"を格納 *
017600* ● 経過コード...経過マスタより取得             *
017610**************************************************
017620     INITIALIZE 負傷情報Ｗ.
017630     MOVE SPACE TO 継続フラグ.
017640     MOVE 施術和暦ＷＲ       TO 負−施術和暦.
017650     MOVE 施術年ＷＲ         TO 負−施術年.
017660     MOVE 施術月ＷＲ         TO 負−施術月.
017670     MOVE 患者コードＷＲ     TO 負−患者コード.
017680     READ 負傷データＦ
017690     INVALID KEY
017700         CONTINUE
017710*            /* ありえない */
017720     NOT INVALID KEY
017730         MOVE 負−部位数                   TO 部位数Ｗ
017740         PERFORM VARYING 部位ＣＮＴ FROM 1 BY 1
017750                 UNTIL ( 部位ＣＮＴ > 部位数Ｗ )
017760             MOVE 負−負傷種別(部位ＣＮＴ) TO 負傷種別Ｗ(部位ＣＮＴ)
017770             MOVE 負−部位(部位ＣＮＴ)     TO 部位Ｗ(部位ＣＮＴ)
017780*
017790             MOVE 負−転帰区分(部位ＣＮＴ) TO 転帰区分Ｗ(部位ＣＮＴ)
017800*   --- 継続の部位があるか判定 ---
017810             IF 負−転帰区分(部位ＣＮＴ) = 9
017820                  MOVE "YES" TO 継続フラグ
017830             END-IF
017840*
017850         END-PERFORM
017860     END-READ.
017870*
017880*================================================================*
017890*================================================================*
017900 レセプト種別取得 SECTION.
017910*
017920     IF 受−助成種別  = ZERO
017930         EVALUATE TRUE
017940         WHEN (受−保険種別 = 01) AND (受−公費種別 = ZERO)
017950            MOVE "KOKU"    TO レセプト種類Ｗ
017960         WHEN (受−保険種別 = 02 OR 06 OR 07) AND (受−本人家族区分 = 1) AND (受−公費種別 = ZERO)
017970            MOVE "SYAH"    TO レセプト種類Ｗ
017980         WHEN (受−保険種別 = 02 OR 06 OR 07) AND (受−本人家族区分 = 2) AND (受−公費種別 = ZERO)
017990            MOVE "SYAK"    TO レセプト種類Ｗ
018000         WHEN (受−保険種別 = 03) AND (受−本人家族区分 = 1) AND (受−公費種別 = ZERO)
018010            MOVE "KUMH"    TO レセプト種類Ｗ
018020         WHEN (受−保険種別 = 03) AND (受−本人家族区分 = 2) AND (受−公費種別 = ZERO)
018030            MOVE "KUMK"    TO レセプト種類Ｗ
018040         WHEN (受−保険種別 = 04) AND (受−本人家族区分 = 1) AND (受−公費種別 = ZERO)
018050            MOVE "KYOH"    TO レセプト種類Ｗ
018060         WHEN (受−保険種別 = 04) AND (受−本人家族区分 = 2) AND (受−公費種別 = ZERO)
018070            MOVE "KYOK"    TO レセプト種類Ｗ
018080         WHEN 受−公費種別 = 05
018090            MOVE "ROUJ"    TO レセプト種類Ｗ
018100         WHEN (受−保険種別 = 08) AND (受−公費種別 = ZERO)
018110            MOVE "TAIS"    TO レセプト種類Ｗ
018120         WHEN (受−保険種別 = 09) AND (受−公費種別 = ZERO)
018130            MOVE "JIEI"    TO レセプト種類Ｗ
018140         WHEN OTHER
018150            CONTINUE
018160*** ※ 労災・自賠責 追加必要
018170*            MOVE  NC"保険種別が不正です。" TO 連メ−メッセージ
018180*            CALL   "MSG001"
018190*            CANCEL "MSG001"
018200*            PERFORM ファイル閉鎖
018210*            EXIT PROGRAM
018220         END-EVALUATE
018230     ELSE
018240** 助成がある時
018250         MOVE "JYOS"    TO レセプト種類Ｗ
018260     END-IF.
018270*
018280*================================================================*
018290******************************************************************
018300 END PROGRAM YAS101.
018310******************************************************************
