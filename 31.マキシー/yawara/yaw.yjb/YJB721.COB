000010******************************************************************
000020*            IDENTIFICATION      DIVISION                        *
000030******************************************************************
000040 IDENTIFICATION          DIVISION.
000050 PROGRAM-ID.             YJB721.
000060 AUTHOR.                 池田　幸子
000070*
000080*----------------------------------------------------------------*
000090*         施術明細【ﾃﾞｰﾀ作成】柔+ｳｨﾝﾄﾞｳｽﾞ版
000100*         MED = YJB720 
000110*----------------------------------------------------------------*
000120 DATE-WRITTEN.           2012-08-03
000130 DATE-COMPILED.          2012-08-03
000140*----------------------------------------------------------------*
      */新用紙（明細書発行加算追加）/220818
000150******************************************************************
000160*            ENVIRONMENT         DIVISION                        *
000170******************************************************************
000180 ENVIRONMENT             DIVISION.
000190 CONFIGURATION           SECTION.
000200 SOURCE-COMPUTER.        FMV-DESKPOWER-TS.
000210 OBJECT-COMPUTER.        FMV-DESKPOWER.
000220 SPECIAL-NAMES.          CONSOLE  IS  CONS
000230                         SYSERR   IS  MSGBOX.
000240 INPUT-OUTPUT            SECTION.
000250 FILE-CONTROL.
000370     SELECT  元号マスタ      ASSIGN      TO        GENGOUL
000380                             ORGANIZATION             IS  INDEXED
000390                             ACCESS MODE              IS  DYNAMIC
000400                             RECORD KEY               IS  元−元号区分
000410                             FILE STATUS              IS  状態キー
000420                             LOCK        MODE         IS  AUTOMATIC.
000260     SELECT  受診者情報Ｆ    ASSIGN      TO        JUSINJL
000270                             ORGANIZATION             IS  INDEXED
000280                             ACCESS MODE              IS  DYNAMIC
000290                             RECORD KEY               IS  受−施術和暦年月
000300                                                          受−患者コード
000310                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000320                                                          受−患者カナ
000330                                                          受−患者コード
000340                             ALTERNATE RECORD KEY     IS  受−患者コード
000350                                                          受−施術和暦年月
000360                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000370                                                          受−保険種別
000380                                                          受−保険者番号
000390                                                          受−患者コード
000400                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000410                                                          受−公費種別
000420                                                          受−費用負担者番号
000430                                                          受−患者コード
000440                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000450                                                          受−助成種別
000460                                                          受−費用負担者番号助成
000470                                                          受−患者コード
000480                             ALTERNATE RECORD KEY     IS  受−請求和暦年月
000490                                                          受−施術和暦年月
000500                                                          受−患者コード
000510                             FILE STATUS              IS  状態キー
000520                             LOCK        MODE         IS  AUTOMATIC.
           SELECT  負傷データＦ    ASSIGN      TO        HUSYOUL
                                   ORGANIZATION             IS  INDEXED
                                   ACCESS MODE              IS  DYNAMIC
                                   RECORD KEY               IS  負−施術和暦年月
                                                                負−患者コード
                                   ALTERNATE RECORD KEY     IS  負−患者コード
                                                                負−施術和暦年月
                                   FILE STATUS              IS  状態キー
                                   LOCK        MODE         IS  AUTOMATIC.
           SELECT  施術記録Ｆ      ASSIGN      TO      SEKIROKL
                                   ORGANIZATION        IS  INDEXED
                                   ACCESS MODE         IS  DYNAMIC
                                   RECORD KEY          IS  施記−施術和暦年月日
                                                           施記−患者コード
                                   ALTERNATE RECORD KEY IS 施記−患者コード
                                                           施記−施術和暦年月日
                                   FILE STATUS              IS  状態キー
                                   LOCK        MODE         IS  AUTOMATIC.
000400     SELECT  メモファイル    ASSIGN      TO        MEMOL
000410                             ORGANIZATION             IS  INDEXED
000420                             ACCESS MODE              IS  DYNAMIC
000430                             RECORD KEY               IS  メモ−制御区分
                                                                メモ−患者コード
                                                                メモ−施術和暦年月日
000360                             ALTERNATE RECORD KEY     IS  メモ−制御区分
                                                                メモ−施術和暦年月日
                                                                メモ−患者コード
000360                             ALTERNATE RECORD KEY     IS  メモ−患者コード
                                                                メモ−施術和暦年月日
                                                                メモ−制御区分
000440                             FILE STATUS              IS  状態キー
000450                             LOCK        MODE         IS  AUTOMATIC.
000130     SELECT  レセプトＦ      ASSIGN      TO        RECEPTL
000140                             ORGANIZATION             IS  INDEXED
000150                             ACCESS MODE              IS  DYNAMIC
000160                             RECORD KEY               IS  レセ−施術和暦年月
000170                                                          レセ−患者コード
000180                                                          レセ−レセ種別
000190                             ALTERNATE RECORD KEY     IS  レセ−患者コード
000200                                                          レセ−施術和暦年月
000210                                                          レセ−レセ種別
000220                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000230                                                          レセ−施術和暦年月
000240                                                          レセ−患者コード
000250                                                          レセ−レセ種別
000260                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000270                                                          レセ−レセ種別
000280                                                          レセ−請求保険者番号
000290                                                          レセ−患者コード
000300                                                          レセ−施術和暦年月
000310                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000320                                                          レセ−請求保険者番号
000330                                                          レセ−患者コード
000340                                                          レセ−レセ種別
000350                                                          レセ−施術和暦年月
000360                             FILE STATUS              IS  状態キー
000370                             LOCK        MODE         IS  AUTOMATIC.
000690     SELECT  会計データＦ    ASSIGN      TO        KAIKEIL
000700                             ORGANIZATION             IS  INDEXED
000710                             ACCESS MODE              IS  DYNAMIC
000089                             RECORD KEY               IS  会−施術和暦年月日
000090                                                          会−患者コード
000092                             ALTERNATE RECORD KEY     IS  会−患者コード
000093                                                          会−施術和暦年月日
000790                             FILE STATUS              IS  状態キー
000800                             LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル１  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7211L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作１−施術和暦年月日
000610                                                          作１−患者コード
000910                             ALTERNATE RECORD KEY     IS  作１−施術和暦年月日
                                                                作１−患者カナ
                                                                作１−患者コード
000910                             ALTERNATE RECORD KEY     IS  作１−患者コード
                                                                作１−施術和暦年月日
000910                             ALTERNATE RECORD KEY     IS  作１−患者カナ
                                                                作１−患者コード
                                                                作１−施術和暦年月日
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル２  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7212L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作２−施術和暦年月
000610                                                          作２−患者コード
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル３  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7213L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作３−施術和暦年月
000610                                                          作３−患者コード
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000530     SELECT  作業ファイル４  ASSIGN      TO "C:\MAKISHISYS\YAWOBJ\TEMP\W7214L.DAT"
000540                             ORGANIZATION             IS  INDEXED
000550                             ACCESS                   IS  DYNAMIC
000560                             RECORD      KEY          IS  作４−施術和暦年月日
000610                                                          作４−患者コード
000910                             ALTERNATE RECORD KEY     IS  作４−施術和暦年月日
                                                                作４−患者カナ
                                                                作４−患者コード
000910                             ALTERNATE RECORD KEY     IS  作４−患者コード
                                                                作４−施術和暦年月日
000910                             ALTERNATE RECORD KEY     IS  作４−患者カナ
                                                                作４−患者コード
                                                                作４−施術和暦年月日
000620                             FILE        STATUS       IS  状態キー
000630                             LOCK        MODE         IS  AUTOMATIC.
000640******************************************************************
000650*                      DATA DIVISION                             *
000660******************************************************************
000670 DATA                    DIVISION.
000680 FILE                    SECTION.
001500*                           ［ＲＬ＝  １２８］
001510 FD  元号マスタ          BLOCK   CONTAINS   1   RECORDS.
001520     COPY GENGOU          OF  XFDLIB  JOINING   元   AS  PREFIX.
000690*                           ［ＲＬ＝  ３２０］
000700 FD  受診者情報Ｆ        BLOCK   CONTAINS   1   RECORDS.
000710     COPY JUSINJ          OF  XFDLIB  JOINING   受   AS  PREFIX.
      *                           ［ＲＬ＝  ２５６］
       FD  施術記録Ｆ          BLOCK   CONTAINS   1   RECORDS.
          COPY SEKIROK         OF  XFDLIB  JOINING   施記 AS  PREFIX.
      *                           ［ＲＬ＝  １２８］
       FD  負傷データＦ        BLOCK   CONTAINS   1   RECORDS.
           COPY HUSYOU          OF  XFDLIB  JOINING   負   AS  PREFIX.
000600*                           ［ＲＬ＝  ８３２］
000610 FD  メモファイル        BLOCK CONTAINS 1     RECORDS.
000620     COPY MEMO           OF    XFDLIB JOINING メモ AS PREFIX.
      *                          ［ＲＬ＝  １５３６］
       FD  レセプトＦ          BLOCK   CONTAINS   1   RECORDS.
           COPY RECEPT          OF  XFDLIB  JOINING   レセ  AS  PREFIX.
001060*                           ［ＲＬ＝  ５１２］
001070 FD  会計データＦ        BLOCK   CONTAINS   1   RECORDS.
001080     COPY KAIKEI     OF  XFDLIB  JOINING   会   AS  PREFIX.
001310*****************
001320* 作業ファイル１ *
001330*****************
001340*                         ［ＲＬ＝  ３２０］
001350 FD  作業ファイル１ RECORD  CONTAINS 320 CHARACTERS.
001360 01 作１−レコード.
001370    03 作１−レコードキー.
001535       05 作１−施術和暦年月日.
001536          07 作１−施術和暦               PIC 9.
001537          07 作１−施術年月.
001538             09 作１−施術年              PIC 9(2).
001539             09 作１−施術月              PIC 9(2).
001540          07 作１−施術日                 PIC 9(2).
001460       05 作１−患者コード.
001470          07 作１−患者番号                PIC 9(6).
001480          07 作１−枝番                    PIC X(1).
001490    03 作１−レコードデータ.
             05 作１−患者カナ                   PIC X(50).
             05 作１−患者氏名                   PIC X(50).
             05 作１−料金.
                07 作１−初検                    OCCURS 4.
                   09 作１−初検等               PIC N(1).
001547          07 作１−部位データ              OCCURS 4.
                   09 作１−整復                 PIC N(1).
                   09 作１−後療                 PIC N(1).
                   09 作１−罨法                 PIC N(1).
                   09 作１−電療                 PIC N(1).
                07 作１−金属                    PIC N(1).
                07 作１−運動                    PIC N(1).
001550          07 作１−初検金額                PIC 9(5).
001550          07 作１−整復金額                PIC 9(5).
001550          07 作１−後療金額                PIC 9(5).
001550          07 作１−罨法金額                PIC 9(5).
001550          07 作１−電療金額                PIC 9(5).
001551          07 作１−明細書加算              PIC 9(4).
001551          07 作１−一部負担金              PIC 9(5).
001551          07 作１−コメント                PIC X(100).
001500       05 FILLER                           PIC X(28).
000920*
001340*                         ［ＲＬ＝  ６４］
001350 FD  作業ファイル２ RECORD  CONTAINS 64 CHARACTERS.
001360 01 作２−レコード.
001370    03 作２−レコードキー.
001535       05 作２−施術和暦年月.
001536          07 作２−施術和暦                PIC 9.
001537          07 作２−施術年月.
001538             09 作２−施術年               PIC 9(2).
001539             09 作２−施術月               PIC 9(2).
001460       05 作２−患者コード.
001470          07 作２−患者番号                PIC 9(6).
001480          07 作２−枝番                    PIC X(1).
001490    03 作２−レコードデータ.
             05 作２−初検計                     PIC 9(5).
001550       05 作２−整復計                     PIC 9(5).
001550       05 作２−後療計                     PIC 9(5).
001550       05 作２−罨法計                     PIC 9(5).
001550       05 作２−電療計                     PIC 9(5).
001551       05 作２−明細計                     PIC 9(4).
001551       05 作２−負担計                     PIC 9(5).
001500       05 FILLER                           PIC X(18).
001340*                         ［ＲＬ＝  ３２］
001350 FD  作業ファイル３ RECORD  CONTAINS 32 CHARACTERS.
001360 01 作３−レコード.
001370    03 作３−レコードキー.
001535       05 作３−施術和暦年月.
001536          07 作３−施術和暦                PIC 9.
001537          07 作３−施術年月.
001538             09 作３−施術年               PIC 9(2).
001539             09 作３−施術月               PIC 9(2).
001460       05 作３−患者コード.
001470          07 作３−患者番号                PIC 9(6).
001480          07 作３−枝番                    PIC X(1).
001490    03 作３−レコードデータ.
001420       05 作３−費用額                     PIC 9(6).
001420       05 作３−請求額                     PIC 9(6).
001420       05 作３−負担金                     PIC 9(5).
001500       05 FILLER                           PIC X(3).
001340*                         ［ＲＬ＝  ２５６］
001350 FD  作業ファイル４ RECORD  CONTAINS 256 CHARACTERS.
001360 01 作４−レコード.
001370    03 作４−レコードキー.
001535       05 作４−施術和暦年月日.
001537          07 作４−施術和暦年月.
001536             09 作４−施術和暦            PIC 9.
001538             09 作４−施術年              PIC 9(2).
001539             09 作４−施術月              PIC 9(2).
001540          07 作４−施術日                 PIC 9(2).
001460       05 作４−患者コード.
001470          07 作４−患者番号                PIC 9(6).
001480          07 作４−枝番                    PIC X(1).
001490    03 作４−レコードデータ.
             05 作４−患者カナ                   PIC X(50).
             05 作４−患者氏名                   PIC X(50).
             05 作４−料金.
                07 作４−初検                    OCCURS 4.
                   09 作４−初検等               PIC N(1).
001547          07 作４−部位データ              OCCURS 4.
                   09 作４−整復                 PIC N(1).
                   09 作４−後療                 PIC N(1).
                   09 作４−罨法                 PIC N(1).
                   09 作４−電療                 PIC N(1).
                07 作４−金属                    PIC N(1).
                07 作４−運動                    PIC N(1).
001550          07 作４−初検金額                PIC 9(5).
001550          07 作４−整復金額                PIC 9(5).
001550          07 作４−後療金額                PIC 9(5).
001550          07 作４−罨法金額                PIC 9(5).
001550          07 作４−電療金額                PIC 9(5).
001551          07 作４−明細書加算              PIC 9(4).
001551          07 作４−一部負担金              PIC 9(5).
001500       05 FILLER                           PIC X(60).
      *
000930*----------------------------------------------------------------*
000940******************************************************************
000950*                WORKING-STORAGE SECTION                         *
000960******************************************************************
000970 WORKING-STORAGE         SECTION.
000980 01 キー入力                           PIC X    VALUE SPACE.
000990 01 状態キー                           PIC X(2) VALUE SPACE.
001000 01 終了フラグ                         PIC X(3) VALUE SPACE.
002120 01 終了フラグ２                       PIC X(3) VALUE SPACE.
002120 01 終了フラグ３                       PIC X(3) VALUE SPACE.
001010 01 ファイル名                         PIC N(2) VALUE SPACE.
001180 01 実行キーＷ                         PIC X(4) VALUE SPACE.
       01 施術記録有Ｗ                       PIC X(3) VALUE SPACE.
001540 01 継続フラグ                         PIC X(3) VALUE SPACE.
001540 01 対象フラグ                         PIC X(3) VALUE SPACE.
001891 01 部位ＣＮＴ                         PIC 9    VALUE ZERO.
001891 01 カウンタ                           PIC 9    VALUE ZERO.
001020* **************
001030* * 項目待避用 
001040* **************
001050 01 待避項目ＷＲ.
001060    03 施術和暦年月ＷＲ.
001070       05 施術和暦ＷＲ                 PIC 9(1) VALUE ZERO.
001080       05 施術年ＷＲ                   PIC 9(2) VALUE ZERO.
001090       05 施術月ＷＲ                   PIC 9(2) VALUE ZERO.
001090    03 施術日ＷＲ                      PIC 9(2) VALUE ZERO.
          03 最終通院月Ｗ                    PIC 9(2) VALUE ZERO.
001090    03 最終通院日Ｗ                    PIC 9(2) VALUE ZERO.
          03 受理月Ｗ                        PIC 9(2) VALUE ZERO.
001090    03 受理日Ｗ                        PIC 9(2) VALUE ZERO.
001090    03 開始日ＷＰ                      PIC 9(2) VALUE ZERO.
001090    03 終了日ＷＰ                      PIC 9(2) VALUE ZERO.
001060    03 開始和暦年月日ＷＲ.
001060       05 開始和暦年月ＷＲ.
001070          07 開始和暦ＷＲ              PIC 9(1) VALUE ZERO.
001080          07 開始年ＷＲ                PIC 9(2) VALUE ZERO.
001090          07 開始月ＷＲ                PIC 9(2) VALUE ZERO.
001090       05 開始日ＷＲ                   PIC 9(2) VALUE ZERO.
001060    03 終了和暦年月日ＷＲ.
001060       05 終了和暦年月ＷＲ.
001070          07 終了和暦ＷＲ              PIC 9(1) VALUE ZERO.
001080          07 終了年ＷＲ                PIC 9(2) VALUE ZERO.
001090          07 終了月ＷＲ                PIC 9(2) VALUE ZERO.
001090       05 終了日ＷＲ                   PIC 9(2) VALUE ZERO.
001100    03 種別区分ＷＲ                    PIC X(4) VALUE SPACE.
001110    03 保険種別ＷＲ                    PIC 9(2) VALUE ZERO.
001120    03 患者コードＷＲ.
001130       05 患者番号ＷＲ                 PIC 9(6) VALUE ZERO.
001140       05 枝番ＷＲ                     PIC X(1) VALUE SPACE.
001150    03 本人家族区分ＷＲ                PIC 9(1) VALUE ZERO.
      *
          03 印刷条件ＷＲ                    PIC 9(2) VALUE ZERO.
001160*
001170 01 公費負担者番号Ｗ.
001180    03 法別番号Ｗ                      PIC X(2) VALUE SPACE.
001190    03 FILLER                          PIC X(8) VALUE SPACE.
001530 01 退避項目ＧＷ.
001540   03 レセプト種類Ｗ                 PIC X(4).
001550   03 レセプト種類ＧＷ               PIC X(4).
001560   03 レセプト種別ＧＷ               PIC 9(2).
001580*
001590 01 明細.
001600    03 初検料ＷＲ                    PIC 9(4)  VALUE ZERO.
001610    03 初検加算料ＷＲ                PIC 9(4)  VALUE ZERO.
001620    03 休日ＷＲ                      PIC 9     VALUE ZERO.
001630    03 深夜ＷＲ                      PIC 9     VALUE ZERO.
001640    03 時間外ＷＲ                    PIC 9     VALUE ZERO.
001650    03 診療時ＷＲ                    PIC 9(2)  VALUE ZERO.
001660    03 診療分ＷＲ                    PIC 9(2)  VALUE ZERO.
          03 初検時相談料ＷＲ              PIC 9(4)  VALUE ZERO.
001670    03 再検料ＷＲ                    PIC 9(4)  VALUE ZERO.
001680    03 往療夜間ＷＲ                  PIC 9     VALUE ZERO.
001690    03 往療難路ＷＲ                  PIC 9     VALUE ZERO.
001700    03 往療暴風ＷＲ                  PIC 9     VALUE ZERO.
001710    03 往療回数ＷＲ                  PIC 9(2)  VALUE ZERO.
001720    03 往療距離ＷＲ                  PIC 9(3)V9 VALUE ZERO.
001730    03 往療料ＷＲ                    PIC 9(6)  VALUE ZERO.
001740    03 往療加算料ＷＲ                PIC 9(5)  VALUE ZERO.
001750    03 電罨料ＷＲ                    PIC 9(4)  VALUE ZERO.
001760    03 一部負担金ＷＲ                PIC 9(5)  VALUE ZERO.
003530    03 金属副子加算料ＷＲ            PIC 9(5)  VALUE ZERO.
003140    03 運動後療料ＷＲ                PIC 9(4)  VALUE ZERO.
001770    03 施術情報提供料ＷＲ            PIC 9(6)  VALUE ZERO.
003140    03 明細書加算料ＷＲ              PIC 9(4)  VALUE ZERO.
001780    03 部位Ｗ                        OCCURS 4.
001790       05 初回処置料ＷＲ             PIC 9(4)  VALUE ZERO.
001800       05 後療料ＷＲ                 PIC 9(4)  VALUE ZERO.
001810       05 冷罨料ＷＲ                 PIC 9(4)  VALUE ZERO.
001820       05 温罨料ＷＲ                 PIC 9(4)  VALUE ZERO.
001830       05 電療料ＷＲ                 PIC 9(4)  VALUE ZERO.
001840       05 部位計ＷＲ                 PIC 9(4)  VALUE ZERO.
001850       05 金属ＷＲ                   PIC 9     VALUE ZERO.
001860    03 日数ＷＲ                      PIC 9(2)  OCCURS 5 VALUE ZERO.
001870    03 冷罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
001880    03 冷罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
001890    03 冷罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
001900    03 冷罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
001910    03 冷罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
001920    03 温罨法料３０ＷＲ              PIC 9(4)  VALUE ZERO.
001930    03 温罨法料３８ＷＲ              PIC 9(4)  VALUE ZERO.
001940    03 温罨法料４０ＷＲ              PIC 9(4)  VALUE ZERO.
001950    03 温罨法料４５ＷＲ              PIC 9(4)  VALUE ZERO.
001960    03 温罨法料４８ＷＲ              PIC 9(4)  VALUE ZERO.
001970    03 電療料３０ＷＲ                PIC 9(4)  VALUE ZERO.
001980    03 電療料３８ＷＲ                PIC 9(4)  VALUE ZERO.
001990    03 電療料４０ＷＲ                PIC 9(4)  VALUE ZERO.
002000    03 電療料４５ＷＲ                PIC 9(4)  VALUE ZERO.
002010    03 電療料４８ＷＲ                PIC 9(4)  VALUE ZERO.
002020    03 後療料３０ＷＲ                PIC 9(4)  VALUE ZERO.
002030    03 後療料３８ＷＲ                PIC 9(4)  VALUE ZERO.
002040    03 後療料４０ＷＲ                PIC 9(4)  VALUE ZERO.
002050    03 後療料４５ＷＲ                PIC 9(4)  VALUE ZERO.
002060    03 後療料４８ＷＲ                PIC 9(4)  VALUE ZERO.
002070    03 冷罨料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002080    03 温罨料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002090    03 電療料計ＷＲ                  PIC 9(4)  VALUE ZERO.
002100*
       01 集計Ｗ.
001600    03 初検計Ｗ                      PIC 9(5)  VALUE ZERO.
001600    03 整復計Ｗ                      PIC 9(5)  VALUE ZERO.
001800    03 後療計Ｗ                      PIC 9(5)  VALUE ZERO.
001810    03 罨法計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 電療計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 費用計Ｗ                      PIC 9(5)  VALUE ZERO.
001830    03 明細計Ｗ                      PIC 9(5)  VALUE ZERO.
001760    03 一部負担金計Ｗ                PIC 9(5)  VALUE ZERO.
002149** レセ下段の日付区分用 (0:最終通院日、1:月末日、9:印字なし)
002150 01 レセプト日付区分Ｗ                 PIC 9 VALUE ZERO.
002151 01 レセプト患者日付区分Ｗ             PIC 9 VALUE ZERO.
002617** 月末日用
002618 01 施術西暦年Ｗ                       PIC 9(4)  VALUE ZERO.
002619 01 商Ｗ                               PIC 9(3)  VALUE ZERO.
002620 01 余Ｗ                               PIC 9(3)  VALUE ZERO.
002621*
001200******************************************************************
001210*                          連結項目                              *
001220******************************************************************
001230*
003080****************
003090* 画面入力情報 *
003100****************
003110 01 連入−入力データＹＪＢ７２０ IS EXTERNAL.
003120    03 連入−開始和暦年月日.
003130       05 連入−開始和暦                  PIC 9(1).
003140       05 連入−開始年                    PIC 9(2).
003150       05 連入−開始月                    PIC 9(2).
003150       05 連入−開始日                    PIC 9(2).
003120    03 連入−終了和暦年月日.
003130       05 連入−終了和暦                  PIC 9(1).
003140       05 連入−終了年                    PIC 9(2).
003150       05 連入−終了月                    PIC 9(2).
003150       05 連入−終了日                    PIC 9(2).
003170    03 連入−保険種別                     PIC 9(2).
003180    03 連入−本人家族区分                 PIC 9(1).
003190    03 連入−患者コード.
003200       05 連入−患者番号                  PIC 9(6).
003210       05 連入−枝番                      PIC X(1).
          03 連入−印刷条件                     PIC 9(2).
003120    03 連入−レセ合計.
             05 連入−レセプト                OCCURS 5.
      */金額行の印字に年を入力出来るように変更(和暦は開始和暦を流用)
                07 連入−合計和暦年月.
                   09 連入−合計和暦            PIC 9.
                   09 連入−合計年              PIC 9(2).
                   09 連入−合計月              PIC 9(2).
003120          07 連入−請求年月日.
003140             09 連入−請求年              PIC 9(2).
003150             09 連入−請求月              PIC 9(2).
003150             09 連入−請求日              PIC 9(2).
003120          07 連入−領収年月日.
003140             09 連入−領収年              PIC 9(2).
003150             09 連入−領収月              PIC 9(2).
003150             09 連入−領収日              PIC 9(2).
      ************
      * 画面表示 *
      ************
002900 01 連画−対象フラグＹＪＢ７２０ IS EXTERNAL.
003120    03 連画−フラグ                       PIC 9(1).
      *
003110 01 連印字−印字データＹＪＢ７２１ IS EXTERNAL.
003170    03 連印字−初検計                     PIC 9(5).
003170    03 連印字−整復計                     PIC 9(5).
003170    03 連印字−後療計                     PIC 9(5).
003170    03 連印字−罨法計                     PIC 9(5).
003170    03 連印字−電療計                     PIC 9(5).
003170    03 連印字−明細計                     PIC 9(5).
003170    03 連印字−負担計                     PIC 9(5).
003170    03 連印字−費用額                     PIC 9(6).
003170    03 連印字−請求額                     PIC 9(6).
003170    03 連印字−負担金                     PIC 9(5).
006550*
001390******************************************************************
001400*                      PROCEDURE  DIVISION                       *
001410******************************************************************
001420 PROCEDURE               DIVISION.
001430************
001440*           *
001450* 初期処理   *
001460*           *
001470************
001480     PERFORM 初期化.
001490************
001500*           *
001510* 主処理     *
001520*           *
001530************
      *
           IF 連画−フラグ = 1
               PERFORM 作業ファイル４作成
               MOVE ZERO TO PROGRAM-STATUS
           ELSE
001540         PERFORM 作業ファイル作成
               IF 連入−レセ合計 NOT = SPACE
002210             OPEN OUTPUT 作業ファイル３
002220             MOVE NC"作３" TO ファイル名
002230             PERFORM オープンチェック
003720             MOVE 開始和暦ＷＲ      TO 受−施術和暦
003730             MOVE 開始年ＷＲ        TO 受−施術年
003740             MOVE 開始月ＷＲ        TO 受−施術月
                   MOVE 連入−患者コード  TO 受−患者コード
003790             READ 受診者情報Ｆ
                   NOT INVALID KEY
                       PERFORM 作３レコードセット
                   END-READ
                   CLOSE 作業ファイル３
               END-IF
           END-IF.
001550************
001560*           *
001570* 終了処理   *
001580*           *
001590************
001600     PERFORM 終了処理.
001610     MOVE ZERO TO PROGRAM-STATUS.
001620     EXIT PROGRAM.
001630*
001640*<<<<<<<<<<<<<<<<<<<<<<<<< END OF PROGRAM >>>>>>>>>>>>>>>>>>>>>>>>
001650*================================================================*
001660 初期化 SECTION.
001670*
001680     PERFORM ファイルオープン.
001690* 連結項目の待避
001700     INITIALIZE 待避項目ＷＲ.
001720     MOVE 連入−保険種別      TO 保険種別ＷＲ.
001730     MOVE 連入−患者番号      TO 患者番号ＷＲ.
001740     MOVE 連入−枝番          TO 枝番ＷＲ.
001750     MOVE 連入−開始和暦      TO 開始和暦ＷＲ.
001760     MOVE 連入−開始年        TO 開始年ＷＲ.
001770     MOVE 連入−開始月        TO 開始月ＷＲ.
001770     MOVE 連入−開始日        TO 開始日ＷＲ.
001750     MOVE 連入−終了和暦      TO 終了和暦ＷＲ.
001760     MOVE 連入−終了年        TO 終了年ＷＲ.
001770     MOVE 連入−終了月        TO 終了月ＷＲ.
001770     MOVE 連入−終了日        TO 終了日ＷＲ.
001780     MOVE 連入−本人家族区分  TO 本人家族区分ＷＲ.
      *
           MOVE 連入−印刷条件      TO 印刷条件ＷＲ.

001790*================================================================*
001800 ファイルオープン SECTION.
001810*
012140     OPEN INPUT   元号マスタ
012150         MOVE NC"元号" TO ファイル名.
012160         PERFORM オープンチェック.
001820     OPEN INPUT 受診者情報Ｆ.
001830         MOVE NC"受診者情報Ｆ" TO ファイル名.
001840         PERFORM オープンチェック.
           OPEN INPUT 負傷データＦ.
               MOVE NC"負傷データＦ" TO ファイル名.
               PERFORM オープンチェック.
           OPEN INPUT 施術記録Ｆ.
               MOVE NC"施術記録Ｆ"   TO ファイル名.
               PERFORM オープンチェック.
002780     OPEN INPUT メモファイル.
002790         MOVE NC"メモ"         TO ファイル名.
002800         PERFORM オープンチェック.
007870     OPEN INPUT レセプトＦ.
007880         MOVE NC"レセ"         TO ファイル名.
007890         PERFORM オープンチェック.
003060     OPEN INPUT 会計データＦ.
003070         MOVE NC"会計" TO ファイル名.
003080         PERFORM オープンチェック.
001850*================================================================*
001860 オープンチェック SECTION.
001870*
001880     IF 状態キー  NOT =  "00"
001890         DISPLAY ファイル名 NC"Ｆオープンエラー" UPON CONS
001900         DISPLAY NC"状態キー：" 状態キー         UPON CONS
001910         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
001920                                                 UPON CONS
003131*-----------------------------------------*
003132         CALL "actcshm"  WITH C LINKAGE
003133*-----------------------------------------*
001930         ACCEPT  キー入力 FROM CONS
001940         PERFORM ファイル閉鎖
001950         MOVE 99 TO PROGRAM-STATUS
001960         EXIT PROGRAM.
001970*================================================================*
001980 ファイル閉鎖 SECTION.
001990*
002000     CLOSE 元号マスタ  受診者情報Ｆ 負傷データＦ 施術記録Ｆ
                 メモファイル レセプトＦ 会計データＦ.
002010*================================================================*
002020 終了処理 SECTION.
002030*
002040     PERFORM ファイル閉鎖.
002050*================================================================*
002060 エラー表示 SECTION.
002070*
002080     DISPLAY NC"状態キー" 状態キー  UPON CONS.
002090     DISPLAY NC"５ファイル書込エラー：" ファイル名   UPON CONS.
002100     DISPLAY NC"システム管理者に連絡してください"  UPON CONS.
002110     DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"                                                                    UPON CONS.
003131*-----------------------------------------*
003132     CALL "actcshm"  WITH C LINKAGE.
003133*-----------------------------------------*
002120     ACCEPT  キー入力 FROM CONS.
002130     PERFORM ファイル閉鎖.
002140     MOVE 99 TO PROGRAM-STATUS.
002150     EXIT PROGRAM.
003960*================================================================*
003970 受診者情報Ｆ読込 SECTION.
003980*
003990     READ 受診者情報Ｆ NEXT
004000     AT END
004010         MOVE "YES" TO 終了フラグ
004020     END-READ.
002160*================================================================*
002170 作業ファイル作成 SECTION.
002180*
002210     OPEN OUTPUT 作業ファイル１
002220          MOVE NC"作１" TO ファイル名
002230          PERFORM オープンチェック
002210     OPEN OUTPUT 作業ファイル２
002220          MOVE NC"作２" TO ファイル名
002230          PERFORM オープンチェック
      *
003720     MOVE 開始和暦ＷＲ      TO 受−施術和暦.
003730     MOVE 開始年ＷＲ        TO 受−施術年.
003740     MOVE 開始月ＷＲ        TO 受−施術月.
           MOVE SPACE             TO 受−患者カナ.
           MOVE SPACE             TO 受−患者コード.
003790     START 受診者情報Ｆ   KEY IS >= 受−施術和暦年月
                                          受−患者カナ
                                          受−患者コード
003830     IF 状態キー = "00"
003840         MOVE SPACE  TO 終了フラグ
003850         PERFORM 受診者情報Ｆ読込
003860         PERFORM UNTIL ( 終了フラグ = "YES" ) OR
003870                       ( 受−施術和暦年月 > 終了和暦年月ＷＲ )
      */印刷対象条件の判定
001110                 IF ((保険種別ＷＲ     NOT = ZERO)              AND
                           (保険種別ＷＲ     NOT = 受−保険種別))     OR
HILO                      ((患者番号ＷＲ     NOT = ZERO)              AND
HILO                       (患者コードＷＲ   NOT = 受−患者コード))   OR
001150                    ((本人家族区分ＷＲ NOT = ZERO)              AND
                           (本人家族区分ＷＲ NOT = 受−本人家族区分)) OR
                           (受−保険種別         = 70 OR 80 OR 90)
      */対象外
                           CONTINUE
                       ELSE
      */印刷条件ＷＲ←保留
                           MOVE "YES" TO 対象フラグ
                           IF 印刷条件ＷＲ NOT = ZERO
                               PERFORM 印刷条件判定
                           END-IF
                           IF 対象フラグ = "YES"
                               PERFORM データチェック
                               IF 実行キーＷ = "YES"
                                   MOVE 受−施術和暦年月 TO 施術和暦年月ＷＲ
                                   IF 受−施術和暦年月 = 開始和暦年月ＷＲ
                                       MOVE 開始日ＷＲ TO 開始日ＷＰ
                                   ELSE
                                       MOVE 1          TO 開始日ＷＰ
                                   END-IF
                                   IF 受−施術和暦年月 = 終了和暦年月ＷＲ
                                       MOVE 終了日ＷＲ TO 終了日ＷＰ
                                   ELSE
                                       PERFORM 月末日取得
                                       MOVE 受理日Ｗ   TO 終了日ＷＰ
                                   END-IF
003910                             PERFORM 作１レコードセット
003910                             PERFORM 作２レコードセット
                               END-IF
                           END-IF
                       END-IF
003930                 PERFORM 受診者情報Ｆ読込
003940         END-PERFORM
003950     END-IF.
002810     CLOSE 作業ファイル１ 作業ファイル２.
004030*================================================================*
004040 作１レコードセット SECTION.
004050*
008270     INITIALIZE 作１−レコード.
004130     MOVE 受−患者コード   TO 作１−患者コード.
           MOVE 受−患者カナ     TO 作１−患者カナ.
           MOVE 受−患者氏名     TO 作１−患者氏名.
           PERFORM VARYING 施術日ＷＲ FROM 開始日ＷＰ BY 1
                   UNTIL ( 施術日ＷＲ > 終了日ＷＰ )
               INITIALIZE 作１−料金
009180         MOVE 受−患者番号  TO 会−患者番号
009190         MOVE 受−枝番      TO 会−枝番
009200         MOVE 受−施術和暦  TO 会−施術和暦
009210         MOVE 受−施術年    TO 会−施術年
009220         MOVE 受−施術月    TO 会−施術月
009230         MOVE 施術日ＷＲ    TO 会−施術日
009240         READ 会計データＦ
               NOT INVALID KEY
                   PERFORM 料金情報取得
                   PERFORM 項目ごと計算
                   PERFORM 作業ファイルセット
                   PERFORM 作１レコード書込
               END-READ
           END-PERFORM.
008240*================================================================*
008250 作業ファイルセット SECTION.
008260*
008280     MOVE 会−施術和暦       TO 作１−施術和暦 メモ−施術和暦.
008290     MOVE 会−施術年         TO 作１−施術年 メモ−施術年.
008300     MOVE 会−施術月         TO 作１−施術月 メモ−施術月.
008310     MOVE 施術日ＷＲ         TO 作１−施術日 メモ−施術日.
008330     MOVE 明細書加算料ＷＲ   TO 作１−明細書加算.
008330     MOVE 一部負担金ＷＲ     TO 作１−一部負担金.
           MOVE 1                  TO メモ−制御区分.
004130     MOVE 受−患者コード     TO メモ−患者コード.
           READ メモファイル
           NOT INVALID KEY
               MOVE メモ−施術コメント TO 作１−コメント
           END-READ.
008240*================================================================*
008250 作業２ファイルセット SECTION.
008260*
008280     MOVE 会−施術和暦       TO 作２−施術和暦.
008290     MOVE 会−施術年         TO 作２−施術年.
008300     MOVE 会−施術月         TO 作２−施術月.
           MOVE 初検計Ｗ           TO 作２−初検計.
           MOVE 整復計Ｗ           TO 作２−整復計.
           MOVE 後療計Ｗ           TO 作２−後療計.
           MOVE 罨法計Ｗ           TO 作２−罨法計.
           MOVE 電療計Ｗ           TO 作２−電療計.
           MOVE 明細計Ｗ           TO 作２−明細計.
           MOVE 一部負担金計Ｗ     TO 作２−負担計.
004030*================================================================*
004040 作２レコードセット SECTION.
004050*
008270     INITIALIZE 作２−レコード.
           MOVE SPACE TO 集計Ｗ.
004130     MOVE 受−患者コード   TO 作２−患者コード.
           PERFORM VARYING 施術日ＷＲ FROM 1 BY 1
                   UNTIL ( 施術日ＷＲ > 31 )
               INITIALIZE 作１−料金
009770         MOVE 受−患者番号  TO 会−患者番号
009780         MOVE 受−枝番      TO 会−枝番
009790         MOVE 受−施術和暦  TO 会−施術和暦
009800         MOVE 受−施術年    TO 会−施術年
009810         MOVE 受−施術月    TO 会−施術月
009820         MOVE 施術日ＷＲ    TO 会−施術日
009830         READ 会計データＦ
               NOT INVALID KEY
                   PERFORM 集計
               END-READ
           END-PERFORM.
           PERFORM 作業２ファイルセット.
           PERFORM 作２レコード書込.
004030*================================================================*
004040 作３レコードセット SECTION.
004050*
      */金額行の計算の不具合を修正。指定月にレコードが無い場合は計算しない。
           PERFORM VARYING カウンタ FROM 1 BY 1
                   UNTIL ( カウンタ > 5 )
HILO***               IF 連入−合計月(カウンタ) NOT = ZERO
               MOVE 連入−合計和暦(カウンタ) TO 受−施術和暦
               MOVE 連入−合計年  (カウンタ) TO 受−施術年
               MOVE 連入−合計月  (カウンタ) TO 受−施術月
               MOVE 連入−患者コード         TO 受−患者コード
               READ 受診者情報Ｆ
               INVALID KEY
                   CONTINUE
               NOT INVALID KEY
008270             INITIALIZE 作３−レコード
                   PERFORM 料金情報取得２
004130             MOVE レセ−患者コード   TO 作３−患者コード
008280             MOVE レセ−施術和暦     TO 作３−施術和暦
008290             MOVE レセ−施術年       TO 作３−施術年
008300             MOVE レセ−施術月       TO 作３−施術月
                   PERFORM 作３レコード書込
HILO***               END-IF
               END-READ
           END-PERFORM.
002160*================================================================*
002170 作業ファイル４作成 SECTION.
002180*
002210     OPEN OUTPUT 作業ファイル４
002220          MOVE NC"作４" TO ファイル名
002230          PERFORM オープンチェック
      *
003720     MOVE 開始和暦ＷＲ      TO 受−施術和暦.
003730     MOVE 開始年ＷＲ        TO 受−施術年.
003740     MOVE 開始月ＷＲ        TO 受−施術月.
           MOVE SPACE             TO 受−患者カナ.
           MOVE SPACE             TO 受−患者コード.
003790     START 受診者情報Ｆ   KEY IS >= 受−施術和暦年月
                                          受−患者カナ
                                          受−患者コード
003830     IF 状態キー = "00"
003840         MOVE SPACE  TO 終了フラグ
003850         PERFORM 受診者情報Ｆ読込
003860         PERFORM UNTIL ( 終了フラグ = "YES" ) OR
003870                       ( 受−施術和暦年月 > 終了和暦年月ＷＲ )
      */印刷対象条件の判定
001110                 IF ((保険種別ＷＲ     NOT = ZERO)              AND
                           (保険種別ＷＲ     NOT = 受−保険種別))     OR
HILO                      ((患者番号ＷＲ     NOT = ZERO)              AND
HILO                       (患者コードＷＲ   NOT = 受−患者コード))   OR
001150                    ((本人家族区分ＷＲ NOT = ZERO)              AND
                           (本人家族区分ＷＲ NOT = 受−本人家族区分)) OR
                           (受−保険種別         = 70 OR 80 OR 90)
      */対象外
                           CONTINUE
                       ELSE
      */印刷条件ＷＲ←保留
                           MOVE "YES" TO 対象フラグ
                           IF 印刷条件ＷＲ NOT = ZERO
                               PERFORM 印刷条件判定
                           END-IF
                           IF 対象フラグ = "YES"
                               PERFORM データチェック
                               IF 実行キーＷ = "YES"
                                   MOVE 受−施術和暦年月 TO 施術和暦年月ＷＲ
                                   MOVE 1          TO 開始日ＷＰ
                                   PERFORM 月末日取得
                                   MOVE 受理日Ｗ   TO 終了日ＷＰ
003910                             PERFORM 作４レコードセット
003910                             PERFORM 印字データセット
                               END-IF
                           END-IF
                       END-IF
003930                 PERFORM 受診者情報Ｆ読込
003940         END-PERFORM
003950     END-IF.
002810     CLOSE 作業ファイル４.
004030*================================================================*
004040 作４レコードセット SECTION.
004050*
008270     INITIALIZE 作４−レコード.
004130     MOVE 受−患者コード   TO 作４−患者コード.
           MOVE 受−患者カナ     TO 作４−患者カナ.
           MOVE 受−患者氏名     TO 作４−患者氏名.
           PERFORM VARYING 施術日ＷＲ FROM 開始日ＷＰ BY 1
                   UNTIL ( 施術日ＷＲ > 終了日ＷＰ )
               INITIALIZE 作４−料金
009180         MOVE 受−患者番号  TO 会−患者番号
009190         MOVE 受−枝番      TO 会−枝番
009200         MOVE 受−施術和暦  TO 会−施術和暦
009210         MOVE 受−施術年    TO 会−施術年
009220         MOVE 受−施術月    TO 会−施術月
009230         MOVE 施術日ＷＲ    TO 会−施術日
009240         READ 会計データＦ
               NOT INVALID KEY
                   PERFORM 料金情報取得４
                   PERFORM 項目ごと計算４
                   PERFORM 作業ファイル４セット
                   PERFORM 作４レコード書込
               END-READ
           END-PERFORM.
008240*================================================================*
008250 作業ファイル４セット SECTION.
008260*
008280     MOVE 会−施術和暦       TO 作４−施術和暦.
008290     MOVE 会−施術年         TO 作４−施術年.
008300     MOVE 会−施術月         TO 作４−施術月.
008310     MOVE 施術日ＷＲ         TO 作４−施術日.
008330     MOVE 明細書加算料ＷＲ   TO 作４−明細書加算.
008330     MOVE 一部負担金ＷＲ     TO 作４−一部負担金.
008240*================================================================*
008250 印字セット SECTION.
008260*
           MOVE 初検計Ｗ           TO 連印字−初検計.
           MOVE 整復計Ｗ           TO 連印字−整復計.
           MOVE 後療計Ｗ           TO 連印字−後療計.
           MOVE 罨法計Ｗ           TO 連印字−罨法計.
           MOVE 電療計Ｗ           TO 連印字−電療計.
           MOVE 明細計Ｗ           TO 連印字−明細計.
           MOVE 一部負担金計Ｗ     TO 連印字−負担計.
004030*================================================================*
004040 印字データセット SECTION.
004050*
           MOVE SPACE TO 集計Ｗ.
           PERFORM VARYING 施術日ＷＲ FROM 1 BY 1
                   UNTIL ( 施術日ＷＲ > 31 )
009180         MOVE 受−患者番号  TO 会−患者番号
009190         MOVE 受−枝番      TO 会−枝番
009200         MOVE 受−施術和暦  TO 会−施術和暦
009210         MOVE 受−施術年    TO 会−施術年
009220         MOVE 受−施術月    TO 会−施術月
009230         MOVE 施術日ＷＲ    TO 会−施術日
009240         READ 会計データＦ
               NOT INVALID KEY
                   PERFORM 集計
               END-READ
           END-PERFORM.
           PERFORM 料金情報取得３.
           PERFORM 印字セット.
010900*================================================================*
010910 料金情報取得 SECTION.
010920*
010930***********************************************
010940* 料金データセット                            *
010950***********************************************
010960*    ****************************************************************
010970*    * 料金（月毎）（負傷毎）（逓減毎）については連結項目よりセット *
010980*    ****************************************************************
           MOVE 1  TO カウンタ.
010990     MOVE 会−初検料             TO  初検料ＷＲ.
           IF 初検料ＷＲ NOT = ZERO
               MOVE NC"初"               TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011000*
011010     MOVE 会−初検加算料         TO  初検加算料ＷＲ.
011020     MOVE 会−休日               TO  休日ＷＲ.
           IF 休日ＷＲ NOT = ZERO
               MOVE NC"休"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011030     MOVE 会−深夜               TO  深夜ＷＲ.
           IF 深夜ＷＲ NOT = ZERO
               MOVE NC"深"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011040     MOVE 会−時間外             TO  時間外ＷＲ.
           IF 時間外ＷＲ NOT = ZERO
               MOVE NC"時"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
           MOVE 会−初検時相談料       TO  初検時相談料ＷＲ.
           IF 初検時相談料ＷＲ NOT = ZERO
               MOVE NC"相"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011050     MOVE 会−再検料             TO  再検料ＷＲ.
           IF 再検料ＷＲ NOT = ZERO
               MOVE NC"再"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011080     MOVE 会−往療料             TO  往療料ＷＲ.
           IF 往療料ＷＲ NOT = ZERO
               MOVE NC"往"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011090     MOVE 会−往療加算料         TO  往療加算料ＷＲ.
011100     MOVE 会−夜間               TO  往療夜間ＷＲ.
           IF 往療夜間ＷＲ NOT = ZERO
               MOVE NC"夜"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011110     MOVE 会−難路               TO  往療難路ＷＲ.
           IF 往療難路ＷＲ NOT = ZERO
               MOVE NC"難"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011120     MOVE 会−暴風雨雪           TO  往療暴風ＷＲ.
           IF 往療暴風ＷＲ NOT = ZERO
               MOVE NC"暴"             TO  作１−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
      *
           COMPUTE 作１−初検金額 = 初検料ＷＲ + 初検加算料ＷＲ + 再検料ＷＲ + 往療料ＷＲ +
                                    往療加算料ＷＲ + 初検時相談料ＷＲ.
011360*
      *     IF 受−助成種別 = ZERO
              MOVE 会−一部負担金   TO 一部負担金ＷＲ.
      *     ELSE
      *        MOVE 会−助成計算負担額   TO 一部負担金ＷＲ
      *     END-IF.
      *
           MOVE 会−明細書発行加算料   TO 明細書加算料ＷＲ.
      *
010900*================================================================*
010910 料金情報取得４ SECTION.
010920*
010930***********************************************
010940* 料金データセット                            *
010950***********************************************
010960*    ****************************************************************
010970*    * 料金（月毎）（負傷毎）（逓減毎）については連結項目よりセット *
010980*    ****************************************************************
           MOVE 1  TO カウンタ.
010990     MOVE 会−初検料             TO  初検料ＷＲ.
           IF 初検料ＷＲ NOT = ZERO
               MOVE NC"初"               TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011000*
011010     MOVE 会−初検加算料         TO  初検加算料ＷＲ.
011020     MOVE 会−休日               TO  休日ＷＲ.
           IF 休日ＷＲ NOT = ZERO
               MOVE NC"休"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011030     MOVE 会−深夜               TO  深夜ＷＲ.
           IF 深夜ＷＲ NOT = ZERO
               MOVE NC"深"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011040     MOVE 会−時間外             TO  時間外ＷＲ.
           IF 時間外ＷＲ NOT = ZERO
               MOVE NC"時"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
           MOVE 会−初検時相談料       TO  初検時相談料ＷＲ.
           IF 初検時相談料ＷＲ NOT = ZERO
               MOVE NC"相"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011050     MOVE 会−再検料             TO  再検料ＷＲ.
           IF 再検料ＷＲ NOT = ZERO
               MOVE NC"再"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011080     MOVE 会−往療料             TO  往療料ＷＲ.
           IF 往療料ＷＲ NOT = ZERO
               MOVE NC"往"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011090     MOVE 会−往療加算料         TO  往療加算料ＷＲ.
011100     MOVE 会−夜間               TO  往療夜間ＷＲ.
           IF 往療夜間ＷＲ NOT = ZERO
               MOVE NC"夜"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011110     MOVE 会−難路               TO  往療難路ＷＲ.
           IF 往療難路ＷＲ NOT = ZERO
               MOVE NC"難"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
011120     MOVE 会−暴風雨雪           TO  往療暴風ＷＲ.
           IF 往療暴風ＷＲ NOT = ZERO
               MOVE NC"暴"             TO  作４−初検等(カウンタ)
               COMPUTE カウンタ = カウンタ + 1
           END-IF.
      *
           COMPUTE 作４−初検金額 = 初検料ＷＲ + 初検加算料ＷＲ + 再検料ＷＲ + 往療料ＷＲ +
                                    往療加算料ＷＲ + 初検時相談料ＷＲ.
011360*
      *     IF 受−助成種別 = ZERO
              MOVE 会−一部負担金   TO 一部負担金ＷＲ.
      *     ELSE
      *        MOVE 会−助成計算負担額   TO 一部負担金ＷＲ
      *     END-IF.
      *
           MOVE 会−明細書発行加算料   TO 明細書加算料ＷＲ.
      *
010900*================================================================*
010910 料金情報取得２ SECTION.
010920*
           IF 受−助成種別 NOT = ZERO
              MOVE  3   TO レセ−レセ種別
           ELSE
              IF 受−公費種別 NOT = ZERO
                 MOVE  2   TO レセ−レセ種別
              ELSE
                 MOVE  1   TO レセ−レセ種別
              END-IF
           END-IF.
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           NOT INVALID KEY
012350        MOVE レセ−一部負担金   TO 作３−負担金
012400        MOVE レセ−合計         TO 作３−費用額
012410        MOVE レセ−請求金額     TO 作３−請求額
           END-READ.
010900*================================================================*
010910 料金情報取得３ SECTION.
010920*
           IF 受−助成種別 NOT = ZERO
              MOVE  3   TO レセ−レセ種別
           ELSE
              IF 受−公費種別 NOT = ZERO
                 MOVE  2   TO レセ−レセ種別
              ELSE
                 MOVE  1   TO レセ−レセ種別
              END-IF
           END-IF.
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           NOT INVALID KEY
012350        MOVE レセ−一部負担金   TO 連印字−負担金
012400        MOVE レセ−合計         TO 連印字−費用額
012410        MOVE レセ−請求金額     TO 連印字−請求額
           END-READ.
011370*================================================================*
011380 項目ごと計算 SECTION.
011390***********************************************
011400* 料金データセット                            *
011410***********************************************
013980     PERFORM VARYING カウンタ FROM 1 BY 1
013990             UNTIL ( カウンタ > 4 )
017100         MOVE 会−初回処置料(カウンタ) TO 初回処置料ＷＲ(カウンタ)
018011         IF 会−初回処置料(カウンタ) NOT = ZERO
018013            EVALUATE 負−負傷種別(カウンタ)
018014* 捻挫・打撲・挫傷
018015            WHEN 1
018016            WHEN 2
018017            WHEN 3
018018                MOVE NC"施"       TO 作１−整復(カウンタ)
018019* 脱臼・骨折・骨折拘縮
018020            WHEN 4
018021            WHEN 5
018022            WHEN 7
018023                MOVE NC"整"       TO 作１−整復(カウンタ)
018024* 不全骨折・不全骨折拘縮
018026            WHEN 6
018027            WHEN 8
018028                MOVE NC"固"       TO 作１−整復(カウンタ)
018029            END-EVALUATE
018030         END-IF
018031     END-PERFORM.
015100     MOVE 会−運動後療料         TO  運動後療料ＷＲ.
           IF 運動後療料ＷＲ NOT = ZERO
               MOVE NC"運"             TO  作１−運動
           END-IF.
011130*
011140     MOVE 会−金属副子加算料     TO  金属副子加算料ＷＲ.
           IF 金属副子加算料ＷＲ NOT = ZERO
               MOVE NC"金"             TO  作１−金属
           END-IF.
011150*
011160     MOVE 会−施術情報提供料     TO  施術情報提供料ＷＲ.
      *
017120     COMPUTE 作１−整復金額 = 会−初回処置料合計 + 金属副子加算料ＷＲ +
                                    運動後療料ＷＲ + 施術情報提供料ＷＲ.
      *
011450     MOVE 会−後療料１     TO 後療料ＷＲ(1).
011460     MOVE 会−後療料２     TO 後療料ＷＲ(2).
011470     MOVE 会−後療料３８   TO 後療料３８ＷＲ.
011480     MOVE 会−後療料３０   TO 後療料３０ＷＲ.
011490     COMPUTE 後療料ＷＲ(3)   = 後療料３８ＷＲ   + 後療料３０ＷＲ.
011500     MOVE 会−後療料４５   TO 後療料４５ＷＲ.
011510     MOVE 会−後療料４８   TO 後療料４８ＷＲ.
011520     MOVE 会−後療料４０   TO 後療料４０ＷＲ.
011530     COMPUTE 後療料ＷＲ(4)   = 後療料４５ＷＲ   + 後療料４８ＷＲ   + 後療料４０ＷＲ.
011530     COMPUTE 作１−後療金額 = 後療料ＷＲ(1) + 後療料ＷＲ(2) + 後療料ＷＲ(3) + 後療料ＷＲ(4).
011570********************
011580* 逓減毎料金セット *
011590********************
011600     MOVE 会−冷罨法料１             TO 冷罨料ＷＲ(1).
011610     MOVE 会−冷罨法料２             TO 冷罨料ＷＲ(2).
011620     MOVE 会−冷罨法料３８           TO 冷罨法料３８ＷＲ.
011630     MOVE 会−冷罨法料３０           TO 冷罨法料３０ＷＲ.
011640     COMPUTE 冷罨料ＷＲ(3)   = 冷罨法料３８ＷＲ  + 冷罨法料３０ＷＲ.
011650     MOVE 会−冷罨法料４５           TO 冷罨法料４５ＷＲ.
011660     MOVE 会−冷罨法料４８           TO 冷罨法料４８ＷＲ.
011670     MOVE 会−冷罨法料４０           TO 冷罨法料４０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(4)   = 冷罨法料４５ＷＲ  + 冷罨法料４８ＷＲ  + 冷罨法料４０ＷＲ.
011690     COMPUTE 冷罨料計ＷＲ = 冷罨料ＷＲ(1) + 冷罨料ＷＲ(2) + 冷罨料ＷＲ(3) + 冷罨料ＷＲ(4).
           IF 冷罨料ＷＲ(1) NOT = ZERO
               MOVE NC"冷"  TO 作１−罨法(1)
           END-IF.
           IF 冷罨料ＷＲ(2) NOT = ZERO
               MOVE NC"冷"  TO 作１−罨法(2)
           END-IF.
           IF 冷罨法料３０ＷＲ NOT = ZERO
               MOVE NC"冷"  TO 作１−罨法(3)
           END-IF.
           IF 冷罨法料３８ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作１−罨法(3)
           END-IF.
           IF 冷罨法料４０ＷＲ NOT = ZERO
               MOVE NC"冷"  TO 作１−罨法(4)
           END-IF.
           IF 冷罨法料４５ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作１−罨法(4)
           END-IF.
           IF 冷罨法料４８ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作１−罨法(4)
           END-IF.
011700*
011710     MOVE 会−温罨法料１             TO 温罨料ＷＲ(1).
011720     MOVE 会−温罨法料２             TO 温罨料ＷＲ(2).
011730     MOVE 会−温罨法料３８           TO 温罨法料３８ＷＲ.
011740     MOVE 会−温罨法料３０           TO 温罨法料３０ＷＲ.
011750     COMPUTE 温罨料ＷＲ(3)   = 温罨法料３８ＷＲ  + 温罨法料３０ＷＲ.
011760     MOVE 会−温罨法料４５           TO 温罨法料４５ＷＲ.
011770     MOVE 会−温罨法料４８           TO 温罨法料４８ＷＲ.
011780     MOVE 会−温罨法料４０           TO 温罨法料４０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(4)   = 温罨法料４５ＷＲ  + 温罨法料４８ＷＲ  + 温罨法料４０ＷＲ.
011800     COMPUTE 温罨料計ＷＲ = 温罨料ＷＲ(1) + 温罨料ＷＲ(2) + 温罨料ＷＲ(3) + 温罨料ＷＲ(4).
           COMPUTE 作１−罨法金額 = 冷罨料計ＷＲ + 温罨料計ＷＲ.
011810*
011820     MOVE 会−電療料１             TO 電療料ＷＲ(1).
011830     MOVE 会−電療料２             TO 電療料ＷＲ(2).
011840     MOVE 会−電療料３８           TO 電療料３８ＷＲ.
011850     MOVE 会−電療料３０           TO 電療料３０ＷＲ.
011860     COMPUTE 電療料ＷＲ(3)  = 電療料３８ＷＲ  + 電療料３０ＷＲ.
011870     MOVE 会−電療料４５           TO 電療料４５ＷＲ.
011880     MOVE 会−電療料４８           TO 電療料４８ＷＲ.
011890     MOVE 会−電療料４０           TO 電療料４０ＷＲ.
011900     COMPUTE 電療料ＷＲ(4)  = 電療料４５ＷＲ  + 電療料４８ＷＲ  + 電療料４０ＷＲ.
           COMPUTE 作１−電療金額 = 電療料ＷＲ(1) + 電療料ＷＲ(2) + 電療料ＷＲ(3) + 電療料ＷＲ(4).
           IF 受−助成種別 NOT = ZERO
              MOVE  3   TO レセ−レセ種別
           ELSE
              IF 受−公費種別 NOT = ZERO
                 MOVE  2   TO レセ−レセ種別
              ELSE
                 MOVE  1   TO レセ−レセ種別
              END-IF
           END-IF.
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           NOT INVALID KEY
              IF 後療料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作１−後療(1)
                  ELSE
                      MOVE NC"○"  TO 作１−後療(1)
                  END-IF
              END-IF
              IF 後療料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作１−後療(2)
                  ELSE
                      MOVE NC"○"  TO 作１−後療(2)
                  END-IF
              END-IF
              IF 後療料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作１−後療(3)
                  ELSE
                      MOVE NC"○"  TO 作１−後療(3)
                  END-IF
              END-IF
              IF 後療料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−後療(3)
                  ELSE
                      MOVE NC"△"  TO 作１−後療(3)
                  END-IF
              END-IF
              IF 後療料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作１−後療(4)
                  ELSE
                      MOVE NC"○"  TO 作１−後療(4)
                  END-IF
              END-IF
              IF 後療料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作１−後療(4)
                  ELSE
                      MOVE NC"△"  TO 作１−後療(4)
                  END-IF
              END-IF
              IF 後療料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−後療(4)
                  ELSE
                      MOVE NC"△"  TO 作１−後療(4)
                  END-IF
              END-IF
              IF 温罨料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作１−罨法(1)
                  ELSE
                      MOVE NC"○"  TO 作１−罨法(1)
                  END-IF
              END-IF
              IF 温罨料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作１−罨法(2)
                  ELSE
                      MOVE NC"○"  TO 作１−罨法(2)
                  END-IF
              END-IF
              IF 温罨法料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作１−罨法(3)
                  ELSE
                      MOVE NC"○"  TO 作１−罨法(3)
                  END-IF
              END-IF
              IF 温罨法料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−罨法(3)
                  ELSE
                      MOVE NC"△"  TO 作１−罨法(3)
                  END-IF
              END-IF
              IF 温罨法料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作１−罨法(4)
                  ELSE
                      MOVE NC"○"  TO 作１−罨法(4)
                  END-IF
              END-IF
              IF 温罨法料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作１−罨法(4)
                  ELSE
                      MOVE NC"△"  TO 作１−罨法(4)
                  END-IF
              END-IF
              IF 温罨法料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−罨法(4)
                  ELSE
                      MOVE NC"△"  TO 作１−罨法(4)
                  END-IF
              END-IF
              IF 電療料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作１−電療(1)
                  ELSE
                      MOVE NC"○"  TO 作１−電療(1)
                  END-IF
              END-IF
              IF 電療料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作１−電療(2)
                  ELSE
                      MOVE NC"○"  TO 作１−電療(2)
                  END-IF
              END-IF
              IF 電療料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作１−電療(3)
                  ELSE
                      MOVE NC"○"  TO 作１−電療(3)
                  END-IF
              END-IF
              IF 電療料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−電療(3)
                  ELSE
                      MOVE NC"△"  TO 作１−電療(3)
                  END-IF
              END-IF
              IF 電療料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作１−電療(4)
                  ELSE
                      MOVE NC"○"  TO 作１−電療(4)
                  END-IF
              END-IF
              IF 電療料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作１−電療(4)
                  ELSE
                      MOVE NC"△"  TO 作１−電療(4)
                  END-IF
              END-IF
              IF 電療料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作１−電療(4)
                  ELSE
                      MOVE NC"△"  TO 作１−電療(4)
                  END-IF
              END-IF
           END-READ.
011920*
011370*================================================================*
011380 項目ごと計算４ SECTION.
011390***********************************************
011400* 料金データセット                            *
011410***********************************************
013980     PERFORM VARYING カウンタ FROM 1 BY 1
013990             UNTIL ( カウンタ > 4 )
017100         MOVE 会−初回処置料(カウンタ) TO 初回処置料ＷＲ(カウンタ)
018011         IF 会−初回処置料(カウンタ) NOT = ZERO
018013            EVALUATE 負−負傷種別(カウンタ)
018014* 捻挫・打撲・挫傷
018015            WHEN 1
018016            WHEN 2
018017            WHEN 3
018018                MOVE NC"施"       TO 作４−整復(カウンタ)
018019* 脱臼・骨折・骨折拘縮
018020            WHEN 4
018021            WHEN 5
018022            WHEN 7
018023                MOVE NC"整"       TO 作４−整復(カウンタ)
018024* 不全骨折・不全骨折拘縮
018026            WHEN 6
018027            WHEN 8
018028                MOVE NC"固"       TO 作４−整復(カウンタ)
018029            END-EVALUATE
018030         END-IF
018031     END-PERFORM.
015100     MOVE 会−運動後療料         TO  運動後療料ＷＲ.
           IF 運動後療料ＷＲ NOT = ZERO
               MOVE NC"運"             TO  作４−運動
           END-IF.
011130*
011140     MOVE 会−金属副子加算料     TO  金属副子加算料ＷＲ.
           IF 金属副子加算料ＷＲ NOT = ZERO
               MOVE NC"金"             TO  作４−金属
           END-IF.
011150*
011160     MOVE 会−施術情報提供料     TO  施術情報提供料ＷＲ.
017120     COMPUTE 作４−整復金額 = 会−初回処置料合計 + 金属副子加算料ＷＲ +
                                    運動後療料ＷＲ + 施術情報提供料ＷＲ.
      *
011450     MOVE 会−後療料１     TO 後療料ＷＲ(1).
011460     MOVE 会−後療料２     TO 後療料ＷＲ(2).
011470     MOVE 会−後療料３８   TO 後療料３８ＷＲ.
011480     MOVE 会−後療料３０   TO 後療料３０ＷＲ.
011490     COMPUTE 後療料ＷＲ(3)   = 後療料３８ＷＲ   + 後療料３０ＷＲ.
011500     MOVE 会−後療料４５   TO 後療料４５ＷＲ.
011510     MOVE 会−後療料４８   TO 後療料４８ＷＲ.
011520     MOVE 会−後療料４０   TO 後療料４０ＷＲ.
011530     COMPUTE 後療料ＷＲ(4)   = 後療料４５ＷＲ   + 後療料４８ＷＲ   + 後療料４０ＷＲ.
011530     COMPUTE 作４−後療金額 = 後療料ＷＲ(1) + 後療料ＷＲ(2) + 後療料ＷＲ(3) + 後療料ＷＲ(4).
011570********************
011580* 逓減毎料金セット *
011590********************
011600     MOVE 会−冷罨法料１             TO 冷罨料ＷＲ(1).
011610     MOVE 会−冷罨法料２             TO 冷罨料ＷＲ(2).
011620     MOVE 会−冷罨法料３８           TO 冷罨法料３８ＷＲ.
011630     MOVE 会−冷罨法料３０           TO 冷罨法料３０ＷＲ.
011640     COMPUTE 冷罨料ＷＲ(3)   = 冷罨法料３８ＷＲ  + 冷罨法料３０ＷＲ.
011650     MOVE 会−冷罨法料４５           TO 冷罨法料４５ＷＲ.
011660     MOVE 会−冷罨法料４８           TO 冷罨法料４８ＷＲ.
011670     MOVE 会−冷罨法料４０           TO 冷罨法料４０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(4)   = 冷罨法料４５ＷＲ  + 冷罨法料４８ＷＲ  + 冷罨法料４０ＷＲ.
011690     COMPUTE 冷罨料計ＷＲ = 冷罨料ＷＲ(1) + 冷罨料ＷＲ(2) + 冷罨料ＷＲ(3) + 冷罨料ＷＲ(4).
           IF 冷罨料ＷＲ(1) NOT = ZERO
               MOVE NC"冷"  TO 作４−罨法(1)
           END-IF.
           IF 冷罨料ＷＲ(2) NOT = ZERO
               MOVE NC"冷"  TO 作４−罨法(2)
           END-IF.
           IF 冷罨法料３０ＷＲ NOT = ZERO
               MOVE NC"冷"  TO 作４−罨法(3)
           END-IF.
           IF 冷罨法料３８ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作４−罨法(3)
           END-IF.
           IF 冷罨法料４０ＷＲ NOT = ZERO
               MOVE NC"冷"  TO 作４−罨法(4)
           END-IF.
           IF 冷罨法料４５ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作４−罨法(4)
           END-IF.
           IF 冷罨法料４８ＷＲ NOT = ZERO
               MOVE NC"レ"  TO 作４−罨法(4)
           END-IF.
011700*
011710     MOVE 会−温罨法料１             TO 温罨料ＷＲ(1).
011720     MOVE 会−温罨法料２             TO 温罨料ＷＲ(2).
011730     MOVE 会−温罨法料３８           TO 温罨法料３８ＷＲ.
011740     MOVE 会−温罨法料３０           TO 温罨法料３０ＷＲ.
011750     COMPUTE 温罨料ＷＲ(3)   = 温罨法料３８ＷＲ  + 温罨法料３０ＷＲ.
011760     MOVE 会−温罨法料４５           TO 温罨法料４５ＷＲ.
011770     MOVE 会−温罨法料４８           TO 温罨法料４８ＷＲ.
011780     MOVE 会−温罨法料４０           TO 温罨法料４０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(4)   = 温罨法料４５ＷＲ  + 温罨法料４８ＷＲ  + 温罨法料４０ＷＲ.
011800     COMPUTE 温罨料計ＷＲ = 温罨料ＷＲ(1) + 温罨料ＷＲ(2) + 温罨料ＷＲ(3) + 温罨料ＷＲ(4).
           COMPUTE 作４−罨法金額 = 冷罨料計ＷＲ + 温罨料計ＷＲ.
011810*
011820     MOVE 会−電療料１             TO 電療料ＷＲ(1).
011830     MOVE 会−電療料２             TO 電療料ＷＲ(2).
011840     MOVE 会−電療料３８           TO 電療料３８ＷＲ.
011850     MOVE 会−電療料３０           TO 電療料３０ＷＲ.
011860     COMPUTE 電療料ＷＲ(3)  = 電療料３８ＷＲ  + 電療料３０ＷＲ.
011870     MOVE 会−電療料４５           TO 電療料４５ＷＲ.
011880     MOVE 会−電療料４８           TO 電療料４８ＷＲ.
011890     MOVE 会−電療料４０           TO 電療料４０ＷＲ.
011900     COMPUTE 電療料ＷＲ(4)  = 電療料４５ＷＲ  + 電療料４８ＷＲ  + 電療料４０ＷＲ.
           COMPUTE 作４−電療金額 = 電療料ＷＲ(1) + 電療料ＷＲ(2) + 電療料ＷＲ(3) + 電療料ＷＲ(4).
           IF 受−助成種別 NOT = ZERO
              MOVE  3   TO レセ−レセ種別
           ELSE
              IF 受−公費種別 NOT = ZERO
                 MOVE  2   TO レセ−レセ種別
              ELSE
                 MOVE  1   TO レセ−レセ種別
              END-IF
           END-IF.
005200     MOVE 受−施術和暦  TO レセ−施術和暦.
005210     MOVE 受−施術年    TO レセ−施術年.  
005220     MOVE 受−施術月    TO レセ−施術月.  
005230     MOVE 受−患者番号  TO レセ−患者番号.
005240     MOVE 受−枝番      TO レセ−枝番.    
           READ レセプトＦ
           NOT INVALID KEY
              IF 後療料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作４−後療(1)
                  ELSE
                      MOVE NC"○"  TO 作４−後療(1)
                  END-IF
              END-IF
              IF 後療料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作４−後療(2)
                  ELSE
                      MOVE NC"○"  TO 作４−後療(2)
                  END-IF
              END-IF
              IF 後療料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作４−後療(3)
                  ELSE
                      MOVE NC"○"  TO 作４−後療(3)
                  END-IF
              END-IF
              IF 後療料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−後療(3)
                  ELSE
                      MOVE NC"△"  TO 作４−後療(3)
                  END-IF
              END-IF
              IF 後療料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作４−後療(4)
                  ELSE
                      MOVE NC"○"  TO 作４−後療(4)
                  END-IF
              END-IF
              IF 後療料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作４−後療(4)
                  ELSE
                      MOVE NC"△"  TO 作４−後療(4)
                  END-IF
              END-IF
              IF 後療料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−後療(4)
                  ELSE
                      MOVE NC"△"  TO 作４−後療(4)
                  END-IF
              END-IF
              IF 温罨料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作４−罨法(1)
                  ELSE
                      MOVE NC"○"  TO 作４−罨法(1)
                  END-IF
              END-IF
              IF 温罨料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作４−罨法(2)
                  ELSE
                      MOVE NC"○"  TO 作４−罨法(2)
                  END-IF
              END-IF
              IF 温罨法料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作４−罨法(3)
                  ELSE
                      MOVE NC"○"  TO 作４−罨法(3)
                  END-IF
              END-IF
              IF 温罨法料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−罨法(3)
                  ELSE
                      MOVE NC"△"  TO 作４−罨法(3)
                  END-IF
              END-IF
              IF 温罨法料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作４−罨法(4)
                  ELSE
                      MOVE NC"○"  TO 作４−罨法(4)
                  END-IF
              END-IF
              IF 温罨法料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作４−罨法(4)
                  ELSE
                      MOVE NC"△"  TO 作４−罨法(4)
                  END-IF
              END-IF
              IF 温罨法料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−罨法(4)
                  ELSE
                      MOVE NC"△"  TO 作４−罨法(4)
                  END-IF
              END-IF
              IF 電療料ＷＲ(1) NOT = ZERO
                  IF レセ−長期逓減率１ NOT = ZERO
                      MOVE NC"□"  TO 作４−電療(1)
                  ELSE
                      MOVE NC"○"  TO 作４−電療(1)
                  END-IF
              END-IF
              IF 電療料ＷＲ(2) NOT = ZERO
                  IF レセ−長期逓減率２ NOT = ZERO
                      MOVE NC"□"  TO 作４−電療(2)
                  ELSE
                      MOVE NC"○"  TO 作４−電療(2)
                  END-IF
              END-IF
              IF 電療料３０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３０ NOT = ZERO
                      MOVE NC"□"  TO 作４−電療(3)
                  ELSE
                      MOVE NC"○"  TO 作４−電療(3)
                  END-IF
              END-IF
              IF 電療料３８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率３８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−電療(3)
                  ELSE
                      MOVE NC"△"  TO 作４−電療(3)
                  END-IF
              END-IF
              IF 電療料４０ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４０ NOT = ZERO
                      MOVE NC"□"  TO 作４−電療(4)
                  ELSE
                      MOVE NC"○"  TO 作４−電療(4)
                  END-IF
              END-IF
              IF 電療料４５ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４５ NOT = ZERO
                      MOVE NC"＊"  TO 作４−電療(4)
                  ELSE
                      MOVE NC"△"  TO 作４−電療(4)
                  END-IF
              END-IF
              IF 電療料４８ＷＲ NOT = ZERO
                  IF レセ−長期逓減率４８ NOT = ZERO
                      MOVE NC"＊"  TO 作４−電療(4)
                  ELSE
                      MOVE NC"△"  TO 作４−電療(4)
                  END-IF
              END-IF
           END-READ.
011920*
011370*================================================================*
011380 集計 SECTION.
011390***********************************************
011400* 料金データセット                            *
011410***********************************************
010990     MOVE 会−初検料             TO  初検料ＷＲ.
011000*
011010     MOVE 会−初検加算料         TO  初検加算料ＷＲ.
           MOVE 会−初検時相談料       TO  初検時相談料ＷＲ.
011050     MOVE 会−再検料             TO  再検料ＷＲ.
011080     MOVE 会−往療料             TO  往療料ＷＲ.
011090     MOVE 会−往療加算料         TO  往療加算料ＷＲ.
015100     MOVE 会−運動後療料         TO  運動後療料ＷＲ.
011140     MOVE 会−金属副子加算料     TO  金属副子加算料ＷＲ.
011160     MOVE 会−施術情報提供料     TO  施術情報提供料ＷＲ.
           COMPUTE 初検計Ｗ = 初検計Ｗ + 初検料ＷＲ + 初検加算料ＷＲ + 再検料ＷＲ + 往療料ＷＲ +
                              往療加算料ＷＲ + 初検時相談料ＷＲ.
      *
017120     COMPUTE 整復計Ｗ = 整復計Ｗ + 会−初回処置料合計 + 金属副子加算料ＷＲ +
                                         運動後療料ＷＲ + 施術情報提供料ＷＲ.
      *
011450     MOVE 会−後療料１     TO 後療料ＷＲ(1).
011460     MOVE 会−後療料２     TO 後療料ＷＲ(2).
011470     MOVE 会−後療料３８   TO 後療料３８ＷＲ.
011480     MOVE 会−後療料３０   TO 後療料３０ＷＲ.
011490     COMPUTE 後療料ＷＲ(3)   = 後療料３８ＷＲ   + 後療料３０ＷＲ.
011500     MOVE 会−後療料４５   TO 後療料４５ＷＲ.
011510     MOVE 会−後療料４８   TO 後療料４８ＷＲ.
011520     MOVE 会−後療料４０   TO 後療料４０ＷＲ.
011530     COMPUTE 後療料ＷＲ(4)   = 後療料４５ＷＲ   + 後療料４８ＷＲ   + 後療料４０ＷＲ.
011530     COMPUTE 後療計Ｗ = 後療計Ｗ + 後療料ＷＲ(1) + 後療料ＷＲ(2) + 後療料ＷＲ(3) + 後療料ＷＲ(4).
011570********************
011580* 逓減毎料金セット *
011590********************
011600     MOVE 会−冷罨法料１             TO 冷罨料ＷＲ(1).
011610     MOVE 会−冷罨法料２             TO 冷罨料ＷＲ(2).
011620     MOVE 会−冷罨法料３８           TO 冷罨法料３８ＷＲ.
011630     MOVE 会−冷罨法料３０           TO 冷罨法料３０ＷＲ.
011640     COMPUTE 冷罨料ＷＲ(3)   = 冷罨法料３８ＷＲ  + 冷罨法料３０ＷＲ.
011650     MOVE 会−冷罨法料４５           TO 冷罨法料４５ＷＲ.
011660     MOVE 会−冷罨法料４８           TO 冷罨法料４８ＷＲ.
011670     MOVE 会−冷罨法料４０           TO 冷罨法料４０ＷＲ.
011680     COMPUTE 冷罨料ＷＲ(4)   = 冷罨法料４５ＷＲ  + 冷罨法料４８ＷＲ  + 冷罨法料４０ＷＲ.
011690     COMPUTE 冷罨料計ＷＲ = 冷罨料ＷＲ(1) + 冷罨料ＷＲ(2) + 冷罨料ＷＲ(3) + 冷罨料ＷＲ(4).
011700*
011710     MOVE 会−温罨法料１             TO 温罨料ＷＲ(1).
011720     MOVE 会−温罨法料２             TO 温罨料ＷＲ(2).
011730     MOVE 会−温罨法料３８           TO 温罨法料３８ＷＲ.
011740     MOVE 会−温罨法料３０           TO 温罨法料３０ＷＲ.
011750     COMPUTE 温罨料ＷＲ(3)   = 温罨法料３８ＷＲ  + 温罨法料３０ＷＲ.
011760     MOVE 会−温罨法料４５           TO 温罨法料４５ＷＲ.
011770     MOVE 会−温罨法料４８           TO 温罨法料４８ＷＲ.
011780     MOVE 会−温罨法料４０           TO 温罨法料４０ＷＲ.
011790     COMPUTE 温罨料ＷＲ(4)   = 温罨法料４５ＷＲ  + 温罨法料４８ＷＲ  + 温罨法料４０ＷＲ.
011800     COMPUTE 温罨料計ＷＲ = 温罨料ＷＲ(1) + 温罨料ＷＲ(2) + 温罨料ＷＲ(3) + 温罨料ＷＲ(4).
           COMPUTE 罨法計Ｗ = 罨法計Ｗ + 冷罨料計ＷＲ + 温罨料計ＷＲ.
011810*
011820     MOVE 会−電療料１             TO 電療料ＷＲ(1).
011830     MOVE 会−電療料２             TO 電療料ＷＲ(2).
011840     MOVE 会−電療料３８           TO 電療料３８ＷＲ.
011850     MOVE 会−電療料３０           TO 電療料３０ＷＲ.
011860     COMPUTE 電療料ＷＲ(3)  = 電療料３８ＷＲ  + 電療料３０ＷＲ.
011870     MOVE 会−電療料４５           TO 電療料４５ＷＲ.
011880     MOVE 会−電療料４８           TO 電療料４８ＷＲ.
011890     MOVE 会−電療料４０           TO 電療料４０ＷＲ.
011900     COMPUTE 電療料ＷＲ(4)  = 電療料４５ＷＲ  + 電療料４８ＷＲ  + 電療料４０ＷＲ.
           COMPUTE 電療計Ｗ = 電療計Ｗ + 電療料ＷＲ(1) + 電療料ＷＲ(2) + 電療料ＷＲ(3) + 電療料ＷＲ(4).
011920*
           COMPUTE 費用計Ｗ = 費用計Ｗ + 会−費用額.
           COMPUTE 明細計Ｗ = 明細計Ｗ + 会−明細書発行加算料.
           COMPUTE 一部負担金計Ｗ = 一部負担金計Ｗ + 会−一部負担金.
      *
004140*================================================================*
004150 作１レコード書込 SECTION.
004160*
004170     WRITE 作１−レコード
004180     INVALID KEY
004190         MOVE NC"作１"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
004140*================================================================*
004150 作２レコード書込 SECTION.
004160*
004170     WRITE 作２−レコード
004180     INVALID KEY
004190         MOVE NC"作２"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
004140*================================================================*
004150 作３レコード書込 SECTION.
004160*
004170     WRITE 作３−レコード
004180     INVALID KEY
004190         MOVE NC"作３"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
004140*================================================================*
004150 作４レコード書込 SECTION.
004160*
004170     WRITE 作４−レコード
004180     INVALID KEY
004190         MOVE NC"作４"  TO ファイル名
004200         PERFORM エラー表示
004210     END-WRITE.
      *================================================================*
       データチェック SECTION.
      *
           MOVE SPACE          TO 実行キーＷ.
      * *****************************************************************
      * * 負傷部位有無チェック：部位数 = 0 の場合データ作成対象としない *
      * *****************************************************************
           MOVE 受−施術和暦   TO 負−施術和暦.
           MOVE 受−施術年     TO 負−施術年.
           MOVE 受−施術月     TO 負−施術月.
           MOVE 受−患者番号   TO 負−患者番号.
           MOVE 受−枝番       TO 負−枝番.
           READ 負傷データＦ
           INVALID KEY
               MOVE SPACE  TO 実行キーＷ
           NOT INVALID KEY
               IF 負−部位数 NOT = ZERO
      *        *************************************************************
      *        * 施術記録チェック：通院数 = 0 の場合データ作成対象としない *
      *        *************************************************************
                   MOVE 負−患者番号  TO 施記−患者番号
                   MOVE 負−枝番      TO 施記−枝番
                   MOVE 負−施術和暦  TO 施記−施術和暦
                   MOVE 負−施術年    TO 施記−施術年
                   MOVE 負−施術月    TO 施記−施術月
                   MOVE ZERO          TO 施記−施術日
                   START 施術記録Ｆ   KEY IS >= 施記−患者コード
                                                施記−施術和暦年月日
                   END-START
                   IF 状態キー = "00"
                       MOVE SPACE TO 終了フラグ２
                       MOVE SPACE TO 施術記録有Ｗ
                       PERFORM 施術記録Ｆ読込
                       PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
                                     (施記−患者コード NOT = 負−患者コード) OR
                                     (施記−施術和暦   NOT = 負−施術和暦  ) OR
                                     (施記−施術年     NOT = 負−施術年    ) OR
                                     (施記−施術月     NOT = 負−施術月    ) OR
                                     (施術記録有Ｗ         = "YES"         )
                           MOVE "YES"  TO 施術記録有Ｗ
                           MOVE "YES"  TO 実行キーＷ
                       END-PERFORM
                   ELSE
                       MOVE SPACE  TO 実行キーＷ
                   END-IF
               ELSE
                   MOVE SPACE  TO 実行キーＷ
               END-IF
           END-READ.
      *
      *================================================================*
       施術記録Ｆ読込 SECTION.
      *
           READ 施術記録Ｆ NEXT
           AT END
               MOVE "YES"  TO 終了フラグ２
           END-READ.
002820*================================================================*
       印刷条件判定 SECTION.
      *
           MOVE SPACE TO 対象フラグ
      */労災自賠責のデータは対象外
           IF 受−保険種別 NOT = 70 AND 80
               EVALUATE 印刷条件ＷＲ
               WHEN 01
                   PERFORM 初検判定
               WHEN 02
                   PERFORM 後療のみ判定
               WHEN 03
                   PERFORM 終了判定
               WHEN 04
                   PERFORM 初検判定
                   IF 対象フラグ = "YES"
                       PERFORM 終了判定
                   END-IF
               WHEN OTHER
                   CONTINUE
               END-EVALUATE
           END-IF.
040770*================================================================*
       初検判定 SECTION.
      *
014120     MOVE 受−患者番号  TO 施記−患者番号
014130     MOVE 受−枝番      TO 施記−枝番
014140     MOVE 受−施術和暦  TO 施記−施術和暦
014150     MOVE 受−施術年    TO 施記−施術年
014160     MOVE 受−施術月    TO 施記−施術月
014170     MOVE ZERO          TO 施記−施術日
014180     START 施術記録Ｆ   KEY IS >= 施記−患者コード
014190                                  施記−施術和暦年月日
014200     END-START
014210     IF 状態キー = "00"
014120         MOVE SPACE TO 終了フラグ２
014140         PERFORM 施術記録Ｆ読込
014150         PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
014160                       (施記−患者コード NOT = 受−患者コード) OR
014170                       (施記−施術和暦   NOT = 受−施術和暦  ) OR
014180                       (施記−施術年     NOT = 受−施術年    ) OR
014190                       (施記−施術月     NOT = 受−施術月    )
      *
                   IF 施記−診療区分 = 2
                       MOVE "YES" TO 対象フラグ
                       MOVE "YES" TO 終了フラグ２
                   END-IF
040620             PERFORM 施術記録Ｆ読込
               END-PERFORM
           END-IF.
040770*================================================================*
       後療のみ判定 SECTION.
      *
014120     MOVE 受−患者番号  TO 施記−患者番号
014130     MOVE 受−枝番      TO 施記−枝番
014140     MOVE 受−施術和暦  TO 施記−施術和暦
014150     MOVE 受−施術年    TO 施記−施術年
014160     MOVE 受−施術月    TO 施記−施術月
014170     MOVE ZERO          TO 施記−施術日
014180     START 施術記録Ｆ   KEY IS >= 施記−患者コード
014190                                  施記−施術和暦年月日
014200     END-START
014210     IF 状態キー = "00"
014120         MOVE SPACE TO 終了フラグ２
014140         PERFORM 施術記録Ｆ読込
014150         PERFORM UNTIL (終了フラグ２         = "YES"         ) OR
014160                       (施記−患者コード NOT = 受−患者コード) OR
014170                       (施記−施術和暦   NOT = 受−施術和暦  ) OR
014180                       (施記−施術年     NOT = 受−施術年    ) OR
014190                       (施記−施術月     NOT = 受−施術月    )
      *
                   IF 施記−診療区分 = 1
                       MOVE "YES" TO 対象フラグ
                   ELSE
                       MOVE SPACE TO 対象フラグ
                       MOVE "YES" TO 終了フラグ２
                   END-IF
040620             PERFORM 施術記録Ｆ読込
               END-PERFORM
           END-IF.
040770*================================================================*
       終了判定 SECTION.
      *
           MOVE "YES" TO 対象フラグ.
      *
014190     MOVE 受−施術和暦   TO 負−施術和暦.
014200     MOVE 受−施術年     TO 負−施術年.
014210     MOVE 受−施術月     TO 負−施術月.
014120     MOVE 受−患者番号   TO 負−患者番号.
014130     MOVE 受−枝番       TO 負−枝番.
014140     READ 負傷データＦ
014150     INVALID KEY
014160         MOVE SPACE  TO 対象フラグ
014170     NOT INVALID KEY
               IF 負−部位数 = ZERO
                   MOVE SPACE TO 対象フラグ
               ELSE
020600             PERFORM VARYING 部位ＣＮＴ FROM 1 BY 1
020610                      UNTIL (部位ＣＮＴ > 負−部位数)
                       IF 負−転帰区分(部位ＣＮＴ) = 9 OR 5
                           MOVE SPACE TO 対象フラグ
                       END-IF
                   END-PERFORM
               END-IF
           END-READ.
027377*================================================================*
027378 月末日取得 SECTION.
027379*
027382     MOVE 施術和暦ＷＲ TO 元−元号区分.
027383     READ 元号マスタ
027384     NOT INVALID KEY
027385         MOVE 元−開始西暦年 TO 施術西暦年Ｗ
027386     END-READ.
027387     IF 施術西暦年Ｗ NOT = ZERO
027388        COMPUTE 施術西暦年Ｗ = 施術西暦年Ｗ + 施術年ＷＲ - 1
027389     END-IF.
027390*
           MOVE 施術月ＷＲ   TO 受理月Ｗ.
027391     EVALUATE 施術月ＷＲ
027392     WHEN 4
027393     WHEN 6
027394     WHEN 9
027395     WHEN 11
027396         MOVE 30 TO 受理日Ｗ
027397     WHEN 2
027398         DIVIDE 4 INTO 施術西暦年Ｗ GIVING    商Ｗ
027399                                    REMAINDER 余Ｗ
027400         END-DIVIDE
027401         IF 余Ｗ = ZERO
027402             MOVE 29 TO 受理日Ｗ
027403         ELSE
027404             MOVE 28 TO 受理日Ｗ
027405         END-IF
027406     WHEN 1
027407     WHEN 3
027408     WHEN 5
027409     WHEN 7
027410     WHEN 8
027411     WHEN 10
027412     WHEN 12
027413         MOVE 31 TO 受理日Ｗ
027414     WHEN OTHER
027415          CONTINUE
027416     END-EVALUATE.
027417*
004230******************************************************************
004240 END PROGRAM YJB721.
004250******************************************************************
