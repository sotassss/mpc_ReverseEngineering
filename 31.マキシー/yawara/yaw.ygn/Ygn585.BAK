000010******************************************************************
000020*            IDENTIFICATION      DIVISION                        *
000030******************************************************************
000040 IDENTIFICATION          DIVISION.
000050 PROGRAM-ID.             YGN585.
000060 AUTHOR.                 池田  幸子
000070*
000080*----------------------------------------------------------------*
000090*   【柔+ｳｨﾝﾄﾞｳｽﾞ版　群馬用 療養費請求書】
000100*   【データ作成】
000110*         MED = YGN580 YGN586P 
000120*----------------------------------------------------------------*
000130 DATE-WRITTEN.           2016-05-24
000140 DATE-COMPILED.          2016-05-24
000150*----------------------------------------------------------------*
000160******************************************************************
000170*            ENVIRONMENT         DIVISION                        *
000180******************************************************************
000190 ENVIRONMENT             DIVISION.
000200 CONFIGURATION           SECTION.
000210 SOURCE-COMPUTER.        FMV-DESKPOWER-TS.
000220 OBJECT-COMPUTER.        FMV-DESKPOWER.
000230 SPECIAL-NAMES.          CONSOLE  IS  CONS
000240                         SYSERR   IS  MSGBOX.
000250 INPUT-OUTPUT            SECTION.
000260 FILE-CONTROL.
000270     SELECT  受診者情報Ｆ    ASSIGN      TO        JUSINJL
000280                             ORGANIZATION             IS  INDEXED
000290                             ACCESS MODE              IS  DYNAMIC
000300                             RECORD KEY               IS  受−施術和暦年月
000310                                                          受−患者コード
000320                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000330                                                          受−患者カナ
000340                                                          受−患者コード
000350                             ALTERNATE RECORD KEY     IS  受−患者コード
000360                                                          受−施術和暦年月
000370                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000380                                                          受−保険種別
000390                                                          受−保険者番号
000400                                                          受−患者コード
000410                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000420                                                          受−公費種別
000430                                                          受−費用負担者番号
000440                                                          受−患者コード
000450                             ALTERNATE RECORD KEY     IS  受−施術和暦年月
000460                                                          受−助成種別
000470                                                          受−費用負担者番号助成
000480                                                          受−患者コード
000490                             ALTERNATE RECORD KEY     IS  受−請求和暦年月
000500                                                          受−施術和暦年月
000510                                                          受−患者コード
000520                             FILE STATUS              IS  状態キー
000530                             LOCK        MODE         IS  AUTOMATIC.
000130     SELECT  レセプトＦ      ASSIGN      TO        RECEPTL
000140                             ORGANIZATION             IS  INDEXED
000150                             ACCESS MODE              IS  DYNAMIC
000160                             RECORD KEY               IS  レセ−施術和暦年月
000170                                                          レセ−患者コード
000180                                                          レセ−レセ種別
000190                             ALTERNATE RECORD KEY     IS  レセ−患者コード
000200                                                          レセ−施術和暦年月
000210                                                          レセ−レセ種別
000220                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000230                                                          レセ−施術和暦年月
000240                                                          レセ−患者コード
000250                                                          レセ−レセ種別
000260                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000270                                                          レセ−レセ種別
000280                                                          レセ−請求保険者番号
000290                                                          レセ−患者コード
000300                                                          レセ−施術和暦年月
000310                             ALTERNATE RECORD KEY     IS  レセ−請求和暦年月
000320                                                          レセ−請求保険者番号
000330                                                          レセ−患者コード
000340                                                          レセ−レセ種別
000350                                                          レセ−施術和暦年月
000360                             FILE STATUS              IS  状態キー
000370                             LOCK        MODE         IS  AUTOMATIC.
001410     SELECT  負傷データＦ    ASSIGN      TO        HUSYOUL
001420                             ORGANIZATION             IS  INDEXED
001430                             ACCESS MODE              IS  DYNAMIC
001440                             RECORD KEY               IS  負−施術和暦年月
001450                                                          負−患者コード
001460                             ALTERNATE RECORD KEY     IS  負−患者コード
001470                                                          負−施術和暦年月
001480                             FILE STATUS              IS  状態キー
001490                             LOCK        MODE         IS  AUTOMATIC.
000950     SELECT  市町村マスタ    ASSIGN      TO        SITYOSNL
000960                             ORGANIZATION             IS  INDEXED
000970                             ACCESS MODE              IS  DYNAMIC
000980                             RECORD KEY               IS  市−公費種別
000990                                                          市−市町村番号
001000                             ALTERNATE RECORD KEY     IS  市−公費種別
001010                                                          市−市町村名称
001020                                                          市−市町村番号
001030                             FILE STATUS              IS  状態キー
001040                             LOCK        MODE         IS  AUTOMATIC.
001250     SELECT  作業ファイル１  ASSIGN      TO        "C:\MAKISHISYS\YAWOBJ\TEMP\W5851L.DAT"
001260                             ORGANIZATION             IS  INDEXED
001270                             ACCESS                   IS  DYNAMIC
001280                             RECORD      KEY          IS  作１−保険区分
001300                                                          作１−保険者番号
001290                                                          作１−区分
001460                             ALTERNATE RECORD KEY     IS  作１−保険者番号
001290                                                          作１−区分
001310                             FILE        STATUS       IS  状態キー
001320                             LOCK        MODE         IS  AUTOMATIC.
001330******************************************************************
001340*                      DATA DIVISION                             *
001350******************************************************************
001360 DATA                    DIVISION.
001370 FILE                    SECTION.
001380*                           ［ＲＬ＝  ７６８］
001390 FD  受診者情報Ｆ        BLOCK   CONTAINS   1   RECORDS.
001400     COPY JUSINJ         OF  XFDLIB  JOINING    受   AS  PREFIX.
      *                          ［ＲＬ＝  １５３６］
       FD  レセプトＦ          BLOCK   CONTAINS   1   RECORDS.
           COPY RECEPT          OF  XFDLIB  JOINING   レセ  AS  PREFIX.
002190*                           ［ＲＬ＝  １２８］
002200 FD  負傷データＦ        BLOCK   CONTAINS   1   RECORDS.
002210     COPY HUSYOU          OF  XFDLIB  JOINING   負   AS  PREFIX.
002100*                           ［ＲＬ＝  ２５６］
002110 FD  市町村マスタ          BLOCK   CONTAINS   1   RECORDS.
002120     COPY SITYOSN        OF  XFDLIB  JOINING   市   AS  PREFIX.
001650*
001660 FD  作業ファイル１ RECORD  CONTAINS 64 CHARACTERS.
001670 01  作１−レコード.
001680   03  作１−レコードキー.
001760     05  作１−保険区分                PIC 9(1).
001690     05  作１−保険者番号.
001700       07 作１−法別番号               PIC X(2).
001710       07 作１−保番.
001720         09 作１−都道府県番号         PIC X(2).
001730         09 作１−保番号               PIC X(3).
001740         09 作１−検証番号             PIC X.
001750         09 FILLER                     PIC X(2).
001770     05  作１−区分                    PIC 9.
001780   03  作１−レコードデータ.
001760     05  作１−保険種別                PIC 9(2).
001790     05  作１−件数                    PIC 9(4).
001800     05  作１−日数                    PIC 9(4).
001810     05  作１−費用額                  PIC 9(7).
001810     05  作１−負担額                  PIC 9(7).
001810     05  作１−請求額                  PIC 9(7).
001820     05  FILLER                        PIC X(21).
001830*
001840******************************************************************
001850*                WORKING-STORAGE SECTION                         *
001860******************************************************************
001870 WORKING-STORAGE         SECTION.
001880 01 キー入力                           PIC X(1) VALUE SPACE.
001890 01 状態キー                           PIC X(2) VALUE SPACE.
001900 01 終了フラグ１                       PIC X(3) VALUE SPACE.
001910 01 終了フラグ３                       PIC X(3) VALUE SPACE.
001920 01 確認入力Ｗ                         PIC X(1) VALUE SPACE.
001930 01 ファイル名Ｗ                       PIC N(2) VALUE SPACE.
001940 01 ファイル名                         PIC N(2) VALUE SPACE.
001960 01 実行キーＷ                         PIC X(4) VALUE SPACE.
002280 01 カウンタ                           PIC 9(2)  VALUE ZERO.
002000*
002130**************
002140* 保険者情報 *
002150**************
002640*
002690 01 請求和暦年月ＷＲ.
002700    03 請求和暦ＷＲ                  PIC 9     VALUE ZERO.
002710    03 請求年ＷＲ                    PIC 9(2)  VALUE ZERO.
002720    03 請求月ＷＲ                    PIC 9(2)  VALUE ZERO.
002730*
002740 01 保険種別Ｗ                       PIC 9(2) VALUE ZERO.
002750 01 本人家族区分Ｗ                   PIC 9(1) VALUE ZERO.
002760 01 法別番号Ｗ                       PIC X(2) VALUE SPACE.
002770 01 給付割合Ｗ                       PIC 9(2) VALUE ZERO.
002780*
002790 01 本人負担率Ｗ                     PIC 9(3) VALUE ZERO.
002800 01 家族負担率Ｗ                     PIC 9(3) VALUE ZERO.
002810 01 甲乙区分Ｗ                       PIC 9(1) VALUE ZERO.
003080*
003090 01 実日数Ｗ                         PIC 9(4) VALUE ZERO.
002820*
002830 01 対象件数Ｗ                       PIC 9(4) VALUE ZERO.
002910*
002920 01 終了フラグ２                     PIC X(3) VALUE SPACE.
002930*
002940 01 状態フラグ                       PIC 9(1) VALUE ZERO.
003150*
003160******************************************************************
003170*                          連結項目                              *
003180******************************************************************
003190*
003200****************
003210* 画面入力情報 *
003220****************
       01 連入−入力データＹＧＮ５８０ IS EXTERNAL.
          03 連入−施術和暦年月.
             05 連入−施術和暦               PIC 9(1).
             05 連入−施術年月.
                07 連入−施術年              PIC 9(2).
                07 連入−施術月              PIC 9(2).
003300*
003690******************************************************************
003700*                      PROCEDURE  DIVISION                       *
003710******************************************************************
003720 PROCEDURE               DIVISION.
003730************
003740*           *
003750* 初期処理   *
003760*           *
003770************
003780     PERFORM 初期化.
003790************
003800*           *
003810* 主処理     *
003820*           *
003830************
003840     PERFORM 作業ファイル作成.
003850************
003860*           *
003870* 終了処理   *
003880*           *
003890************
003900     PERFORM 終了処理.
003910     MOVE ZERO TO PROGRAM-STATUS.
003920     EXIT PROGRAM.
003930*
003940*<<<<<<<<<<<<<<<<<<<<<<<<< END OF PROGRAM >>>>>>>>>>>>>>>>>>>>>>>>
003950*================================================================*
003960 初期化 SECTION.
003970*
003980     OPEN INPUT 受診者情報Ｆ.
003990             MOVE NC"受診" TO ファイル名Ｗ.
004000             PERFORM オープンチェック.
007560     OPEN INPUT   レセプトＦ
007570         MOVE NC"レセ" TO ファイル名Ｗ.
007580         PERFORM オープンチェック.
014950     OPEN INPUT   負傷データＦ.
014960         MOVE NC"負傷" TO ファイル名.
014970         PERFORM オープンチェック.
014890     OPEN INPUT 市町村マスタ.
014900         MOVE NC"市町村" TO ファイル名Ｗ.
014910         PERFORM オープンチェック.
004220*
004370* 連結項目の待避
004380     MOVE 連入−施術和暦 TO 請求和暦ＷＲ.
004390     MOVE 連入−施術年   TO 請求年ＷＲ.
004400     MOVE 連入−施術月   TO 請求月ＷＲ.
004410*================================================================*
004420 オープンチェック SECTION.
004430*
004440     IF 状態キー  NOT =  "00"
004450         DISPLAY ファイル名Ｗ NC"Ｆオープンエラー" UPON CONS
004460         DISPLAY NC"状態キー：" 状態キー           UPON CONS
004470         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
004480                                                   UPON CONS
003131*-----------------------------------------*
003132         CALL "actcshm"  WITH C LINKAGE
003133*-----------------------------------------*
004490         ACCEPT  キー入力 FROM CONS
004500         PERFORM ファイル閉鎖
004510         EXIT PROGRAM.
005040*================================================================*
005050 ファイル閉鎖 SECTION.
005060*
005070     CLOSE  受診者情報Ｆ レセプトＦ 負傷データＦ 市町村マスタ.
005090*================================================================*
005100 終了処理 SECTION.
005110*
005120     PERFORM ファイル閉鎖.
005130*================================================================*
005140* データ作成 SECTION.
005150 作業ファイル作成 SECTION.
005160*
005190     OPEN OUTPUT 作業ファイル１.
005200         MOVE NC"作１" TO ファイル名.
005210         PERFORM オープンチェック.
005220     CLOSE 作業ファイル１.
005230     OPEN I-O 作業ファイル１.
005240         MOVE NC"作１" TO ファイル名.
005250         PERFORM オープンチェック.
005290*  /*国保
007470     MOVE 請求和暦ＷＲ  TO レセ−請求和暦.
007480     MOVE 請求年ＷＲ    TO レセ−請求年.
007490     MOVE 請求月ＷＲ    TO レセ−請求月.
013730     MOVE 1             TO レセ−レセ種別.
007500     MOVE ZERO          TO レセ−請求保険者番号.
007500     MOVE ZERO          TO レセ−施術和暦.
007510     MOVE ZERO          TO レセ−施術年.
007520     MOVE ZERO          TO レセ−施術月.
007530     MOVE ZERO          TO レセ−患者番号.
007540     MOVE SPACE         TO レセ−枝番.
007550     START レセプトＦ   KEY IS >= レセ−請求和暦年月
000250                                  レセ−レセ種別
007560                                  レセ−請求保険者番号
007570                                  レセ−患者コード
                                        レセ−施術和暦年月
007580     END-START.
007590     IF 状態キー = "00"
007600         MOVE SPACE  TO 終了フラグ２
007610         PERFORM レセプトＦ読込
007620         PERFORM UNTIL ( 終了フラグ２ = "YES" ) OR
007630                       ( レセ−請求和暦 NOT = 請求和暦ＷＲ ) OR
007640                       ( レセ−請求年   NOT = 請求年ＷＲ   ) OR
007650                       ( レセ−請求月   NOT = 請求月ＷＲ   ) OR
                             ( レセ−レセ種別 NOT = 1 )
007660*
005430             PERFORM データチェック
012327**
012328             IF  実行キーＷ = "YES"
005550*
000591                 IF ((( 受−保険種別 = 1 ) AND ( 受−法別番号 = 10 )) OR
                          (( 受−保険種別 = 8 ) AND ( 受−都道府県番号 = 10 )))
005630                     PERFORM 作業ファイル作成１
005650                 END-IF
005680             END-IF
005660             PERFORM レセプトＦ読込
005670         END-PERFORM
005690     END-IF.
005290*  /*後高
007470     MOVE 請求和暦ＷＲ  TO レセ−請求和暦.
007480     MOVE 請求年ＷＲ    TO レセ−請求年.
007490     MOVE 請求月ＷＲ    TO レセ−請求月.
013730     MOVE 2             TO レセ−レセ種別.
007500     MOVE ZERO          TO レセ−請求保険者番号.
007500     MOVE ZERO          TO レセ−施術和暦.
007510     MOVE ZERO          TO レセ−施術年.
007520     MOVE ZERO          TO レセ−施術月.
007530     MOVE ZERO          TO レセ−患者番号.
007540     MOVE SPACE         TO レセ−枝番.
007550     START レセプトＦ   KEY IS >= レセ−請求和暦年月
000250                                  レセ−レセ種別
007560                                  レセ−請求保険者番号
007570                                  レセ−患者コード
                                        レセ−施術和暦年月
007580     END-START.
007590     IF 状態キー = "00"
007600         MOVE SPACE  TO 終了フラグ２
007610         PERFORM レセプトＦ読込
007620         PERFORM UNTIL ( 終了フラグ２ = "YES" ) OR
007630                       ( レセ−請求和暦 NOT = 請求和暦ＷＲ ) OR
007640                       ( レセ−請求年   NOT = 請求年ＷＲ   ) OR
007650                       ( レセ−請求月   NOT = 請求月ＷＲ   ) OR
                             ( レセ−レセ種別 NOT = 2 )
007660*
005430             PERFORM データチェック
012327**
012328             IF  実行キーＷ = "YES"
005550*
000591                 IF ( 受−府県老人 = 10 )
005630                     PERFORM 作業ファイル作成１
005650                 END-IF
005680             END-IF
005660             PERFORM レセプトＦ読込
005670         END-PERFORM
005690     END-IF.
005290*  /*福祉
007470     MOVE 請求和暦ＷＲ  TO レセ−請求和暦.
007480     MOVE 請求年ＷＲ    TO レセ−請求年.
007490     MOVE 請求月ＷＲ    TO レセ−請求月.
013730     MOVE 3             TO レセ−レセ種別.
007500     MOVE ZERO          TO レセ−請求保険者番号.
007500     MOVE ZERO          TO レセ−施術和暦.
007510     MOVE ZERO          TO レセ−施術年.
007520     MOVE ZERO          TO レセ−施術月.
007530     MOVE ZERO          TO レセ−患者番号.
007540     MOVE SPACE         TO レセ−枝番.
007550     START レセプトＦ   KEY IS >= レセ−請求和暦年月
000250                                  レセ−レセ種別
007560                                  レセ−請求保険者番号
007570                                  レセ−患者コード
                                        レセ−施術和暦年月
007580     END-START.
007590     IF 状態キー = "00"
007600         MOVE SPACE  TO 終了フラグ２
007610         PERFORM レセプトＦ読込
007620         PERFORM UNTIL ( 終了フラグ２ = "YES" ) OR
007630                       ( レセ−請求和暦 NOT = 請求和暦ＷＲ ) OR
007640                       ( レセ−請求年   NOT = 請求年ＷＲ   ) OR
007650                       ( レセ−請求月   NOT = 請求月ＷＲ   ) OR
                             ( レセ−レセ種別 NOT = 3 )
007660*
005430             PERFORM データチェック
012327**
012328             IF  実行キーＷ = "YES"
005550*
000591                 IF ( 受−費用負担者番号助成(5:3) = "001" OR "004" OR "099" OR "085" OR "110")
005630                     PERFORM 作業ファイル作成２
005650                 END-IF
005680             END-IF
005660             PERFORM レセプトＦ読込
005670         END-PERFORM
005690     END-IF.
006110     CLOSE 作業ファイル１.
008010*================================================================*
008020 レセプトＦ読込 SECTION.
008030*
008040     READ レセプトＦ NEXT
008050     AT END
008060         MOVE "YES" TO 終了フラグ２
008070     END-READ.
007060*================================================================*
007070 エラー表示 SECTION.
007080*
007090     DISPLAY NC"ファイル書込エラー：" ファイル名Ｗ UPON CONS.
007100     DISPLAY NC"システム管理者に連絡してください"  UPON CONS.
007110     DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください" UPON CONS.
004380*-----------------------------------------*
004390     CALL "actcshm"  WITH C LINKAGE.
004400*-----------------------------------------*
007120     ACCEPT  キー入力 FROM CONS.
007290*================================================================*
007300 データチェック SECTION.
007310*
007320     MOVE SPACE          TO 実行キーＷ.
007330* *****************************************************************
019530* * レセプトＦの請求対象区分 = 0 の場合データ作成対象としない *
008610* *****************************************************************
019640     IF ( レセ−請求対象区分 NOT = ZERO ) AND
005778        ( レセ−償還払い区分 NOT = 1 )
              IF (レセ−レセ種別 = 3) AND ( レセ−会総括表印刷対象区分 = 2 OR 3 )
                  CONTINUE
              ELSE
004090           MOVE レセ−施術和暦  TO 受−施術和暦
004100           MOVE レセ−施術年    TO 受−施術年
004110           MOVE レセ−施術月    TO 受−施術月
004120           MOVE レセ−患者番号  TO 受−患者番号
004130           MOVE レセ−枝番      TO 受−枝番
                 READ 受診者情報Ｆ
                 NOT INVALID KEY
                    IF (レセ−レセ種別 = 3) OR ( 受−保険種別 = 1 OR 8 OR 5)
019880                 MOVE "YES"  TO 実行キーＷ
                    END-IF
019950           END-READ
      *
027790           MOVE レセ−施術和暦       TO 負−施術和暦
027800           MOVE レセ−施術年         TO 負−施術年
027810           MOVE レセ−施術月         TO 負−施術月
027820           MOVE レセ−患者コード     TO 負−患者コード
027830           READ 負傷データＦ
019630           INVALID KEY
                    MOVE SPACE     TO 負−レコード
                    INITIALIZE        負−レコード
                 END-READ
              END-IF
019960     END-IF.
007860*================================================================*
007870 作業ファイル作成１ SECTION.
007880*
007890     MOVE SPACE TO 作１−レコード.
007900     INITIALIZE    作１−レコード.
007910     MOVE 受−保険種別 TO 作１−保険種別.
007920     EVALUATE 受−保険種別
007930     WHEN 1
               IF 受−保険者番号(3:1) = 3
007910             MOVE 3          TO 作１−保険区分
               ELSE
007910             MOVE 1          TO 作１−保険区分
               END-IF
007940         MOVE 受−保険者番号 TO 作１−保険者番号
007950         EVALUATE 受−特別区分
007960         WHEN 1
007971         WHEN 2
007970             MOVE 1          TO 作１−区分
007980         WHEN 3
007990             MOVE 2          TO 作１−区分
008000         WHEN 6
008010             MOVE 4          TO 作１−区分
008020         WHEN 0
008030         WHEN SPACE
008040             MOVE 3          TO 作１−区分
008050         END-EVALUATE
008060*
008070     WHEN 8
007910         MOVE 2              TO 作１−保険区分
008080         MOVE 受−保険者番号 TO 作１−保険者番号
008090         EVALUATE 受−特別区分
008100         WHEN 1
008111         WHEN 2
008110*             MOVE 1          TO 作１−区分
008110             MOVE 0          TO 作１−区分
008120         WHEN 3
008130*             MOVE 2          TO 作１−区分
008130             MOVE 0          TO 作１−区分
008140         WHEN 6
008150             MOVE 4          TO 作１−区分
008160         WHEN 0
008170         WHEN SPACE
008180             IF 受−本人家族区分 = 2
008190                 MOVE 3      TO 作１−区分
008200             ELSE
008210                 MOVE 0      TO 作１−区分
008220             END-IF
008230         END-EVALUATE
008070     WHEN 5
007910         MOVE 4                  TO 作１−保険区分
007940         MOVE 受−費用負担者番号 TO 作１−保険者番号
007950         EVALUATE 受−特別区分
007960         WHEN 1
007971         WHEN 2
007970             MOVE 1          TO 作１−区分
007980         WHEN 3
007990             MOVE 2          TO 作１−区分
008240     END-EVALUATE.
008250     READ 作業ファイル１
008260     INVALID KEY
008270         MOVE 1                TO 作１−件数 
009470         MOVE レセ−レセ実日数 TO 作１−日数
008290         MOVE レセ−合計       TO 作１−費用額
008290         MOVE レセ−一部負担金 TO 作１−負担額
008290         MOVE レセ−請求金額   TO 作１−請求額
008300         WRITE 作１−レコード
008310         INVALID KEY
008320             DISPLAY NC"状態キー" 状態キー
008330             MOVE NC"作１"  TO ファイル名Ｗ
008340             PERFORM エラー表示
008350         END-WRITE
008360     NOT INVALID KEY
008370         COMPUTE 作１−件数   = 作１−件数   + 1
009470         COMPUTE 作１−日数   = 作１−日数   + レセ−レセ実日数
008390         COMPUTE 作１−費用額 = 作１−費用額 + レセ−合計
008390         COMPUTE 作１−負担額 = 作１−負担額 + レセ−一部負担金
008390         COMPUTE 作１−請求額 = 作１−請求額 + レセ−請求金額
008400         REWRITE 作１−レコード
008410         INVALID KEY
008420             DISPLAY NC"状態キー" 状態キー
008430             MOVE NC"作１"  TO ファイル名Ｗ
008440             PERFORM エラー表示
008450         END-REWRITE
008460     END-READ.
007860*================================================================*
007870 作業ファイル作成２ SECTION.
007880*
007890     MOVE SPACE TO 作１−レコード.
007900     INITIALIZE    作１−レコード.
007910     MOVE 受−助成種別           TO 作１−保険種別.
           PERFORM 市町村情報取得.
007910     MOVE 5                      TO 作１−保険区分.
008250     READ 作業ファイル１
008260     INVALID KEY
008270         MOVE 1                  TO 作１−件数 
009470         MOVE レセ−レセ実日数   TO 作１−日数
008290         MOVE レセ−合計         TO 作１−費用額
008290         MOVE レセ−受給者負担額 TO 作１−負担額
008290         MOVE レセ−助成請求金額 TO 作１−請求額
008300         WRITE 作１−レコード
008310         INVALID KEY
008320             DISPLAY NC"状態キー" 状態キー
008330             MOVE NC"作１"  TO ファイル名Ｗ
008340             PERFORM エラー表示
008350         END-WRITE
008360     NOT INVALID KEY
008370         COMPUTE 作１−件数   = 作１−件数   + 1
009470         COMPUTE 作１−日数   = 作１−日数   + レセ−レセ実日数
008390         COMPUTE 作１−費用額 = 作１−費用額 + レセ−合計
008390         COMPUTE 作１−負担額 = 作１−負担額 + レセ−受給者負担額
008390         COMPUTE 作１−請求額 = 作１−請求額 + レセ−助成請求金額
008400         REWRITE 作１−レコード
008410         INVALID KEY
008420             DISPLAY NC"状態キー" 状態キー
008430             MOVE NC"作１"  TO ファイル名Ｗ
008440             PERFORM エラー表示
008450         END-REWRITE
008460     END-READ.
006222*================================================================*
006230 市町村情報取得 SECTION.
006240*
006250*********************************************************
006260* 連結データから市町村マスタより請求先を取得する。      *
006270* ● 請求先...... 請求先名称Ｗに格納                    *
006280*********************************************************
006290     MOVE 受−助成種別            TO 市−公費種別.
006300     MOVE 受−費用負担者番号助成  TO 市−市町村番号.
006310     READ 市町村マスタ
006320     INVALID KEY
006330         MOVE SPACE               TO 作１−保険者番号
006340     NOT INVALID KEY
006330         MOVE 市−保険者番号      TO 作１−保険者番号
006360     END-READ.
008470*================================================================*
008480******************************************************************
008490 END PROGRAM YGN585.
008500******************************************************************
