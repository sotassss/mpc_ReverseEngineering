000010******************************************************************
000020*            IDENTIFICATION      DIVISION                        *
000030******************************************************************
000040 IDENTIFICATION          DIVISION.
000050 PROGRAM-ID.             YGN722.
000060 AUTHOR.                 池田　幸子
000070*
000080*----------------------------------------------------------------*
000090*         カルテ裏印刷（柔+ｳｨﾝﾄﾞｳｽﾞ版）
000100*         MED = YGN720 YGN722P
000110*----------------------------------------------------------------*
000120 DATE-WRITTEN.           2015-02-06
000130 DATE-COMPILED.          2015-02-06
000140*----------------------------------------------------------------*
000153******************************************************************
000160*            ENVIRONMENT         DIVISION                        *
000170******************************************************************
000180 ENVIRONMENT             DIVISION.
000190 CONFIGURATION           SECTION.
000200 SOURCE-COMPUTER.        FMV-DESKPOWER-TS.
000210 OBJECT-COMPUTER.        FMV-DESKPOWER.
000220 SPECIAL-NAMES.          CONSOLE  IS  CONS
000230                         SYSERR   IS  MSGBOX.
000240 INPUT-OUTPUT            SECTION.
000250 FILE-CONTROL.
000260     SELECT  元号マスタ      ASSIGN      TO        GENGOUL
000270                             ORGANIZATION             IS  INDEXED
000280                             ACCESS MODE              IS  DYNAMIC
000290                             RECORD KEY               IS  元−元号区分
000300                             FILE STATUS              IS  状態キー
000310                             LOCK        MODE         IS  AUTOMATIC.
000320     SELECT  制御情報マスタ  ASSIGN      TO        SEIGYOL
000330                             ORGANIZATION             IS  INDEXED
000340                             ACCESS MODE              IS  DYNAMIC
000350                             RECORD KEY               IS  制−制御区分
000360                             FILE STATUS              IS  状態キー
000370                             LOCK        MODE         IS  AUTOMATIC.
000380     SELECT  名称マスタ      ASSIGN      TO        MEISYOL
000390                             ORGANIZATION             IS  INDEXED
000400                             ACCESS MODE              IS  DYNAMIC
000410                             RECORD KEY               IS  名−区分コード
000420                                                          名−名称コード
000430                             FILE STATUS              IS  状態キー
000440                             LOCK        MODE         IS  AUTOMATIC.
000450     SELECT  メモファイル    ASSIGN      TO        MEMOL
000460                             ORGANIZATION             IS  INDEXED
000470                             ACCESS MODE              IS  DYNAMIC
000480                             RECORD KEY               IS  メモ−制御区分
000490                                                          メモ−患者コード
000500                                                          メモ−施術和暦年月日
000510                             ALTERNATE RECORD KEY     IS  メモ−制御区分
000520                                                          メモ−施術和暦年月日
000530                                                          メモ−患者コード
000540                             ALTERNATE RECORD KEY     IS  メモ−患者コード
000550                                                          メモ−施術和暦年月日
000560                                                          メモ−制御区分
000570                             FILE STATUS              IS  状態キー
000580                             LOCK        MODE         IS  AUTOMATIC.
000590     SELECT  受診者情報Ｆ    ASSIGN      TO        JUSINJL
000600                             ORGANIZATION             IS  INDEXED
000610                             ACCESS MODE              IS  DYNAMIC
000620                             RECORD KEY               IS 受−施術和暦年月
000630                                                          受−患者コード
000640                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000650                                                          受−患者カナ
000660                                                          受−患者コード
000670                             ALTERNATE RECORD KEY     IS  受−患者コード
000680                                                         受−施術和暦年月
000690                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000700                                                          受−保険種別
000710                                                          受−保険者番号
000720                                                          受−患者コード
000730                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000740                                                          受−公費種別
000750                                                     受−費用負担者番号
000760                                                          受−患者コード
000770                             ALTERNATE RECORD KEY     IS 受−施術和暦年月
000780                                                          受−助成種別
000790                                                  受−費用負担者番号助成
000800                                                          受−患者コード
000810                             ALTERNATE RECORD KEY  IS 受−請求和暦年月
000820                                                      受−施術和暦年月
000830                                                      受−患者コード
000840                             FILE STATUS              IS  状態キー
000850                             LOCK        MODE         IS  AUTOMATIC.
000860     SELECT  作業ファイル１  ASSIGN      TO        "C:\MAKISHISYS\YAWOBJ\TEMP\W7211L.DAT"
000870                             ORGANIZATION             IS  INDEXED
000880                             ACCESS                   IS  DYNAMIC
000890                             RECORD      KEY          IS  作１−施術和暦年月日
000900                                                          作１−患者コード
000910                             ALTERNATE RECORD KEY     IS  作１−施術和暦年月日
000920                                                          作１−患者カナ
000930                                                          作１−患者コード
000940                             ALTERNATE RECORD KEY     IS  作１−患者コード
000950                                                          作１−施術和暦年月日
000960                             ALTERNATE RECORD KEY     IS  作１−患者カナ
000970                                                          作１−患者コード
000980                                                          作１−施術和暦年月日
000990                             FILE        STATUS       IS  状態キー
001000                             LOCK        MODE         IS  AUTOMATIC.
001010     SELECT  作業ファイル２  ASSIGN      TO        "C:\MAKISHISYS\YAWOBJ\TEMP\W7212L.DAT"
001020                             ORGANIZATION             IS  INDEXED
001030                             ACCESS                   IS  DYNAMIC
001040                             RECORD      KEY          IS  作２−施術和暦年月
001050                                                          作２−患者コード
001060                             FILE        STATUS       IS  状態キー
001070                             LOCK        MODE         IS  AUTOMATIC.
001080     SELECT  印刷ファイル    ASSIGN      TO     GS-PRTF002
001090                             SYMBOLIC    DESTINATION  IS "PRT"
001100                             FORMAT                   IS  定義体名Ｐ
001110                             GROUP                    IS  項目群名Ｐ
001120                             PROCESSING  MODE         IS  処理種別Ｐ
001130                             UNIT        CONTROL      IS  拡張制御Ｐ
001140                             FILE        STATUS       IS  通知情報Ｐ.
001150******************************************************************
001160*                      DATA DIVISION                             *
001170******************************************************************
001180 DATA                    DIVISION.
001190 FILE                    SECTION.
001200*                           ［ＲＬ＝  １２８］
001210 FD  元号マスタ          BLOCK   CONTAINS   1   RECORDS.
001220     COPY GENGOU          OF  XFDLIB  JOINING   元   AS  PREFIX.
001230*                           ［ＲＬ＝  ２５６］
001240 FD  制御情報マスタ          BLOCK   CONTAINS   1   RECORDS.
001250     COPY SEIGYO          OF  XFDLIB  JOINING   制   AS  PREFIX.
001250     COPY SEIGYO02        OF  XFDLIB  JOINING   制０２   AS  PREFIX.
001260*                           ［ＲＬ＝  １２８］
001270 FD  名称マスタ          BLOCK   CONTAINS   1   RECORDS.
001280     COPY MEISYO          OF  XFDLIB  JOINING   名   AS  PREFIX.
001290*                           ［ＲＬ＝  ８３２］
001300 FD  メモファイル        BLOCK CONTAINS 1     RECORDS.
001310     COPY MEMO           OF    XFDLIB JOINING メモ AS PREFIX.
001320*                           ［ＲＬ＝  ３２０］
001330 FD  受診者情報Ｆ        BLOCK   CONTAINS   1   RECORDS.
001340     COPY JUSINJ          OF  XFDLIB  JOINING   受   AS  PREFIX.
001900*                         ［ＲＬ＝  ２７２］
001910 FD  作業ファイル１ RECORD  CONTAINS 272 CHARACTERS.
001920 01 作１−レコード.
001930    03 作１−レコードキー.
001940       05 作１−施術和暦年月日.
001950          07 作１−施術和暦               PIC 9.
001960          07 作１−施術年月.
001970             09 作１−施術年              PIC 9(2).
001980             09 作１−施術月              PIC 9(2).
001990          07 作１−施術日                 PIC 9(2).
002000       05 作１−患者コード.
002010          07 作１−患者番号                PIC 9(6).
002020          07 作１−枝番                    PIC X(1).
002030    03 作１−レコードデータ.
002100       05 作１−患者カナ                   PIC X(50).
002110       05 作１−患者氏名                   PIC X(50).
002130       05 作１−料金.
001550          07 作１−初検金額                PIC 9(5).
                07 作１−整復                    OCCURS 4.
001550             09 作１−整復金額             PIC 9(5).
001550          07 作１−その他                  PIC 9(5).
001550          07 作１−罨法等                  PIC 9(5).
001550          07 作１−金属副子                PIC 9(5).
001550          07 作１−往療料                  PIC 9(5).
002300          07 作１−費用額                  PIC 9(6).
002270          07 作１−一部負担金              PIC 9(5).
002280          07 作１−コメント                PIC X(100).
002310       05 FILLER                           PIC X(2).
002320*
002330*                         ［ＲＬ＝  １２８］
002340 FD  作業ファイル２ RECORD  CONTAINS 128 CHARACTERS.
002350 01 作２−レコード.
002360    03 作２−レコードキー.
002370       05 作２−施術和暦年月.
002380          07 作２−施術和暦                PIC 9.
002390          07 作２−施術年月.
002400             09 作２−施術年               PIC 9(2).
002410             09 作２−施術月               PIC 9(2).
002420       05 作２−患者コード.
002430          07 作２−患者番号                PIC 9(6).
002440          07 作２−枝番                    PIC X(1).
002450    03 作２−レコードデータ.
002610       05 作２−請求額                     PIC 9(6).
002620       05 作２−初検等                     PIC 9(6).
             05 作２−整復                       OCCURS 4.
001550          07 作２−整復金額                PIC 9(6).
001550       05 作２−その他                     PIC 9(6).
001550       05 作２−罨法等                     PIC 9(6).
001550       05 作２−金属副子                   PIC 9(6).
001550       05 作２−往療料                     PIC 9(6).
002600       05 作２−費用額                     PIC 9(6).
002710       05 FILLER                           PIC X(50).
002160*
002170 FD  印刷ファイル.
002180     COPY YGN722P        OF  XMDLIB.
002190*----------------------------------------------------------------*
002200******************************************************************
002210*                WORKING-STORAGE SECTION                         *
002220******************************************************************
002230 WORKING-STORAGE         SECTION.
002240 01 キー入力                           PIC X     VALUE SPACE.
002250 01 状態キー                           PIC X(2)  VALUE SPACE.
002260 01 終了フラグ                         PIC X(3)  VALUE SPACE.
002270 01 終了フラグ２                       PIC X(3)  VALUE SPACE.
002280 01 印刷フラグ                         PIC 9     VALUE ZERO.
002290 01 初検フラグ                         PIC X(3)  VALUE SPACE.
002300 01 ファイル名                         PIC N(6)  VALUE SPACE.
002310 01 レセプトＰＧＷ                     PIC X(8)  VALUE SPACE.
002320 01 前和暦Ｗ                           PIC 9     VALUE ZERO.
002330 01 カレント元号Ｗ                     PIC 9(1)  VALUE ZERO.
002340 01 部位ＣＮＴ                         PIC 9     VALUE ZERO.
002350 01 カウンタ                           PIC 9(2)  VALUE ZERO.
002360 01 カウンタ１                         PIC 9(2)  VALUE ZERO.
002360 01 カウンタ２                         PIC 9(2)  VALUE ZERO.
002370 01 オープンフラグ                     PIC X(3) VALUE SPACE.
002380 01 患者番号Ｗ                         PIC 9(6)  VALUE ZERO.
002390 01 行カウンタ                         PIC 9(2) VALUE 0.
002400 01 最大行数                           PIC 9(2) VALUE 0.
002410 01 ヘッダ行数                         PIC 9(2) VALUE 0.
002420 01 移動行数Ｗ                         PIC 9(2) VALUE 0.
002420 01 改頁確認Ｗ                         PIC 9(1) VALUE ZERO.
002420 01 改行Ｗ                             PIC X(2) VALUE X"0D0A".
002430*/明細行に費用額を印字0304
002440 01 文字ＣＮＴ                         PIC 9(2) VALUE ZERO.
002450*
002470*/次のレコードを読んだ後に前のレコードのヘッダを印刷する為のワーク。
002480*/１ページちょうどで改ページして２ページ目が合計行のみの印刷の場合に必要
002490 01 ヘッダ項目退避用ワーク.
002500   03 患者コードＨＷ.
002510     05 患者番号ＨＷ                   PIC 9(6)  VALUE ZERO.
002520     05 枝番ＨＷ                       PIC X(1)  VALUE SPACE.
002530   03 患者氏名ＨＷ                     PIC X(50) VALUE SPACE.
002590**
002600 01 遅延フラグ                         PIC X(3) VALUE SPACE.
002610 01 遅延回数Ｗ                         PIC 9(4) VALUE ZERO.
002620 01 遅延ＣＮＴ                         PIC 9(5) VALUE ZERO.
002630**
       01 ワーク.
          03 番号Ｗ                          PIC N(1) VALUE SPACE.
          03 記号Ｗ                          PIC N(5) VALUE SPACE.
       01 合成Ｗ                             PIC N(24) VALUE SPACE.
002610 01 請求額Ｗ.
          03 請求額ＷＰ                      PIC ZZZ,ZZ9 VALUE ZERO.
002790****************
002800* 連結項目待避 *
002810****************
002820*    ************
002830*    * 印刷キー *
002840*    ************
002850 01 対象データＷＲ.
002860    03 施術和暦年月ＷＲ.
002870       05 施術和暦ＷＲ                  PIC 9(1)  VALUE ZERO.
002880       05 施術年ＷＲ                    PIC 9(2)  VALUE ZERO.
002890       05 施術月ＷＲ                    PIC 9(2)  VALUE ZERO.
002900    03 開始日ＷＲ                       PIC 9(2)  VALUE ZERO.
002910    03 終了日ＷＲ                       PIC 9(2)  VALUE ZERO.
002920    03 患者カナＷＲ                     PIC X(50) VALUE SPACE.
002930    03 患者コードＷ.
002940       05 患者番号Ｗ                    PIC 9(6)  VALUE ZERO.
002950       05 枝番Ｗ                        PIC X(1)  VALUE SPACE.
002960    03 印刷モードＦＷＲ                 PIC 9(1)  VALUE ZERO.
002970    03 印字位置ＣＮＴ                   PIC 9(2)  VALUE ZERO.
002980**************
002990* 受診者情報 *
003000**************
003010 01 受診者情報Ｗ.
003020    03 施術年月Ｗ.
003030       05 施術和暦Ｗ                   PIC 9(1)   VALUE ZERO.
003040       05 施術年Ｗ                     PIC 9(2)   VALUE ZERO.
003050       05 施術月Ｗ                     PIC 9(2)   VALUE ZERO.
003190    03 患者情報Ｗ.
003200       05 患者カナＷ                   PIC X(50)  VALUE SPACE.
003210       05 患者氏名Ｗ                   PIC X(50)  VALUE SPACE.
003220 01 患者氏名ＷＰ.
003230    03 患者名ＷＰ                      OCCURS 10. 
003240       05 患者名Ｗ                        PIC N(1)   VALUE SPACE.
003250 01 コメントＷ.
003260    03 コメント１Ｗ                       PIC X(50) VALUE SPACE.
003270    03 コメント２Ｗ                       PIC X(50) VALUE SPACE.
003280* POWER COBOL用
003290 01 dll-name  PIC X(260)  VALUE SPACE.
003300 01 form-name PIC X(14)   VALUE SPACE.
003310*******************************************************************
003320 01 印刷制御.
003330     03 定義体名Ｐ                     PIC X(8) VALUE SPACE.
003340     03 項目群名Ｐ                     PIC X(8) VALUE SPACE.
003350     03 処理種別Ｐ                     PIC X(2) VALUE SPACE.
003360     03 拡張制御Ｐ.
003370         05 端末制御Ｐ.
003380             07 移動方向Ｐ             PIC X(1) VALUE SPACE.
003390             07 移動行数Ｐ             PIC 9(3) VALUE ZERO.
003400         05 詳細制御Ｐ                 PIC X(2) VALUE SPACE.
003410     03 通知情報Ｐ                     PIC X(2) VALUE SPACE.
003420     03 ユニット名Ｐ                   PIC X(8) VALUE SPACE.
003430*
003440 01 計算機西暦年Ｗ                     PIC 9(2) VALUE ZERO.
003450* 日付ＷＯＲＫ
003460 01 和暦終了年Ｗ                       PIC 9(4) VALUE ZERO.
003470 01 計算機西暦.
003480    03 計算機西暦年                    PIC 9(4) VALUE ZERO.
003490    03 計算機西暦月日                  PIC 9(4) VALUE ZERO.
003500 01 計算機西暦Ｒ REDEFINES 計算機西暦.
003510    03 計算機世紀                      PIC 9(2).
003520    03 計算機日付                      PIC 9(6).
003530    03 計算機日付Ｒ REDEFINES 計算機日付.
003540       05 計算機年月                   PIC 9(4).
003550       05 計算機年月Ｒ REDEFINES 計算機年月.
003560         07 計算機年                   PIC 9(2).
003570         07 計算機月                   PIC 9(2).
003580       05 計算機日                     PIC 9(2).
003600*
003628******************************************************************
003629*                          連結項目                              *
003630******************************************************************
003631**********************
003640* メッセージ表示キー *
003650**********************
003660 01 連メ−キー IS EXTERNAL.
003670    03  連メ−メッセージ                 PIC N(20).
003680*
003690************
003700* 印刷キー *
003710************
       01 連印−対象データＹＧＮ７２０ IS EXTERNAL.
          03 連印−施術和暦年月日.
             05 連印−施術和暦                  PIC 9(1).
             05 連印−施術年                    PIC 9(2).
             05 連印−施術月                    PIC 9(2).
             05 連印−施術日                    PIC 9(2).
          03 連印−患者コード.
             05 連印−患者番号                  PIC 9(6).
             05 連印−枝番                      PIC X(1).
          03 連印−ワクモード                   PIC 9(1).
          03 連印−氏名モード                   PIC 9(1).
          03 連印−明細モード                   PIC 9(1).
          03 連印−合計モード                   PIC 9(1).
          03 連印−コメントモード               PIC 9(1).
          03 連印−読み順                       PIC X(4).
          03 連印−段数                         PIC 9(2).
          03 連印−処理キー                     PIC X(4).
003900****************
003910* 画面入力情報 *
003920****************
004960 01 連入−入力データＹＧＮ７２０ IS EXTERNAL.
004970    03 連入−開始和暦年月日.
004980       05 連入−開始和暦                  PIC 9(1).
004990       05 連入−開始年                    PIC 9(2).
005000       05 連入−開始月                    PIC 9(2).
005010       05 連入−開始日                    PIC 9(2).
005020    03 連入−終了和暦年月日.
005030       05 連入−終了和暦                  PIC 9(1).
005040       05 連入−終了年                    PIC 9(2).
005050       05 連入−終了月                    PIC 9(2).
005060       05 連入−終了日                    PIC 9(2).
005080    03 連入−保険種別                     PIC 9(2).
005090    03 連入−本人家族区分                 PIC 9(1).
005100    03 連入−患者コード.
005110       05 連入−患者番号                  PIC 9(6).
005120       05 連入−枝番                      PIC X(1).
005140    03 連入−印刷条件                     PIC 9(2).
004130*
004140 01 連入−表示フラグＹＧＮ７２０ IS EXTERNAL GLOBAL.
004150    03 連入−プレビュー区分               PIC 9(1).
004163*
004170 01 連−共通キー IS EXTERNAL.
004180    03  連−カレント和暦               PIC 9.
004270*
004280************************************
004290* プリンタファイル作成用           *
004300************************************
004310 01 Ｈ連ＰＲＴＦ−作成データ IS EXTERNAL.
004320     03 Ｈ連ＰＲＴＦ−ファイル名           PIC X(8).
004330     03 Ｈ連ＰＲＴＦ−プレビュー区分       PIC 9.
004340     03 Ｈ連ＰＲＴＦ−帳票プログラム名     PIC X(8).
004350     03 Ｈ連ＰＲＴＦ−オーバレイ名         PIC X(8).
004360************************************
004370* プリンタファイル作成特殊用       *
004380************************************
004390 01 Ｈ連特殊ＰＲＴＦ−作成データ IS EXTERNAL.
004400     03 Ｈ連特殊ＰＲＴＦ−用紙種類         PIC X(8).
004410*
004420 01 連メッセージＰ情報００５１ IS EXTERNAL.
004430    03 連メＰ−メッセージ番号                PIC 9(2).
004440    03 連メＰ−メッセージ.
004450       05 連メＰ−メッセージ内容             PIC X(40) OCCURS 6.
004460    03 連メＰ−メッセージ１                  PIC X(20).
004470    03 連メＰ−メッセージ２                  PIC X(12).
004480    03 連メＰ−返り値                        PIC X.
004490******************************************************************
004500*                      PROCEDURE  DIVISION                       *
004510******************************************************************
004520 PROCEDURE               DIVISION.
004530************
004540*           *
004550* 初期処理   *
004560*           *
004570************
014890     MOVE SPACE TO オープンフラグ.
004580     PERFORM プリンタファイル作成.
004590     PERFORM 初期化.
004600     PERFORM 制御情報取得.
004610************
004620*           *
004630* 主処理     *
004640*           *
004650************
004660* 印刷
004760     PERFORM 印刷セット１.
005150************
005160*           *
005170* 終了処理   *
005180*           *
005190************
005200     PERFORM 終了処理.
005210     PERFORM 遅延処理.
005220     EXIT PROGRAM.
005230*
005240*<<<<<<<<<<<<<<<<<<<<<<<<< END OF PROGRAM >>>>>>>>>>>>>>>>>>>>>>>>
005250*================================================================*
005260 プリンタファイル作成 SECTION.
005270*================================================================*
005280*   / 初期化 /
005290     MOVE SPACE TO Ｈ連ＰＲＴＦ−作成データ.
005300     INITIALIZE Ｈ連ＰＲＴＦ−作成データ.
005310     MOVE SPACE TO Ｈ連特殊ＰＲＴＦ−作成データ.
005320     INITIALIZE Ｈ連特殊ＰＲＴＦ−作成データ.
005330*
005340*
005350*--↓↓ 変更箇所 ↓↓--------------------------------------*
005360*   使用する用紙種別セット
005370     MOVE "KARUTE"              TO Ｈ連特殊ＰＲＴＦ−用紙種類.
005380*   使用するプリンタファイル名セット
005390     MOVE "PRTF002"             TO Ｈ連ＰＲＴＦ−ファイル名.
005400*
005410*   使用する帳票プログラム名セット
005420     MOVE "YGN722"              TO Ｈ連ＰＲＴＦ−帳票プログラム名.
           IF 連印−ワクモード = 1
              MOVE "YGN722P"          TO Ｈ連ＰＲＴＦ−オーバレイ名
           END-IF.
005430*
005440*--↑↑-----------------------------------------------------*
005450*
005460*   / プレビュー区分セット /
005470     MOVE 連入−プレビュー区分 TO Ｈ連ＰＲＴＦ−プレビュー区分.
005480*     MOVE 1 TO Ｈ連ＰＲＴＦ−プレビュー区分.
005490*
005500*-------------------------------------------------------------------*
005501*
005503     CALL   "CRTPRTF".
005510     CANCEL "CRTPRTF".
005520*
005530*================================================================*
005540 初期化 SECTION.
005550*
005560     PERFORM ファイルオープン.
005570*    /* 現在日付取得 */
005580     ACCEPT 計算機日付 FROM DATE.
005590*    /* 1980〜2079年の間で設定 */
005600     IF 計算機年 > 80
005610         MOVE 19 TO 計算機世紀
005620     ELSE
005630         MOVE 20 TO 計算機世紀
005640     END-IF.
005650     PERFORM カレント元号取得.
005660     PERFORM 和暦終了年取得.
005670     COMPUTE 計算機西暦年Ｗ = 計算機西暦年 - 1988.
005680*================================================================*
005690 カレント元号取得 SECTION.
005700*
005710     MOVE ZEROS TO 制−制御区分.
005720     READ 制御情報マスタ
005730     NOT INVALID KEY
005740         MOVE 制−カレント元号 TO カレント元号Ｗ
005750     END-READ.
005760*
005770*================================================================*
005780 和暦終了年取得 SECTION.
005790*
005800*     DISPLAY NC"カレント元号Ｗ"  カレント元号Ｗ UPON MSGBOX.
005810     MOVE カレント元号Ｗ TO 元−元号区分.
005820     READ 元号マスタ
005830     INVALID KEY
005840         DISPLAY NC"指定和暦が登録されていません" UPON CONS
005850         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
005860                                                  UPON CONS
005870*-----------------------------------------*
005880         CALL "actcshm"  WITH C LINKAGE
005890*-----------------------------------------*
005900         ACCEPT  キー入力 FROM CONS
005910         PERFORM 終了処理
005920         EXIT PROGRAM
005930     NOT INVALID KEY
005940         COMPUTE 前和暦Ｗ = カレント元号Ｗ - 1
005950         MOVE 前和暦Ｗ TO 元−元号区分
005960         READ 元号マスタ
005970         INVALID KEY
005980             DISPLAY NC"指定和暦が登録されていません" UPON CONS
005990             DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
006000                                                      UPON CONS
006010*-----------------------------------------*
006020             CALL "actcshm"  WITH C LINKAGE
006030*-----------------------------------------*
006040             ACCEPT  キー入力 FROM CONS
006050             PERFORM 終了処理
006060             EXIT PROGRAM
006070         NOT INVALID KEY
006080             MOVE 元−終了西暦年 TO 和暦終了年Ｗ
006090         END-READ
006100     END-READ.
006110*
006120*================================================================*
006130 ファイルオープン SECTION.
006140*
006150     OPEN INPUT   元号マスタ
006160         MOVE NC"元号" TO ファイル名.
006170         PERFORM オープンチェック.
006180     OPEN INPUT   制御情報マスタ
006190         MOVE NC"制御情報" TO ファイル名.
006200         PERFORM オープンチェック.
006210     OPEN INPUT 名称マスタ.
006220         MOVE NC"名称" TO ファイル名.
006230         PERFORM オープンチェック.
006240     OPEN INPUT メモファイル.
006250         MOVE NC"メモ" TO ファイル名.
006260         PERFORM オープンチェック.
006270     OPEN INPUT   受診者情報Ｆ.
006280         MOVE NC"受情" TO ファイル名.
006290         PERFORM オープンチェック.
006320     OPEN INPUT 作業ファイル１
006330         MOVE NC"作業１" TO ファイル名
006340         PERFORM オープンチェック.
006350     OPEN INPUT 作業ファイル２
006360         MOVE NC"作業２" TO ファイル名
006370         PERFORM オープンチェック.
006390*     OPEN I-O   印刷ファイル.
006400*         PERFORM エラー処理Ｐ.
006410*================================================================*
006420 オープンチェック SECTION.
006430*
006440     IF 状態キー  NOT =  "00"
006450         DISPLAY ファイル名 NC"Ｆオープンエラー" UPON CONS
006460         DISPLAY NC"状態キー：" 状態キー         UPON CONS
006470         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
006480                                                 UPON CONS
006490*-----------------------------------------*
006500         CALL "actcshm"  WITH C LINKAGE
006510*-----------------------------------------*
006520         ACCEPT  キー入力 FROM CONS
006530         PERFORM ファイル閉鎖
006540         EXIT PROGRAM.
006550*================================================================*
006560 制御情報取得 SECTION.
006570*
006580     MOVE ZERO TO 制−制御区分
006590     READ 制御情報マスタ
006600     NOT INVALID KEY
006610         MOVE 制−遅延回数       TO 遅延回数Ｗ
006620     END-READ.
006630*
006640*================================================================*
006650 遅延処理 SECTION.
006660*
006670     PERFORM VARYING 遅延ＣＮＴ FROM 1 BY 1
006680                                UNTIL 遅延ＣＮＴ > 遅延回数Ｗ
006690         MOVE SPACE TO 遅延フラグ
006700     END-PERFORM.
006710*
006720*================================================================*
006730 印刷セット１ SECTION.
006740*
006750     MOVE SPACE TO 終了フラグ.
006760     MOVE ZERO  TO 行カウンタ.
006780     MOVE 連印−患者コード  TO 作１−患者コード.
006790     MOVE ZERO              TO 作１−施術和暦.
006800     MOVE ZERO              TO 作１−施術年.
006810     MOVE ZERO              TO 作１−施術月.
006820     START 作業ファイル１ KEY IS > 作１−患者コード
006830                                   作１−施術和暦年月日
006840     END-START.
006850     IF 状態キー  =  "00"
006860         MOVE SPACE  TO 終了フラグ
006870         PERFORM 作業ファイル１読込
006880         MOVE 作１−患者コード   TO 患者コードＷ
006890         MOVE 作１−施術和暦     TO 施術和暦Ｗ
006900         MOVE 作１−施術年       TO 施術年Ｗ
006910         MOVE 作１−施術月       TO 施術月Ｗ
006930*/次のレコードを読んでから前のヘッダを印刷する必要がある場合の為に退避しておく。(改ページ後の合計行)
006940         MOVE 作１−患者番号      TO 患者番号ＨＷ    
006950         MOVE 作１−枝番          TO 枝番ＨＷ        
006960         MOVE 作１−患者氏名      TO 患者氏名ＨＷ    
007020*
007030         IF 連印−段数 = ZERO
007040             MOVE 1              TO 行カウンタ
007050         ELSE
007060             MOVE 連印−段数     TO 行カウンタ
007070         END-IF
007100*
007110         PERFORM UNTIL ( 終了フラグ = "YES" ) OR
007120                       ( 作１−患者コード NOT = 患者コードＷ )
007130             INITIALIZE YGN722P
007140             MOVE SPACE TO YGN722P
007160             IF 連印−氏名モード = 1
007190                 PERFORM ヘッダセット
007210             END-IF
007280             PERFORM VARYING カウンタ FROM 行カウンタ BY 1
007290                     UNTIL ( カウンタ > 31 ) OR
007300                           ( 作１−患者コード NOT = 患者コードＷ ) OR
007310                           ( 終了フラグ = "YES" )
007320                 IF カウンタ > 31
007330                     PERFORM 印刷処理
007340                     PERFORM 改頁処理
007350*
007470                     MOVE 1                    TO 連メＰ−メッセージ番号
007480                     MOVE NC"次の用紙をセットしてください" TO 連メＰ−メッセージ
007490                     MOVE "PMSG0051.DLL" TO dll-name
007500                     MOVE "PMSG0051"     TO form-name
007510                     CALL "POWEROPENSHEET" USING dll-name form-name
007530*                   */改頁後は氏名を印刷する
007540                     IF 連メＰ−返り値 = "Y"
007550                         MOVE 1 TO 連印−氏名モード
                           ELSE
                               MOVE 1              TO  印字位置ＣＮＴ
                               PERFORM 印刷行数退避
005932                         PERFORM 終了処理
005933                         PERFORM 遅延処理
005934                         EXIT PROGRAM
007610                     END-IF
007620                     INITIALIZE YGN722P
007630                     MOVE SPACE TO YGN722P
007670                     IF 連印−氏名モード = 1
007690                        PERFORM ヘッダセット
007780                     END-IF
007790                     MOVE 1  TO カウンタ
007800                 END-IF
007810*/月が変わった時の処理
007820                 IF ( 作１−施術年 NOT = 施術年Ｗ ) OR
007830                    ( 作１−施術月 NOT = 施術月Ｗ )
007840*/総評の印刷はコメントの印刷があり、かつ、合計の印刷もある時のみに変更。020108
007850                     IF (連印−コメントモード = 1) AND
007860                        (連印−合計モード     = 1)
007880                         PERFORM 総評コメント印刷処理
007890                     END-IF
007900                     IF 連印−合計モード = 1
007910                         PERFORM 合計印刷処理
007920                         IF カウンタ > 31
007930                             PERFORM 印刷処理
007940                             PERFORM 改頁処理
007950*
008070                             MOVE 1                    TO 連メＰ−メッセージ番号
008080                             MOVE NC"次の用紙をセットしてください" TO 連メＰ−メッセージ
008090                             MOVE "PMSG0051.DLL" TO dll-name
008100                             MOVE "PMSG0051"     TO form-name
008110                             CALL "POWEROPENSHEET" USING dll-name form-name
008130*                           */改頁後は氏名を印刷する
008140                             IF 連メＰ−返り値 = "Y"
008150                                 MOVE 1 TO 連印−氏名モード
                                   ELSE
                                       MOVE 1 TO  印字位置ＣＮＴ
                                       PERFORM 印刷行数退避
005932                                 PERFORM 終了処理
005933                                 PERFORM 遅延処理
005934                                 EXIT PROGRAM
008210                             END-IF
008220                             INITIALIZE YGN722P
008230                             MOVE SPACE TO YGN722P
008270                             IF 連印−氏名モード = 1
008290                                 PERFORM ヘッダセット
008380                             END-IF
008390                             MOVE 1  TO カウンタ
008400                         END-IF
008410                     END-IF
008430                 END-IF
008440                 IF 連印−明細モード = 1
008450                     PERFORM 明細印刷処理
008460                 END-IF
008470                 IF 連印−コメントモード = 1
008480                     PERFORM コメント印刷処理
008490                 END-IF
008500                 MOVE 作１−患者コード   TO 患者コードＷ
008510                 MOVE 作１−施術和暦     TO 施術和暦Ｗ
008520                 MOVE 作１−施術年       TO 施術年Ｗ
008530                 MOVE 作１−施術月       TO 施術月Ｗ
008550*/次のレコードを読んでから前のヘッダを印刷する必要がある場合の為に退避しておく。(改ページ後の合計行)
008560                 MOVE 作１−患者番号      TO 患者番号ＨＷ    
008570                 MOVE 作１−枝番          TO 枝番ＨＷ        
008580                 MOVE 作１−患者氏名      TO 患者氏名ＨＷ    
008640                 PERFORM 作業ファイル１読込
008650             END-PERFORM
008660             IF カウンタ > 31
008690                 PERFORM 印刷処理
008700                 PERFORM 改頁処理
008720*/印刷のあるなしを制御するフラグ020111
008730                 MOVE ZERO TO 印刷フラグ
008750                 EVALUATE TRUE
008760*               */指定、問合連続の最後の患者で全ての通院日を印刷して改頁。合計を印刷する場合は次頁あり。
008770*               */"指定、問合連続の最後の患者で、次頁が合計行のみ"
008780                 WHEN 終了フラグ = "YES"
008790                     IF 連印−合計モード = 1
008910                         MOVE 1                    TO 連メＰ−メッセージ番号
008920                         MOVE NC"次の用紙をセットしてください" TO 連メＰ−メッセージ
008930                         MOVE "PMSG0051.DLL" TO dll-name
008940                         MOVE "PMSG0051"     TO form-name
008950                         CALL "POWEROPENSHEET" USING dll-name form-name
008970*                       */改頁後は氏名を印刷する
008980                         IF 連メＰ−返り値 = "Y"
008990                             MOVE 1 TO 連印−氏名モード
                               ELSE
                                   MOVE 1 TO  印字位置ＣＮＴ
                                   PERFORM 印刷行数退避
005932                             PERFORM 終了処理
005933                             PERFORM 遅延処理
005934                             EXIT PROGRAM
009040                         END-IF
009060                         MOVE 1 TO 印刷フラグ
009070                     ELSE
009080*                       */"指定、問合連続の最後の患者で、31行で明細行が終わる"
009090                         CONTINUE
009100                     END-IF
009110*               */指定、問合で印刷の途中で改頁をした場合。次頁あり
009120*               */"指定、問合の最後の患者で、次頁に明細行が続く(通常の改頁)"
009130                 WHEN 作１−患者コード = 患者コードＷ
009250                     MOVE 1                    TO 連メＰ−メッセージ番号
009260                     MOVE NC"次の用紙をセットしてください" TO 連メＰ−メッセージ
009270                     MOVE "PMSG0051.DLL" TO dll-name
009280                     MOVE "PMSG0051"     TO form-name
009290                     CALL "POWEROPENSHEET" USING dll-name form-name
009310*                   */改頁後は氏名を印刷する
009320                     IF 連メＰ−返り値 = "Y"
009330                         MOVE 1 TO 連印−氏名モード
                           ELSE
                               MOVE 1 TO  印字位置ＣＮＴ
                               PERFORM 印刷行数退避
005932                         PERFORM 終了処理
005933                         PERFORM 遅延処理
005934                         EXIT PROGRAM
009390                     END-IF
009400*               */問合連続で全ての通院日を印刷して改頁。(読込んだレコードが次の患者の時)。
009410*               */合計を印刷する場合は次頁あり。(指定の場合は終了フラグで判定出来る)
009420*               */"問合連続で、次頁が合計行のみ"
009430                 WHEN (作１−患者コード NOT = 患者コードＷ) AND
009440                      (連印−合計モード     = 1) 
009560                     MOVE 1                    TO 連メＰ−メッセージ番号
009570                     MOVE NC"次の用紙をセットしてください" TO 連メＰ−メッセージ
009580                     MOVE "PMSG0051.DLL" TO dll-name
009590                     MOVE "PMSG0051"     TO form-name
009600                     CALL "POWEROPENSHEET" USING dll-name form-name
009620*                   */改頁後は氏名を印刷する
009630                     IF 連メＰ−返り値 = "Y"
009640                         MOVE 1 TO 連印−氏名モード
                           ELSE
                               MOVE 1 TO  印字位置ＣＮＴ
                               PERFORM 印刷行数退避
005932                         PERFORM 終了処理
005933                         PERFORM 遅延処理
005934                         EXIT PROGRAM
009690                     END-IF
009710                     MOVE 1 TO 印刷フラグ
009720                 WHEN OTHER
009730*                   */"問合連続で、明細行が３１行で終わり、合計行なし"
009740                     CONTINUE
009750                 END-EVALUATE
009770                 MOVE 1  TO 行カウンタ
009780                 MOVE 1  TO 印字位置ＣＮＴ
000981                 INITIALIZE YGN722P
009820                 MOVE SPACE TO YGN722P
009850                 IF 連メＰ−返り値 = "Y"
009860                     IF 連印−氏名モード = 1
009880                         IF 終了フラグ = "YES"
009890                             IF 連印−合計モード = 1
009900                                 PERFORM ヘッダセット２
009910                             END-IF
009920                         ELSE
009930                             IF (作１−患者コード NOT = 患者コードＷ) AND
009940                                (連印−合計モード = 1) 
009950                                 PERFORM ヘッダセット２
009960                             END-IF
009970                         END-IF
009990                     END-IF
010230                     MOVE 1 TO カウンタ
010240*/総評の印刷はコメントの印刷があり、かつ、合計の印刷もある時のみに変更。020108
010250                     IF (連印−コメントモード = 1) AND
010260                        (連印−合計モード     = 1)
010270*                       */総評コメントの転記
010280                         PERFORM 総評コメント印刷処理
010290                     END-IF
010300                     IF 連印−合計モード = 1
010310*                       */合計行の転記
010320                         PERFORM 合計印刷処理
010330                     END-IF
010350                     IF 印刷フラグ = 1
010360                         PERFORM 印刷処理
010370                         PERFORM 改頁処理
010380                     END-IF
010390                     MOVE カウンタ   TO 印字位置ＣＮＴ
010410                 END-IF
010430             ELSE
010460*/総評の印刷はコメントの印刷があり、かつ、合計の印刷もある時のみに変更。020108
010470                 IF (連印−コメントモード = 1) AND
010480                    (連印−合計モード     = 1)
010490                     PERFORM 総評コメント印刷処理
010500                 END-IF
010510                 IF 連印−合計モード = 1
010520                     PERFORM 合計印刷処理
010530                 END-IF
010570                 PERFORM 印刷処理
010580                 PERFORM 改頁処理
010590                 IF カウンタ > 31
010600                     MOVE 1  TO 印字位置ＣＮＴ
010610                 ELSE
010620                     MOVE カウンタ   TO 印字位置ＣＮＴ
010630                 END-IF
010690             END-IF
010740         END-PERFORM
010750         PERFORM 印刷行数退避
010760     END-IF.
011780*================================================================*
011790 ヘッダセット SECTION.
011800*
011810*     MOVE 作１−患者番号      TO 患者番号.
011820*     MOVE 作１−枝番          TO 枝番.
011830*     MOVE 作１−患者氏名      TO 患者氏名 患者氏名ＷＰ.
011950*
012230*================================================================*
012240 明細印刷処理 SECTION.
012250*
012260     MOVE 作１−施術月       TO 月(カウンタ).
012270     MOVE "/"                TO 区切(カウンタ).
012280     MOVE 作１−施術日       TO 日(カウンタ).
012290********************
012300* 料金データセット *
012310********************
005010     MOVE 作１−初検金額     TO  初検料等(カウンタ).
005010     MOVE 作１−整復金額(1)  TO  整復料１(カウンタ).
005010     MOVE 作１−整復金額(2)  TO  整復料２(カウンタ).
005010     MOVE 作１−整復金額(3)  TO  整復料３(カウンタ).
005010     MOVE 作１−整復金額(4)  TO  整復料４(カウンタ).
005010     MOVE 作１−その他       TO  その他(カウンタ).
005010     MOVE 作１−罨法等       TO  罨法等(カウンタ).
005010     MOVE 作１−金属副子     TO  金属副子料(カウンタ).
005010     MOVE 作１−往療料       TO  往療料(カウンタ).
005010     MOVE 作１−費用額       TO  費用額(カウンタ).
005010     MOVE 作１−一部負担金   TO  一部負担金(カウンタ).
012780*================================================================*
012790 コメント印刷処理 SECTION.
012800*
012810     MOVE 作１−コメント           TO  コメントＷ.
012820     MOVE コメント１Ｗ             TO  コメント１(カウンタ).
012830     MOVE コメント２Ｗ             TO  コメント２(カウンタ).
012840*
012890*================================================================*
012900 合計印刷処理 SECTION.
012910*
012920     MOVE 施術和暦Ｗ   TO 作２−施術和暦.
012930     MOVE 施術年Ｗ     TO 作２−施術年.
012940     MOVE 施術月Ｗ     TO 作２−施術月.
012950     MOVE 患者コードＷ TO 作２−患者コード.
012960     READ 作業ファイル２
012970     NOT INVALID KEY
               MOVE NC"計"             TO  合計(カウンタ)
005010         MOVE 作２−初検等       TO  初検料等(カウンタ)
005010         MOVE 作２−整復金額(1)  TO  整復料１(カウンタ)
005010         MOVE 作２−整復金額(2)  TO  整復料２(カウンタ)
005010         MOVE 作２−整復金額(3)  TO  整復料３(カウンタ)
005010         MOVE 作２−整復金額(4)  TO  整復料４(カウンタ)
005010         MOVE 作２−その他       TO  その他(カウンタ)
005010         MOVE 作２−罨法等       TO  罨法等(カウンタ)
005010         MOVE 作２−金属副子     TO  金属副子料(カウンタ)
005010         MOVE 作２−往療料       TO  往療料(カウンタ)
013040         MOVE 作２−費用額       TO  費用額(カウンタ)
013040         MOVE 作２−請求額       TO  請求額ＷＰ
               STRING "("              DELIMITED BY SIZE
                      施術月Ｗ         DELIMITED BY SIZE
                      "月分請求額"     DELIMITED BY SIZE
                      請求額ＷＰ       DELIMITED BY SIZE
                      "円)"            DELIMITED BY SIZE
                 INTO コメント１(カウンタ)
               END-STRING
014010     END-READ.
014020     COMPUTE カウンタ = カウンタ + 1.
014030*================================================================*
014040 総評コメント印刷処理 SECTION.
014050*
014060     MOVE 施術和暦Ｗ TO メモ−施術和暦.
014070     MOVE 施術年Ｗ   TO メモ−施術年.
014080     MOVE 施術月Ｗ   TO メモ−施術月.
014090     MOVE 99         TO メモ−施術日.
014100     MOVE 1          TO メモ−制御区分.
014110     MOVE 患者コードＷ  TO メモ−患者コード.
014120     READ メモファイル
014130     NOT INVALID KEY
014140         MOVE メモ−施術コメント TO コメントＷ
014150         MOVE コメント１Ｗ   TO  コメント１(カウンタ)
014160         MOVE コメント２Ｗ   TO  コメント２(カウンタ)
014170         IF 連印−合計モード NOT = 1
014180             COMPUTE カウンタ = カウンタ + 1
014190         END-IF
014200     END-READ.
014210*================================================================*
014220 作業ファイル１読込 SECTION.
014230*
014240     READ 作業ファイル１ NEXT
014250     AT END
014260         MOVE "YES" TO 終了フラグ
014270     END-READ.
014280*
014570*================================================================*
014580 印刷処理 SECTION.
014590*
014600     IF ( オープンフラグ NOT = "YES" )
014610        MOVE "YES" TO オープンフラグ
014620        OPEN I-O  印刷ファイル
014630        PERFORM エラー処理Ｐ
014640     END-IF.
014710*
014720     MOVE "YGN722P"  TO  定義体名Ｐ.
014730     MOVE "MEISAI"   TO  項目群名Ｐ.
014740     MOVE SPACE      TO  処理種別Ｐ.
014750     WRITE YGN722P.
014760     PERFORM エラー処理Ｐ.
014770*================================================================*
014780 改頁処理  SECTION.
014790*
014800     MOVE "YGN722P" TO  定義体名Ｐ.
014810     MOVE "CT"      TO  処理種別Ｐ.
014820     MOVE "PAGE"    TO  拡張制御Ｐ.
014830     MOVE SPACE     TO  項目群名Ｐ.
014840     WRITE YGN722P.
014850     PERFORM エラー処理Ｐ.
014860     MOVE SPACE     TO  拡張制御Ｐ.
014870*
014880     CLOSE  印刷ファイル.
014890     MOVE SPACE TO オープンフラグ.
014900*     OPEN I-O   印刷ファイル.
014910*     PERFORM エラー処理Ｐ.
014920*
014936*================================================================*
014940 エラー表示 SECTION.
014950*
014960     DISPLAY ファイル名   NC"ファイル書込エラー"   UPON CONS.
014970     DISPLAY NC"状態キー：" 状態キー               UPON CONS.
014980     DISPLAY NC"システム管理者に連絡してください"  UPON CONS.
014990     DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"                                                                    UPON CONS.
015000*-----------------------------------------*
015010     CALL "actcshm"  WITH C LINKAGE.
015020*-----------------------------------------*
015030     ACCEPT  キー入力 FROM CONS.
015040     PERFORM ファイル閉鎖.
015050     EXIT PROGRAM.
015060*================================================================*
015070 エラー処理Ｐ SECTION.
015080*
015090     IF 通知情報Ｐ NOT = "00"
015100         DISPLAY NC"帳票エラー"              UPON CONS
015110         DISPLAY NC"項目群名Ｐ：" 項目群名Ｐ UPON CONS
015120         DISPLAY NC"通知情報Ｐ：" 通知情報Ｐ UPON CONS
015130         DISPLAY NC"拡張制御Ｐ：" 拡張制御Ｐ UPON CONS
015140         DISPLAY NC"数字１文字入力しＥＮＴＥＲキーを押してください"
015150                                             UPON CONS
015160*-----------------------------------------*
015170         CALL "actcshm"  WITH C LINKAGE
015180*-----------------------------------------*
015190         ACCEPT  キー入力 FROM CONS
015200         PERFORM ファイル閉鎖
015210         MOVE 99 TO PROGRAM-STATUS
015220         EXIT PROGRAM
015230     END-IF.
015240*================================================================*
015250 ファイル閉鎖 SECTION.
015260*
015270     CLOSE 元号マスタ   制御情報マスタ 名称マスタ
015280           メモファイル 受診者情報Ｆ.
015310     CLOSE 作業ファイル１ 作業ファイル２.
015330     IF ( オープンフラグ = "YES" )
015340         CLOSE 印刷ファイル
015355     END-IF.
015360*
015466*================================================================*
015467 終了処理 SECTION.
015468*
015469     PERFORM ファイル閉鎖.
015470*================================================================*
015471 印刷行数退避 SECTION.
015472     CLOSE 受診者情報Ｆ.
015473     PERFORM 遅延処理.
015474     OPEN I-O 受診者情報Ｆ.
015475         MOVE NC"受診" TO ファイル名.
015476         PERFORM オープンチェック.
015480     PERFORM 遅延処理.
015490*
015500     MOVE ZERO            TO 受−施術和暦.
015510     MOVE ZERO            TO 受−施術年.
015520     MOVE ZERO            TO 受−施術月.
015530     MOVE 患者コードＷ    TO 受−患者コード.
015540*
015550     READ 受診者情報Ｆ
015560     NOT INVALID KEY
             DISPLAY 印字位置ＣＮＴ UPON CONS
015570         MOVE 印字位置ＣＮＴ TO 受−カルテ一般裏印刷行数
015580         REWRITE 受−レコード
015590         INVALID KEY
015600             MOVE NC"受Ｆ" TO ファイル名
015610             PERFORM エラー表示
015620         END-REWRITE
015630     END-READ.
015640     PERFORM 遅延処理.
015650     CLOSE 受診者情報Ｆ.
015660     PERFORM 遅延処理.
015670     OPEN INPUT 受診者情報Ｆ.
015680         MOVE NC"受診" TO ファイル名.
015690         PERFORM オープンチェック.
015700*================================================================*
015710 ヘッダセット２ SECTION.
015720*
015740*/次のレコードを読んだ後に前のデータのヘッダを印刷する場合。
015750*     MOVE 患者番号ＨＷ      TO 患者番号.
015760*     MOVE 枝番ＨＷ          TO 枝番.
015770*     MOVE 患者氏名ＨＷ      TO 患者氏名 患者氏名ＷＰ.
016360*================================================================*
016370******************************************************************
016380 END PROGRAM YGN722.
016390******************************************************************
